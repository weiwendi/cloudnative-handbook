
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Helm 与 Operator · 云原生运维指南</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="魏文弟">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-base16-ateliersulphurpool.light.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-donate/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-toc-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-image-captions/image-captions.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-footer-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-auto-scroll-table/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-advanced-emoji/emoji-website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-flexible-alerts/style.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="plugins.html" />
    
    
    <link rel="prev" href="helmcicd.html" />
    

    
        <link rel="shortcut icon" href='../https:/gitee.com/sretech/images/raw/master/favicon/favicon.ico' type="image/x-icon">
    
    
        <link rel="bookmark" href='../https:/gitee.com/sretech/images/raw/master/favicon/favicon.ico' type="image/x-icon">
    
    
    

    <style>
    @media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }
    </style>
    <script>
        window["gitbook-plugin-github-buttons"] = {"user":"weiwendi","repo":"cloudnative-handbook","types":["star"],"size":"small"};
    </script>

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://www.aiops.red" target="_blank" class="custom-link">博客</a>
        </li>
    
        
        <li>
            <a href="https://gitee.com/sretech/images/raw/master/wechatpublic.jpg" target="_blank" class="custom-link">公众号: sretech</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        <li class="header">云原生运维指南</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                        <b>1.1.</b>
                    
                    序言
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../cloudnative/jieshao.html">
            
                <a href="../cloudnative/jieshao.html">
            
                    
                        <b>1.2.</b>
                    
                    课程介绍
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Helm 最佳实践</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="jieshao.html">
            
                <a href="jieshao.html">
            
                    
                        <b>2.1.</b>
                    
                    Kubernetes and Helm 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="bushu.html">
            
                <a href="bushu.html">
            
                    
                        <b>2.2.</b>
                    
                    Helm 部署
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="anzhuangcharts.html">
            
                <a href="anzhuangcharts.html">
            
                    
                        <b>2.3.</b>
                    
                    安装 Helm 图表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="chartsjinjie.html">
            
                <a href="chartsjinjie.html">
            
                    
                        <b>2.4.</b>
                    
                    Helm 图表进阶
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="kaifacharts.html">
            
                <a href="kaifacharts.html">
            
                    
                        <b>2.5.</b>
                    
                    开发 Helm 图表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="ceshicharts.html">
            
                <a href="ceshicharts.html">
            
                    
                        <b>2.6.</b>
                    
                    测试 Helm 图表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="helmcicd.html">
            
                <a href="helmcicd.html">
            
                    
                        <b>2.7.</b>
                    
                    使用 CI/CD 和 GitOps 实现 Helm 自动化
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.8" data-path="operator.html">
            
                <a href="operator.html">
            
                    
                        <b>2.8.</b>
                    
                    Helm 与 Operator
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="plugins.html">
            
                <a href="plugins.html">
            
                    
                        <b>2.9.</b>
                    
                    Helm 插件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.10" data-path="security.html">
            
                <a href="security.html">
            
                    
                        <b>2.10.</b>
                    
                    Helm 安全
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Helm 与 Operator</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="8-helm-&#x4E0E;-operator">8 Helm &#x4E0E; Operator</h1>
<p>Helm &#x7684;&#x7279;&#x6027;&#x4E4B;&#x4E00;&#x662F;&#x80FD;&#x591F;&#x540C;&#x6B65;&#x672C;&#x5730;&#x72B6;&#x6001;&#x548C;&#x8FD0;&#x884C;&#x65F6;&#x72B6;&#x6001;&#x3002;&#x672C;&#x5730;&#x72B6;&#x6001;&#x7531; Helm &#x503C;&#x6587;&#x4EF6;&#x7BA1;&#x7406;&#xFF0C;&#x5728;&#x6267;&#x884C; <strong>install</strong> &#x6216; <strong>upgrade</strong> &#x547D;&#x4EE4;&#x65F6;&#x63D0;&#x4F9B;&#x8FD9;&#x4E9B;&#x503C;&#xFF0C;&#x8FD9;&#x4E9B;&#x503C;&#x5C31;&#x4F1A;&#x88AB;&#x5E94;&#x7528;&#x5230; Kubernetes &#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x65F6;&#x72B6;&#x6001;&#x3002;&#x5728;&#x524D;&#x9762;&#x7684;&#x7AE0;&#x8282;&#x4E2D;&#xFF0C;&#x7A0B;&#x5E8F;&#x9700;&#x8981;&#x66F4;&#x6539;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x8C03;&#x7528;&#x4E86;&#x8FD9;&#x4E9B;&#x547D;&#x4EE4;&#x3002;</p>
<p>&#x540C;&#x6B65;&#x8FD9;&#x4E9B;&#x66F4;&#x6539;&#xFF0C;&#x8FD8;&#x6709;&#x53E6;&#x5916;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#xFF0C;&#x90A3;&#x5C31;&#x662F;&#x5728;&#x96C6;&#x7FA4;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x5B9A;&#x671F;&#x68C0;&#x67E5;&#x6240;&#x9700;&#x7684;&#x72B6;&#x6001;&#x662F;&#x5426;&#x4E0E;&#x5F53;&#x524D;&#x73AF;&#x5883;&#x4E2D;&#x914D;&#x7F6E;&#x7684;&#x72B6;&#x6001;&#x76F8;&#x540C;&#x3002;&#x5982;&#x679C;&#x72B6;&#x6001;&#x4E0D;&#x5339;&#x914D;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x81EA;&#x52A8;&#x4FEE;&#x6539;&#x73AF;&#x5883;&#x4E2D;&#x914D;&#x7F6E;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x4EE5;&#x5339;&#x914D;&#x6240;&#x9700;&#x7684;&#x72B6;&#x6001;&#x3002;&#x8FD9;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x88AB;&#x79F0;&#x4E3A; Kubernetes Operator&#x3002;&#x5728;&#x672C;&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E; Helm &#x7684; Operator&#xFF0C;&#x5B83;&#x786E;&#x4FDD;&#x672C;&#x5730;&#x5B9A;&#x4E49;&#x7684;&#x72B6;&#x6001;&#x59CB;&#x7EC8;&#x4E0E;&#x96C6;&#x7FA4;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x72B6;&#x6001;&#x76F8;&#x540C;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x76F8;&#x540C;&#xFF0C;Operator &#x5C06;&#x6267;&#x884C;&#x76F8;&#x5E94;&#x7684; Helm &#x547D;&#x4EE4;&#x66F4;&#x65B0;&#x8FD0;&#x884C;&#x65F6;&#x72B6;&#x6001;&#x3002;</p>
<h2 id="81-&#x6280;&#x672F;&#x8981;&#x6C42;">8.1 &#x6280;&#x672F;&#x8981;&#x6C42;</h2>
<p>&#x672C;&#x7AE0;&#x4F7F;&#x7528;&#x5230;&#x7684;&#x547D;&#x4EE4;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>minikube</li>
<li>helm</li>
<li>kubectl</li>
</ul>
<p>&#x9664;&#x4E86;&#x8FD9;&#x4E9B;&#x5DE5;&#x5177;&#x5916;&#xFF0C;&#x4F60;&#x8FD8;&#x53EF;&#x4EE5;&#x5728; GitHub &#x7684; <a href="https://github.com/weiwendi/learn-helm" target="_blank">https://github.com/weiwendi/learn-helm</a> &#x4E0A;&#x627E;&#x5230;&#x5305;&#x542B;&#x76F8;&#x5173;&#x793A;&#x4F8B;&#x8D44;&#x6E90;&#x7684;&#x8D44;&#x6E90;&#x5E93;&#x3002;&#x8FD9;&#x4E2A;&#x5B58;&#x50A8;&#x5E93;&#x5C06;&#x5728;&#x672C;&#x7AE0;&#x4E2D;&#x88AB;&#x5F15;&#x7528;&#x3002;</p>
<h2 id="82-kubernetes-operators">8.2 Kubernetes Operators</h2>
<p>&#x81EA;&#x52A8;&#x5316;&#x662F; Kubernetes &#x5E73;&#x53F0;&#x7684;&#x6838;&#x5FC3;&#xFF0C;&#x6B63;&#x5982;&#x6211;&#x5728;&#x7B2C;&#x4E00;&#x7AE0;&#x4E2D;&#x4ECB;&#x7ECD;&#x7684;&#xFF0C;Kubernetes &#x8D44;&#x6E90;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <strong>kubectl</strong> &#x9690;&#x5F0F;&#x7BA1;&#x7406;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; YAML &#x683C;&#x5F0F;&#x7684;&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x58F0;&#x660E;&#x5F0F;&#x7BA1;&#x7406;&#x3002;&#x4E00;&#x65E6;&#x4F7F;&#x7528; Kubernetes Command-Line Interface (CLI) &#x5E94;&#x7528;&#x4E86;&#x8D44;&#x6E90;&#xFF0C;Kubernetes &#x5C31;&#x4F1A;&#x5C06;&#x96C6;&#x7FA4;&#x5185;&#x8D44;&#x6E90;&#x7684;&#x5F53;&#x524D;&#x72B6;&#x6001;&#x4E0E;&#x6240;&#x9700;&#x72B6;&#x6001;&#x5339;&#x914D;&#xFF0C;&#x8FD9;&#x4E00;&#x8FC7;&#x7A0B;&#x79F0;&#x4E3A;&#x63A7;&#x5236;&#x5FAA;&#x73AF;&#x3002;&#x8FD9;&#x79CD;&#x6301;&#x7EED;&#x7684;&#x3001;&#x65E0;&#x7EC8;&#x6B62;&#x7684;&#x96C6;&#x7FA4;&#x72B6;&#x6001;&#x76D1;&#x63A7;&#x6A21;&#x5F0F;&#x662F;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x63A7;&#x5236;&#x5668;&#x5B9E;&#x73B0;&#x7684;&#x3002;Kubernetes &#x5305;&#x542B;&#x4E86;&#x8BB8;&#x591A;&#x539F;&#x751F;&#x63A7;&#x5236;&#x5668;&#xFF0C;&#x793A;&#x4F8B;&#x5305;&#x62EC;&#x4ECE;&#x62E6;&#x622A;&#x5230; Kubernetes API(&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7F16;&#x7A0B;&#x63A5;&#x53E3;)&#x8BF7;&#x6C42;&#x7684;&#x51C6;&#x5165;&#x63A7;&#x5236;&#x5668;&#xFF0C;&#x4EE5;&#x53CA;&#x7BA1;&#x7406;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x7684; Pod &#x526F;&#x672C;&#x6570;&#x91CF;&#x7684;&#x526F;&#x672C;&#x63A7;&#x5236;&#x5668;(ReplicationController)&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x63D0;&#x9AD8;&#x7528;&#x6237;&#x7684;&#x4F7F;&#x7528;&#x70ED;&#x60C5;&#xFF0C;Kubernetes &#x9664;&#x4E86;&#x63D0;&#x4F9B;&#x6269;&#x5C55;&#x57FA;&#x7840;&#x5E73;&#x53F0;&#x529F;&#x80FD;&#x7684;&#x80FD;&#x529B;&#xFF0C;&#x4EE5;&#x53CA;&#x63D0;&#x4F9B;&#x7BA1;&#x7406;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;&#x66F4;&#x591A;&#x667A;&#x80FD;&#x7684;&#x65B9;&#x6CD5;&#x5916;&#xFF0C;&#x8FD8;&#x63D0;&#x51FA;&#x4E86;&#x51E0;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x53D1;&#x5C55;&#x8D8B;&#x52BF;&#xFF0C;&#x8FD9;&#x4E9B;&#x8D8B;&#x52BF;&#x5F15;&#x5BFC;&#x4E86; Kubernetes &#x5F00;&#x53D1;&#x7684;&#x4E8C;&#x6B21;&#x6D6A;&#x6F6E;&#x3002;&#x9996;&#x5148;&#xFF0C;&#x5B9A;&#x5236;&#x8D44;&#x6E90;&#x5B9A;&#x4E49;(CRDs)&#x7684;&#x5F15;&#x5165;&#x4F7F;&#x7528;&#x6237;&#x80FD;&#x591F;&#x6269;&#x5C55;&#x9ED8;&#x8BA4;&#x7684; Kubernetes API(&#x4E0E;Kubernetes&#x5E73;&#x53F0;&#x4EA4;&#x4E92;&#x7684;&#x673A;&#x5236;)&#xFF0C;&#x4EE5;&#x4FBF;&#x521B;&#x5EFA;&#x548C;&#x6CE8;&#x518C;&#x65B0;&#x7684;&#x8D44;&#x6E90;&#x7C7B;&#x578B;&#x3002;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;&#x65B0;&#x7684; CRD &#x4F1A;&#x5728; Kubernetes API &#x4E0A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x6807;&#x793A;&#x6027;&#x72B6;&#x6001;&#x4F20;&#x8F93;(RESTful)&#x8D44;&#x6E90;&#x8DEF;&#x5F84;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x4E0E;&#x4F7F;&#x7528; Kubernetes CLI &#x6267;&#x884C; <strong>kubectl get pods</strong> &#x67E5;&#x770B;&#x6240;&#x6709; Pod &#x5BF9;&#x8C61;&#x7C7B;&#x4F3C;&#xFF0C;&#x5047;&#x5982;&#x4E3A;&#x540D;&#x79F0;&#x662F; player-stats &#x7684;&#x5BF9;&#x8C61;&#x7C7B;&#x578B;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;&#x65B0;&#x7684; CRD&#xFF0C; &#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <strong>kubectl get player-stats</strong> &#x6765;&#x67E5;&#x770B;&#x4EE5;&#x524D;&#x521B;&#x5EFA;&#x7684;&#x6240;&#x6709; player-stats &#x5BF9;&#x8C61;&#x3002;&#x968F;&#x7740;&#x8FD9;&#x4E00;&#x65B0;&#x529F;&#x80FD;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x81EA;&#x5DF1;&#x7684;&#x63A7;&#x5236;&#x5668;&#x6765;&#x76D1;&#x89C6;&#x8FD9;&#x4E9B;&#x7C7B;&#x578B;&#x7684; CRs&#xFF0C;&#x4ECE;&#x800C;&#x7BA1;&#x7406;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4F7F;&#x7528; CRDs &#x63CF;&#x8FF0;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x751F;&#x547D;&#x5468;&#x671F;&#x3002;</p>
<p>&#x7B2C;&#x4E8C;&#x4E2A;&#x4E3B;&#x8981;&#x8D8B;&#x52BF;&#x662F;&#xFF0C;&#x590D;&#x6742;&#x548C;&#x6709;&#x72B6;&#x6001;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x88AB;&#x66F4;&#x9891;&#x7E41;&#x5730;&#x90E8;&#x7F72;&#x5728; Kubernetes &#x4E0A;&#x3002;&#x548C;&#x5C0F;&#x578B;&#x3001;&#x7B80;&#x5355;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E0D;&#x540C;&#xFF0C;&#x8FD9;&#x7C7B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7BA1;&#x7406;&#x548C;&#x7EF4;&#x62A4;&#x8D77;&#x6765;&#x901A;&#x5E38;&#x66F4;&#x9EBB;&#x70E6;&#xFF0C;&#x4F8B;&#x5982;&#x90E8;&#x7F72;&#x591A;&#x4E2A;&#x7EC4;&#x4EF6;&#xFF0C;&#x4EE5;&#x53CA;&#x56F4;&#x7ED5; &#x201C;day2&#x201D; &#x7684;&#x5907;&#x4EFD;&#x4E0E;&#x6062;&#x590D;&#x3002;&#x8FD9;&#x4E9B;&#x8D85;&#x51FA;&#x4E86; Kubernetes &#x539F;&#x751F;&#x63A7;&#x5236;&#x5668;&#x7684;&#x5904;&#x7406;&#x80FD;&#x529B;&#xFF0C;&#x56E0;&#x4E3A;&#x5B9E;&#x73B0;&#x8FD9;&#x4E9B;&#x9700;&#x8981;&#x5BF9;&#x8BE5;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3001;&#x6216;&#x8BE5;&#x7EC4;&#x670D;&#x52A1;&#x6709;&#x6DF1;&#x5165;&#x7684;&#x4E86;&#x89E3;&#x3002;&#x4F7F;&#x7528; CR &#x6765;&#x7BA1;&#x7406;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53CA;&#x5176;&#x7EC4;&#x4EF6;&#x7684;&#x6A21;&#x5F0F;&#x79F0;&#x4E3A; Operator &#x6A21;&#x5F0F;&#x3002;&#x8BE5;&#x9879;&#x76EE;&#x7531; CoreOS &#x8F6F;&#x4EF6;&#x516C;&#x53F8;&#x4E8E; 2016 &#x5E74;&#x9996;&#x521B;&#xFF0C;&#x76EE;&#x7684;&#x662F;&#x83B7;&#x53D6;&#x8FD0;&#x7EF4;&#x4EBA;&#x5458;&#x7BA1;&#x7406;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x751F;&#x547D;&#x5468;&#x671F;&#x6240;&#x9700;&#x7684;&#x77E5;&#x8BC6;&#x3002;Operators &#x88AB;&#x6253;&#x5305;&#x4E3A;&#x5BB9;&#x5668;&#x5316;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x90E8;&#x7F72;&#x5728; Pod &#x4E2D;&#xFF0C;&#x8FD9;&#x4E9B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4F1A;&#x6839;&#x636E; CRs &#x5BF9; API &#x7684;&#x66F4;&#x6539;&#x505A;&#x51FA;&#x5BF9;&#x5E94;&#x7684;&#x53CD;&#x5E94;&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x4F7F;&#x7528; Operator Framework &#x5DE5;&#x5177;&#x7BB1;&#xFF0C;&#x57FA;&#x4E8E;&#x4EE5;&#x4E0B;&#x4E09;&#x79CD;&#x6280;&#x672F;&#x4E2D;&#x7684;&#x4E00;&#x79CD;&#x7F16;&#x5199; Operators&#xFF1A;</p>
<ul>
<li>Ansible</li>
<li>Helm</li>
<li>Go</li>
</ul>
<p>&#x57FA;&#x4E8E; Go &#x7684; Operators &#x662F;&#x5229;&#x7528; Go &#x8BED;&#x8A00;&#x6765;&#x5B9E;&#x73B0;&#x63A7;&#x5236;&#x5FAA;&#x73AF;&#x903B;&#x8F91;&#x3002;&#x57FA;&#x4E8E; Ansible &#x7684; Operators &#x5229;&#x7528; Ansible CLI &#x5DE5;&#x5177;&#x548C; Ansible playbooks&#x3002;Ansible &#x662F;&#x4E00;&#x4E2A;&#x81EA;&#x52A8;&#x5316;&#x5DE5;&#x5177;&#xFF0C;&#x6211;&#x5728;&#x300A;&#x914D;&#x7F6E;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x300B;&#x90E8;&#x5206;&#x6709;&#x8FC7;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#xFF0C;&#x5B83;&#x7684;&#x903B;&#x8F91;&#x662F;&#x5728; PlayBooks &#x7684; YAML &#x6587;&#x4EF6;&#x4E2D;&#x7F16;&#x5199;&#x7684;&#x3002;</p>
<p>&#x5728;&#x672C;&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x91CD;&#x70B9;&#x5173;&#x6CE8;&#x57FA;&#x4E8E; Helm &#x7684; Operators&#x3002;Helm Operators &#x57FA;&#x4E8E; Helm &#x56FE;&#x8868;&#x548C; Helm CLI &#x63D0;&#x4F9B;&#x7684;&#x529F;&#x80FD;&#x5B50;&#x96C6;&#xFF0C;&#x6765;&#x5EFA;&#x7ACB;&#x5B83;&#x4EEC;&#x7684;&#x5FAA;&#x73AF;&#x903B;&#x8F91;&#xFF0C;&#x7B80;&#x5316;&#x4E86; Helm &#x7528;&#x6237;&#x5B9E;&#x73B0; Operators &#x7684;&#x590D;&#x6742;&#x5EA6;&#x3002;</p>
<p>&#x5728;&#x7406;&#x89E3;&#x4E86; Operators &#x4E4B;&#x540E;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x4F7F;&#x7528; Helm &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5C5E;&#x4E8E;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x7684; Operator&#x3002;</p>
<h2 id="83-&#x521B;&#x5EFA;helm-operator">8.3 &#x521B;&#x5EFA;Helm Operator</h2>
<p>&#x5728;&#x672C;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x7F16;&#x5199;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E; Helm &#x7684; Operator&#xFF0C;&#x7528;&#x4E8E;&#x5B89;&#x88C5; player-stats Helm &#x56FE;&#x8868;&#x3002;&#x8FD9;&#x4E2A;&#x56FE;&#x8868;&#x53EF;&#x4EE5;&#x5728;&#x56FE;&#x8868;&#x5B58;&#x50A8;&#x5E93;&#x4E2D;&#x627E;&#x5230;&#xFF0C;&#x9875;&#x9762;&#x5730;&#x5740;&#xFF1A;<a href="https://github.com/weiwendi/learn-helm/tree/main/helm-charts/charts/player-stats&#x3002;" target="_blank">https://github.com/weiwendi/learn-helm/tree/main/helm-charts/charts/player-stats&#x3002;</a></p>
<p>Operator &#x88AB;&#x6784;&#x5EFA;&#x4E3A;&#x7528;&#x4E8E;&#x7EF4;&#x62A4;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x63A7;&#x5236;&#x5FAA;&#x73AF;&#x903B;&#x8F91;&#x7684;&#x5BB9;&#x5668;&#x955C;&#x50CF;&#x3002;&#x4E0B;&#x56FE;&#x6F14;&#x793A;&#x4E86; Player-stats Operator &#x5728;&#x90E8;&#x7F72;&#x540E;&#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;&#xFF1A;</p>
<figure id="fig2.8.1"><img src="https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/8.1%20cr%20install%20chart.jpg" alt="8.1 cr install helm chart"><figcaption>8.1 cr install helm chart</figcaption></figure>
<p>Player-stats Operator &#x4F1A;&#x4E0D;&#x65AD;&#x89C2;&#x5BDF; Player-stats CRs &#x7684;&#x53D8;&#x5316;&#x3002;&#x5F53;&#x4E00;&#x4E2A; Player-stats CR &#x88AB;&#x521B;&#x5EFA;&#xFF0C;Player-stats Operator &#x5C06;&#x5B89;&#x88C5; player-stats &#x56FE;&#x8868;&#x3002;&#x5982;&#x679C;&#x5220;&#x9664;&#x4E86; Player-stats CR&#xFF0C;&#x5219; Player-stats Operator &#x5C06;&#x5220;&#x9664; player-stats Helm &#x56FE;&#x8868;&#x3002;</p>
<h2 id="84-&#x8BBE;&#x7F6E;&#x73AF;&#x5883;">8.4 &#x8BBE;&#x7F6E;&#x73AF;&#x5883;</h2>
<p>Operator &#x9700;&#x8981;&#x90E8;&#x7F72;&#x5230; Kubernetes &#x4E2D;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x5E94;&#x5148;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x6765;&#x542F;&#x52A8; Minikube &#x73AF;&#x5883;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ minikube start
</code></pre>
<p>&#x542F;&#x52A8; Minikube &#x540E;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; operators &#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ kubectl create ns operators
</code></pre>
<p>Player-stats Operator &#x662F;&#x4F5C;&#x4E3A;&#x5BB9;&#x5668;&#x955C;&#x50CF;&#x6784;&#x5EFA;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6709;&#x4E00;&#x4E2A;&#x5B58;&#x653E;&#x5BB9;&#x5668;&#x955C;&#x50CF;&#x7684;&#x4ED3;&#x5E93;&#xFF0C;&#x4EE5;&#x4FBF;&#x4F7F;&#x7528;&#x955C;&#x50CF;&#x3002;&#x53EF;&#x4EE5;&#x5728; Quay (quay.io) &#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x955C;&#x50CF;&#x5B58;&#x50A8;&#x5E93;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x516C;&#x5171;&#x7684;&#x5BB9;&#x5668;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#x3002;&#x5982;&#x679C;&#x4F60;&#x6709;&#x5176;&#x4ED6;&#x5B58;&#x50A8;&#x5E93;&#x7684;&#x8D26;&#x53F7;&#xFF0C;&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x8981;&#x51C6;&#x5907;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x6784;&#x5EFA; Operator &#x955C;&#x50CF;&#x6240;&#x9700;&#x5DE5;&#x5177;&#x7684;&#x672C;&#x5730;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x3002;</p>
<p>&#x8BA9;&#x6211;&#x4EEC;&#x9996;&#x5148;&#x5728; Quay &#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x955C;&#x50CF;&#x5B58;&#x50A8;&#x5E93;&#x3002;</p>
<h3 id="841-&#x521B;&#x5EFA;-quay-&#x5B58;&#x50A8;&#x5E93;">8.4.1 &#x521B;&#x5EFA; QUAY &#x5B58;&#x50A8;&#x5E93;</h3>
<p>&#x5728; Quay &#x4E2D;&#x521B;&#x5EFA;&#x5B58;&#x50A8;&#x5E93;&#xFF0C;&#x9996;&#x5148;&#x4F60;&#x9700;&#x8981;&#x6709; Redhat &#x5E10;&#x6237;&#x3002;&#x6309;&#x7167;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#x521B;&#x5EFA; Redhat &#x5E10;&#x6237;&#xFF1A;</p>
<ol>
<li><p>&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x8BBF;&#x95EE; <a href="https://quay.io/signin/" target="_blank">https://quay.io/signin/</a> &#x9875;&#x9762;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528; Redhat &#x8D26;&#x53F7;&#x767B;&#x5F55;&#x3002;</p>
</li>
<li><p>&#x6839;&#x636E;&#x63D0;&#x793A;&#x8FDB;&#x884C; Redhat &#x8D26;&#x53F7;&#x521B;&#x5EFA;&#x3002;</p>
</li>
<li><p>&#x521B;&#x5EFA;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x4F7F;&#x7528;&#x65B0;&#x8D26;&#x53F7;&#x767B;&#x5F55; Quay&#x3002;</p>
<p>&#x521B;&#x5EFA;&#x4E86; Quay &#x8D26;&#x53F7;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x64CD;&#x4F5C;&#x955C;&#x50CF;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x955C;&#x50CF;&#x4ED3;&#x5E93;&#x4E86;&#x3002;</p>
<p>&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x955C;&#x50CF;&#x5B58;&#x50A8;&#x5E93;&#xFF0C;&#x9009;&#x62E9; Quay &#x9875;&#x9762;&#x53F3;&#x4E0A;&#x89D2;&#x7684; <code>+</code> &#x56FE;&#x6807;&#xFF0C;&#x7136;&#x540E;&#x9009;&#x62E9; &#x201C;New Repository&#x201D;&#xFF0C;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF1A;</p>
<figure id="fig2.8.2"><img src="https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/8.2%20create%20quay%20image%20repo.jpg" alt="8.2 create quay image repo"><figcaption>8.2 create quay image repo</figcaption></figure>
</li>
<li><p>&#x63A5;&#x7740;&#x4F1A;&#x8FDB;&#x5165;Create New Repository &#x9875;&#x9762;&#xFF0C;&#x8F93;&#x5165;&#x4EE5;&#x4E0B;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#x521B;&#x5EFA;&#x5B58;&#x50A8;&#x5E93;&#xFF1A;</p>
<p>&#x9009;&#x62E9; Container Image Repository &#x8F93;&#x5165; Repository &#x540D;&#x79F0;&#xFF1A;playerstats-operator&#x3002;</p>
<p>&#x9009;&#x62E9; Public &#x6309;&#x94AE;&#xFF0C;&#x8868;&#x793A;&#x8BBF;&#x95EE;&#x5B58;&#x50A8;&#x5E93;&#x65F6;&#x4E0D;&#x9700;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x7B80;&#x5316; Kubernetes &#x8BBF;&#x95EE;&#x955C;&#x50CF;&#x7684;&#x65B9;&#x5F0F;&#x3002;</p>
<p>&#x5176;&#x4F59;&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x4FDD;&#x6301;&#x9ED8;&#x8BA4;&#x503C;&#x3002;&#x4E00;&#x65E6;&#x5B8C;&#x6210;&#xFF0C;Create Public Repository &#x9875;&#x9762;&#x5E94;&#x8BE5;&#x51FA;&#x73B0;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#x7684;&#x5185;&#x5BB9;&#xFF1A;</p>
<figure id="fig2.8.3"><img src="https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/8.3%20create%20public%20image%20repository.jpg" alt="8.3 create public image repository"><figcaption>8.3 create public image repository</figcaption></figure>
</li>
<li><p>&#x70B9;&#x51FB; Create Public Repository &#x6309;&#x94AE;&#xFF0C;&#x521B;&#x5EFA; Quay &#x955C;&#x50CF;&#x5B58;&#x50A8;&#x5E93;&#x3002;</p>
</li>
</ol>
<p>&#x73B0;&#x5728;&#x5DF2;&#x7ECF;&#x521B;&#x5EFA;&#x4E86;&#x5B58;&#x50A8; Player-stats Operator &#x955C;&#x50CF;&#x7684;&#x5B58;&#x50A8;&#x5E93;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x51C6;&#x5907;&#x4E00;&#x4E2A;&#x73AF;&#x5883;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x6784;&#x5EFA; Helm Operator &#x6240;&#x9700;&#x7684;&#x5DE5;&#x5177;&#x3002;</p>
<h3 id="842-&#x51C6;&#x5907;&#x672C;&#x5730;&#x5F00;&#x53D1;&#x73AF;&#x5883;">8.4.2 &#x51C6;&#x5907;&#x672C;&#x5730;&#x5F00;&#x53D1;&#x73AF;&#x5883;</h3>
<p>&#x4E3A;&#x4E86;&#x521B;&#x5EFA; Helm Operator&#xFF0C;&#x4F60;&#x81F3;&#x5C11;&#x9700;&#x8981;&#x4EE5;&#x4E0B; CLI &#x5DE5;&#x5177;&#xFF1A;</p>
<ul>
<li><strong>operator-sdk</strong></li>
<li><strong>docker/podman/buildah</strong></li>
</ul>
<p><strong>operator-sdk</strong> CLI &#x662F;&#x4E00;&#x4E2A;&#x5DE5;&#x5177;&#x5305;&#xFF0C;&#x7528;&#x4E8E;&#x5E2E;&#x52A9;&#x5F00;&#x53D1; Kubernetes Operators&#x3002;&#x5B83;&#x5305;&#x542B;&#x4E86;&#x7B80;&#x5316; Operator &#x5F00;&#x53D1;&#x8FC7;&#x7A0B;&#x7684;&#x5185;&#x5728;&#x903B;&#x8F91;&#x3002;&#x5728;&#x672C;&#x8D28;&#x4E0A;&#xFF0C;<strong>operator-sdk</strong> &#x9700;&#x8981;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#xFF0C;&#x7528;&#x6765;&#x6784;&#x5EFA; Operator &#x7684;&#x955C;&#x50CF;&#x3002;<strong>operator-sdk</strong> CLI&#x652F;&#x6301;<strong>docker&#x3001;podman&#x3001;build</strong>&#x7B49;&#x5E95;&#x5C42;&#x5BB9;&#x5668;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x3002;</p>
<p>&#x8981;&#x5B89;&#x88C5; <strong>operator-sdk</strong> CLI&#xFF0C;&#x53EA;&#x9700;&#x4ECE;&#x5B83;&#x7684; GitHub &#x4ED3;&#x5E93; <a href="https://github.com/operator-framework/operator-sdk/releases" target="_blank">https://github.com/operator-framework/operator-sdk/releases</a> &#x4E0B;&#x8F7D;&#x8F6F;&#x4EF6;&#x5305;&#x5B89;&#x88C5;&#x5373;&#x53EF;&#x3002;&#x5B89;&#x88C5; <strong>docker&#x3001;podman</strong>&#x6216;&#x8005; <strong>buildah</strong> &#x7684;&#x8FC7;&#x7A0B;&#x5C31;&#x4F1A;&#x6709;&#x6240;&#x4E0D;&#x540C;&#xFF0C;&#x8FD9;&#x53D6;&#x51B3;&#x4E8E;&#x4F60;&#x4F7F;&#x7528;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x3002;<strong>operator-sdk</strong> &#x6CA1;&#x6709;Windows&#x7248;&#x7684;&#x3002;</p>
<p>&#x5E78;&#x8FD0;&#x7684;&#x662F;&#xFF0C;Minikube VM &#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x8BB8;&#x591A;&#x4E0D;&#x540C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x7684;&#x5DE5;&#x4F5C;&#x73AF;&#x5883;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x662F;&#x4E00;&#x4E2A; Linux &#x865A;&#x62DF;&#x673A;&#xFF0C;&#x5E76;&#x4E14;&#x5305;&#x542B;&#x4E86; Docker CLI&#x3002;&#x5728;&#x672C;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x628A; <strong>operator-sdk</strong> &#x5B89;&#x88C5;&#x5230; Minikube VM &#x4E2D;&#xFF0C;&#x5E76;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x73AF;&#x5883;&#x521B;&#x5EFA; Operator&#x3002;&#x867D;&#x7136;&#x6211;&#x4EEC;&#x662F;&#x5728; VM &#x4E2D;&#x8FDB;&#x884C;&#x7684;&#xFF0C;&#x4F46;&#x8FD9;&#x4E9B;&#x6B65;&#x9AA4;&#x9002;&#x7528;&#x4E8E;&#x6240;&#x6709; Linux &#x548C; Mac &#x4E3B;&#x673A;&#x3002;</p>
<p>&#x8DDF;&#x7740;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF0C;&#x5C06; <strong>operator-sdk</strong> &#x5B89;&#x88C5;&#x5230; Minikube VM &#x4E0A;&#xFF1A;</p>
<ol>
<li><p>&#x4F7F;&#x7528; <strong>minikube ssh</strong> &#x547D;&#x4EE4;&#x767B;&#x5F55;&#x865A;&#x62DF;&#x673A;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ minikube <span class="token function">ssh</span>
</code></pre>
</li>
<li><p>&#x767B;&#x5F55; VM &#x540E;&#xFF0C;&#x4E0B;&#x8F7D; <strong>operator-sdk</strong> CLI&#x3002;&#x7F16;&#x5199;&#x6B64;&#x6587;&#x6863;&#x65F6;&#x6700;&#x65B0;&#x7248;&#x672C;&#x4E3A; 1.11.0&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528; <strong>curl</strong> &#x547D;&#x4EE4;&#x4E0B;&#x8F7D;&#x8BE5;&#x7248;&#x672C;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ <span class="token function">curl</span> -o operator-sdk -L https://github.com/operator-framework/operator-sdk/releases/download/v1.11.0/operator-sdk_linux_amd64
</code></pre>
</li>
<li><p>&#x4E0B;&#x8F7D;&#x5B8C;&#x540E;&#x540E;&#xFF0C;&#x4FEE;&#x6539;&#x4E3A;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x79FB;&#x52A8;&#x5230;PATH&#x8DEF;&#x5F84;&#x4E2D;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ <span class="token function">chmod</span> u+x operator-sdk
$ <span class="token function">sudo</span> <span class="token function">mv</span> operator-sdk /usr/bin
</code></pre>
</li>
<li><p>&#x6700;&#x540E;&#xFF0C;&#x901A;&#x8FC7;&#x8FD0;&#x884C; <strong>operator-sdk version</strong> &#x547D;&#x4EE4;&#x9A8C;&#x8BC1; <strong>operator-sdk</strong> &#x5B89;&#x88C5;&#x662F;&#x5426;&#x6210;&#x529F;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ operator-sdk version
operator-sdk version: <span class="token string">&quot;v1.11.0&quot;</span>, commit: <span class="token string">&quot;28dcd12a776d8a8ff597e1d8527b08792e7312fd&quot;</span>, kubernetes version: <span class="token string">&quot;1.20.2&quot;</span>, go version: <span class="token string">&quot;go1.16.7&quot;</span>, GOOS: <span class="token string">&quot;linux&quot;</span>, GOARCH: <span class="token string">&quot;amd64&quot;</span>
</code></pre>
<p>&#x5982;&#x679C;&#x6267;&#x884C;&#x8BE5;&#x547D;&#x4EE4;&#x6CA1;&#x6709;&#x62A5;&#x9519;&#xFF0C;&#x8BF4;&#x660E; <strong>operator-sdk</strong> CLI &#x5B89;&#x88C5;&#x6210;&#x529F;&#x3002;</p>
</li>
<li><p>&#x4F5C;&#x4E3A;&#x9644;&#x4EF6;&#x6B65;&#x9AA4;&#xFF0C;&#x5728; Minikube VM &#x4E2D;&#x514B;&#x9686;&#x56FE;&#x8868;&#x5B58;&#x50A8;&#x5E93;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x7A0D;&#x540E;&#x5C06;&#x4F7F;&#x7528; player-stats Helm &#x56FE;&#x8868;&#x6784;&#x5EFA; Helm Operator&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ <span class="token function">git</span> clone https://github.com/weiwendi/learn-helm.git
</code></pre>
</li>
</ol>
<p>&#x73B0;&#x5728;&#xFF0C;Quay &#x955C;&#x50CF;&#x4ED3;&#x5E93;&#x548C; Minikube VM &#x672C;&#x5730;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x90FD;&#x51C6;&#x5907;&#x597D;&#x4E86;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x5F00;&#x59CB;&#x7F16;&#x5199; Player-stats Operator&#x3002;&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x4E2A; Operator &#x7684;&#x53C2;&#x8003;&#x793A;&#x4F8B;&#xFF1A;<a href="https://github.com/weiwendi/learn-helm/tree/main/playerstats-operator&#x3002;" target="_blank">https://github.com/weiwendi/learn-helm/tree/main/playerstats-operator&#x3002;</a></p>
<h3 id="843-operator-&#x6587;&#x4EF6;&#x7ED3;&#x6784;">8.4.3 Operator &#x6587;&#x4EF6;&#x7ED3;&#x6784;</h3>
<p>&#x4E0E; Helm &#x56FE;&#x8868;&#x7C7B;&#x4F3C;&#xFF0C;<strong>operator-sdk</strong> CLI &#x6784;&#x5EFA;&#x7684; Helm Operators &#x4E5F;&#x6709;&#x4E00;&#x4E2A;&#x5FC5;&#x987B;&#x9075;&#x5B88;&#x7684;&#x6587;&#x4EF6;&#x7ED3;&#x6784;&#xFF0C;&#x5982;&#x4E0B;&#x8868;&#x6240;&#x793A;&#xFF1A;</p>
<table>
<thead>
<tr>
<th>&#x6587;&#x4EF6;&#x6216;&#x76EE;&#x5F55;</th>
<th>&#x5B9A;&#x4E49;</th>
</tr>
</thead>
<tbody>
<tr>
<td>config</td>
<td>&#x5B58;&#x653E;&#x5728;&#x96C6;&#x7FA4;&#x4E0A;&#x542F;&#x52A8;&#x9879;&#x76EE;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</td>
</tr>
<tr>
<td>Dockerfile</td>
<td>Operator &#x9879;&#x76EE;&#x7684; Dockerfile&#xFF0C;&#x7528;&#x4E8E;&#x6784;&#x5EFA;&#x955C;&#x50CF;</td>
</tr>
<tr>
<td>helm-charts/</td>
<td>&#x5305;&#x542B; Operator &#x8D1F;&#x8D23;&#x5B89;&#x88C5;&#x7684; Helm &#x56FE;&#x8868;</td>
</tr>
<tr>
<td>Makefile</td>
<td>&#x4F7F;&#x7528; make &#x65F6;&#x4F1A;&#x5F15;&#x7528;&#x6B64;&#x6587;&#x4EF6;&#x8F85;&#x52A9;&#x6784;&#x5EFA;&#x9879;&#x76EE;</td>
</tr>
<tr>
<td>PROJECT</td>
<td>&#x5305;&#x542B;&#x4E86;&#x9879;&#x76EE;&#x7684;&#x914D;&#x7F6E;&#x4FE1;&#x606F;</td>
</tr>
<tr>
<td>watches.yaml</td>
<td>&#x5B9A;&#x4E49; Operator &#x8D1F;&#x8D23;&#x76D1;&#x89C6;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x8D44;&#x6E90;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x5305;&#x62EC; Group&#x3001;Version&#x3001;Kind&#x3001;Helm &#x56FE;&#x8868;&#x4F4D;&#x7F6E;</td>
</tr>
</tbody>
</table>
<p>&#x521B;&#x5EFA; playerstats-operator&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ midir playerstats-operator
$ <span class="token builtin class-name">cd</span> playerstats-operator
</code></pre>
<p>&#x4F7F;&#x7528; <strong>operator-sdk init</strong> &#x547D;&#x4EE4;&#x8F7B;&#x677E;&#x521B;&#x5EFA; Operator &#x6587;&#x4EF6;&#x7ED3;&#x6784;</p>
<p>&#x8FD9;&#x521B;&#x5EFA;&#x4E86;Nginx -operator&#x9879;&#x76EE;&#xFF0C;&#x4E13;&#x95E8;&#x7528;&#x4E8E;&#x4F7F;&#x7528;APIVersion&#x67E5;&#x770B;Nginx&#x8D44;&#x6E90;</p>
<p>&#x4F7F;&#x7528; <strong>operator-sdk init</strong> &#x547D;&#x4EE4;&#x521B;&#x5EFA;&#x57FA;&#x4E8E; Helm &#x7684; playerstats-operator &#x9879;&#x76EE;&#x3002;playerstats-operator &#x9879;&#x76EE;&#x4E13;&#x95E8;&#x7528;&#x4E8E; APIVersion &#x67E5;&#x770B; Player-stats &#x8D44;&#x6E90;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ operator-sdk init --plugins helm --domain quay.io --helm-chart ~/learn-helm/helm-charts/charts/player-stats --kind Player-stats

Writing kustomize manifests <span class="token keyword">for</span> you to edit<span class="token punctuation">..</span>.
Creating the API:
$ operator-sdk create api --kind Player-stats --helm-chart /home/aiops/learn-helm/helm-charts/charts/player-stats
Writing kustomize manifests <span class="token keyword">for</span> you to edit<span class="token punctuation">..</span>.
Created helm-charts/player-stats
Generating RBAC rules
WARN<span class="token punctuation">[</span>0010<span class="token punctuation">]</span> The RBAC rules generated <span class="token keyword">in</span> config/rbac/role.yaml are based on the chart<span class="token string">&apos;s default manifest. Some rules may be missing for resources that are only enabled with custom
 values, and some existing rules may be overly broad. Double check the rules generated in config/rbac/role.yaml to ensure they meet the operator&apos;</span>s permission requirements.
</code></pre>
<p><strong>--plugins helm</strong> &#x6307;&#x5B9A;&#x521B;&#x5EFA;&#x57FA;&#x4E8E; Helm &#x7684; operator&#xFF1B;<strong>--kind</strong> &#x6307;&#x5B9A; CR &#x7684;&#x540D;&#x79F0;&#x4E3A; Player-stats&#xFF0C;&#x8BE5;&#x503C;&#x5FC5;&#x987B;&#x4EE5;&#x5927;&#x5199;&#x5B57;&#x6BCD;&#x5F00;&#x5934;&#xFF1B;<strong>--domain quay.io</strong> &#x6307;&#x5B9A; operator &#x7684;&#x955C;&#x50CF;&#x4ED3;&#x5E93;&#x5730;&#x5740;&#x4E3A; quay.io&#xFF1B;<strong>--helm-chart</strong> &#x6307;&#x793A; <strong>operator-sdk</strong> CLI &#x5C06; player-stats &#x56FE;&#x8868;&#x62F7;&#x8D1D;&#x5230; playerstats-operator &#x76EE;&#x5F55;&#x3002;</p>
<p>&#x6210;&#x529F;&#x521B;&#x5EFA;&#x4E86; player-stats operator &#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x6784;&#x5EFA; Operator &#x955C;&#x50CF;&#x5E76;&#x5C06;&#x5176;&#x63A8;&#x5230; Quay &#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#x3002;</p>
<h3 id="844-&#x6784;&#x5EFA;-operator-&#x955C;&#x50CF;&#x5E76;&#x63A8;&#x9001;&#x5230;-quay">8.4.4 &#x6784;&#x5EFA; Operator &#x955C;&#x50CF;&#x5E76;&#x63A8;&#x9001;&#x5230; Quay</h3>
<p>Makefile &#x6587;&#x4EF6;&#x4E2D; <code>IMAGE_TAG_BASE</code> &#x7684;&#x503C;&#xFF0C;&#x5B9A;&#x4E49;&#x4E86;&#x955C;&#x50CF;&#x7684;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#x5730;&#x5740;&#x3001;&#x955C;&#x50CF;&#x4ED3;&#x5E93;&#x540D;&#x79F0;&#x4EE5;&#x53CA;&#x955C;&#x50CF;&#x7684; tag&#x3002;&#x8BE5;&#x503C;&#x662F;&#x5728;&#x6267;&#x884C; <strong>operator-sdk init</strong> &#x547D;&#x4EE4;&#x65F6;&#x751F;&#x6210;&#x7684;&#xFF0C;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#x662F; <strong>--domain</strong> &#x63D0;&#x4F9B;&#x7684;&#xFF0C;&#x4ED3;&#x5E93;&#x540D;&#x79F0;&#x5C31;&#x662F;&#x6240;&#x5728;&#x76EE;&#x5F55;&#x7684;&#x540D;&#x79F0;&#xFF1A;playerstats-operator&#xFF0C;tag &#x662F;&#x8BE5; operator &#x7684;&#x7248;&#x672C;&#x53F7;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x4FEE;&#x6539;&#x8FD9;&#x4E9B;&#x503C;&#xFF0C;&#x53EF;&#x4EE5;&#x7F16;&#x8F91; Makefile &#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x547D;&#x4EE4;&#x884C;&#x4FEE;&#x6539;&#x3002;</p>
<p>&#x5728;&#x672C;&#x5730;&#x6784;&#x5EFA;&#x5B8C; operator &#x955C;&#x50CF;&#xFF0C;&#x9700;&#x8981;&#x628A;&#x5B83;&#x63A8;&#x9001;&#x5230;&#x955C;&#x50CF;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#xFF0C;&#x4EE5;&#x4FBF; Kubernetes &#x62C9;&#x53D6;&#x3002;&#x4F7F;&#x7528; Docker &#x5C06;&#x955C;&#x50CF;&#x63A8;&#x9001;&#x5230;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#xFF0C;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x4F7F;&#x7528; <strong>docker login</strong> &#x547D;&#x4EE4;&#x767B;&#x5F55;&#x5230; Quay&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ docker login quay.io --username <span class="token variable">$YOUR_QUAY_USERNAME</span> --password <span class="token variable">$YOUR_QUAY_PASSWORD</span>
</code></pre>
<p>&#x6784;&#x5EFA; Operator &#x955C;&#x50CF;&#x5E76;&#x63A8;&#x9001;&#x5230;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#xFF0C;&#x522B;&#x5FD8;&#x8BB0;&#x628A; IMG &#x4E2D;&#x7684; sretech &#x4FEE;&#x6539;&#x6210;&#x4F60;&#x7684; quay &#x8D26;&#x53F7;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ <span class="token function">make</span> docker-build docker-push <span class="token assign-left variable">IMG</span><span class="token operator">=</span><span class="token string">&quot;quay.io/sretech/playerstats-operator:v0.0.1&quot;</span>
docker build -t quay.io/sretech/playerstats-operator:v0.0.1 <span class="token builtin class-name">.</span>
Sending build context to Docker daemon    149kB
Step <span class="token number">1</span>/5 <span class="token builtin class-name">:</span> FROM quay.io/operator-framework/helm-operator:v1.11.0
 ---<span class="token operator">&gt;</span> e8bc8fc22395
Step <span class="token number">2</span>/5 <span class="token builtin class-name">:</span> ENV <span class="token assign-left variable"><span class="token environment constant">HOME</span></span><span class="token operator">=</span>/opt/helm
 ---<span class="token operator">&gt;</span> Using cache
 ---<span class="token operator">&gt;</span> 939f3e320dc2
Step <span class="token number">3</span>/5 <span class="token builtin class-name">:</span> COPY watches.yaml <span class="token variable">${<span class="token environment constant">HOME</span>}</span>/watches.yaml
 ---<span class="token operator">&gt;</span> Using cache
 ---<span class="token operator">&gt;</span> dd1aaf3731cc
Step <span class="token number">4</span>/5 <span class="token builtin class-name">:</span> COPY helm-charts  <span class="token variable">${<span class="token environment constant">HOME</span>}</span>/helm-charts
 ---<span class="token operator">&gt;</span> Using cache
 ---<span class="token operator">&gt;</span> 11c08abe328a
Step <span class="token number">5</span>/5 <span class="token builtin class-name">:</span> WORKDIR <span class="token variable">${<span class="token environment constant">HOME</span>}</span>
 ---<span class="token operator">&gt;</span> Using cache
 ---<span class="token operator">&gt;</span> d50c86585eb0
Successfully built d50c86585eb0
Successfully tagged quay.io/sretech/playerstats-operator:v0.0.1
docker push quay.io/sretech/playerstats-operator:v0.0.1
The push refers to repository <span class="token punctuation">[</span>quay.io/sretech/playerstats-operator<span class="token punctuation">]</span>
49108043bfd4: Pushed 
1fd26746c559: Pushed 
81c1dccd8779: Mounted from operator-framework/helm-operator 
337cb014e36c: Mounted from operator-framework/helm-operator 
83ab849ae91d: Mounted from operator-framework/helm-operator 
e7ed17121dee: Mounted from operator-framework/helm-operator 
785573c4b945: Mounted from operator-framework/helm-operator 
v0.0.1: digest: sha256:753559ae39712cdf5173f60d7afbd485e6f435dc1f05f709ebb4b65414e87f76 size: <span class="token number">1779</span>
</code></pre>
<p>&#x518D;&#x6B21;&#x67E5;&#x770B; quay.io &#x7684; playerstats-operator &#x4ED3;&#x5E93;&#x9875;&#x9762;&#xFF0C;&#x70B9;&#x51FB; tag &#x6807;&#x7B7E;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6211;&#x4EEC;&#x4E0A;&#x4F20;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x5982;&#x56FE;&#xFF1A;</p>
<figure id="fig2.8.4"><img src="https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/8.4%20player%20stats%20operator%20image.jpg" alt="8.4 player stats operator image"><figcaption>8.4 player stats operator image</figcaption></figure>
<p>&#x73B0;&#x5728; operator &#x955C;&#x50CF;&#x5DF2;&#x7ECF;&#x88AB;&#x63A8;&#x9001;&#x5230;&#x4E86;&#x5BB9;&#x5668;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x5C06;&#x5176;&#x90E8;&#x7F72;&#x5230; Kubernetes &#x4E2D;&#x3002;</p>
<h3 id="845-&#x90E8;&#x7F72;-playerstats-operator">8.4.5 &#x90E8;&#x7F72; playerstats operator</h3>
<p>&#x5728;&#x521B;&#x5EFA; playerstats operator &#x65F6;&#xFF0C;<strong>operator-sdk</strong> CLI &#x8FD8;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; config/ &#x7684;&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x5E76;&#x5728;&#x8BE5;&#x6587;&#x4EF6;&#x4E0B;&#x751F;&#x6210;&#x4E86;&#x90E8;&#x7F72; operator &#x6240;&#x9700;&#x7684;&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x662F; config/ &#x6587;&#x4EF6;&#x5939;&#x7684;&#x7ED3;&#x6784;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">config/
&#x251C;&#x2500;&#x2500; crd
&#x2502;   &#x251C;&#x2500;&#x2500; bases
&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; charts.quay.io_player-stats.yaml
&#x2502;   &#x2514;&#x2500;&#x2500; kustomization.yaml
&#x251C;&#x2500;&#x2500; default
&#x2502;   &#x251C;&#x2500;&#x2500; kustomization.yaml
&#x2502;   &#x251C;&#x2500;&#x2500; manager_auth_proxy_patch.yaml
&#x2502;   &#x2514;&#x2500;&#x2500; manager_config_patch.yaml
&#x251C;&#x2500;&#x2500; manager
&#x2502;   &#x251C;&#x2500;&#x2500; controller_manager_config.yaml
&#x2502;   &#x251C;&#x2500;&#x2500; kustomization.yaml
&#x2502;   &#x2514;&#x2500;&#x2500; manager.yaml
&#x251C;&#x2500;&#x2500; manifests
&#x2502;   &#x2514;&#x2500;&#x2500; kustomization.yaml
&#x251C;&#x2500;&#x2500; prometheus
&#x2502;   &#x251C;&#x2500;&#x2500; kustomization.yaml
&#x2502;   &#x2514;&#x2500;&#x2500; monitor.yaml
&#x251C;&#x2500;&#x2500; rbac
&#x2502;   &#x251C;&#x2500;&#x2500; auth_proxy_client_clusterrole.yaml
&#x2502;   &#x251C;&#x2500;&#x2500; auth_proxy_role_binding.yaml
&#x2502;   &#x251C;&#x2500;&#x2500; auth_proxy_role.yaml
&#x2502;   &#x251C;&#x2500;&#x2500; auth_proxy_service.yaml
&#x2502;   &#x251C;&#x2500;&#x2500; kustomization.yaml
&#x2502;   &#x251C;&#x2500;&#x2500; leader_election_role_binding.yaml
&#x2502;   &#x251C;&#x2500;&#x2500; leader_election_role.yaml
&#x2502;   &#x251C;&#x2500;&#x2500; player-stats_editor_role.yaml
&#x2502;   &#x251C;&#x2500;&#x2500; player-stats_viewer_role.yaml
&#x2502;   &#x251C;&#x2500;&#x2500; role_binding.yaml
&#x2502;   &#x251C;&#x2500;&#x2500; role.yaml
&#x2502;   &#x2514;&#x2500;&#x2500; service_account.yaml
&#x251C;&#x2500;&#x2500; samples
&#x2502;   &#x251C;&#x2500;&#x2500; charts_v1alpha1_player-stats.yaml
&#x2502;   &#x2514;&#x2500;&#x2500; kustomization.yaml
&#x2514;&#x2500;&#x2500; scorecard
    &#x251C;&#x2500;&#x2500; bases
    &#x2502;   &#x2514;&#x2500;&#x2500; config.yaml
    &#x251C;&#x2500;&#x2500; kustomization.yaml
    &#x2514;&#x2500;&#x2500; patches
        &#x251C;&#x2500;&#x2500; basic.config.yaml
        &#x2514;&#x2500;&#x2500; olm.config.yaml

<span class="token number">11</span> directories, <span class="token number">29</span> files
</code></pre>
<p>crd/ &#x6587;&#x4EF6;&#x5939;&#x5305;&#x542B;&#x4E86;&#x521B;&#x5EFA; player-stats CRD &#x6240;&#x9700;&#x7684; YAML &#x8D44;&#x6E90;(charts.quay.io_player-stats.yaml)&#x3002;&#x8BE5;&#x6587;&#x4EF6;&#x7528;&#x4E8E;&#x5411; Kubernetes &#x6CE8;&#x518C;&#x65B0;&#x7684; Player-stats API &#x7AEF;&#x70B9;&#x3002;&#x6B64;&#x5916; samples/ &#x6587;&#x4EF6;&#x5939;&#x8FD8;&#x5305;&#x542B;&#x4E00;&#x4E2A; Player-stats CR &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x793A;&#x4F8B;(charts_v1alpha1_player-stats.yaml)&#x3002;&#x521B;&#x5EFA;&#x6B64;&#x6587;&#x4EF6;&#x5C06;&#x89E6;&#x53D1; operator &#x5B89;&#x88C5; player-stats Helm &#x56FE;&#x8868;&#x3002;</p>
<p>&#x67E5;&#x770B; Player-stats CR &#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x4EE5;&#x4FBF;&#x719F;&#x6089;&#x5B9A;&#x4E49;&#x7684;&#x5C5E;&#x6027;&#x7C7B;&#x578B;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ <span class="token function">cat</span> playerstats-operator/config/samples/charts_v1alpha1_player-stats.yaml
apiVersion: charts.quay.io/v1alpha1
kind: Player-stats
metadata:
  name: player-stats-sample
spec:
  <span class="token comment"># Default values copied from &lt;project_dir&gt;/helm-charts/player-stats/values.yaml</span>
  affinity: <span class="token punctuation">{</span><span class="token punctuation">}</span>
  autoscaling:
    enabled: <span class="token boolean">false</span>
    maxReplicas: <span class="token number">100</span>
    minReplicas: <span class="token number">1</span>
    targetCPUUtilizationPercentage: <span class="token number">80</span>
  fullnameOverride: <span class="token string">&quot;&quot;</span>
  image:
    pullPolicy: IfNotPresent
    repository: registry.cn-beijing.aliyuncs.com/sretech/player-stats
    tag: <span class="token string">&quot;&quot;</span>
  imagePullSecrets: <span class="token punctuation">[</span><span class="token punctuation">]</span>
  ingress:
    annotations: <span class="token punctuation">{</span><span class="token punctuation">}</span>
    enabled: <span class="token boolean">false</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre>
<p>spec &#x4E0B;&#x7684;&#x6761;&#x76EE;&#x5F15;&#x7528;&#x4E86; player-stats &#x56FE;&#x8868;&#x7684; values.yaml &#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x503C;&#x3002;<strong>operator-sdk</strong> &#x5DE5;&#x5177;&#x81EA;&#x52A8;&#x4F7F;&#x7528;&#x8BE5;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x9ED8;&#x8BA4;&#x503C;&#x521B;&#x5EFA;&#x8FD9;&#x4E2A;&#x793A;&#x4F8B; CR&#x3002;&#x53EF;&#x4EE5;&#x5728;&#x5E94;&#x7528;&#x6B64; CR &#x524D;&#x6DFB;&#x52A0;&#x6216;&#x4FEE;&#x6539;&#x6761;&#x76EE;&#xFF0C;&#x4EE5;&#x8986;&#x76D6; player-stats &#x56FE;&#x8868;&#x7684;&#x5176;&#x4ED6;&#x503C;&#x3002;operator &#x5728;&#x8FD0;&#x884C;&#x65F6;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x503C;&#x90E8;&#x7F72; player-stats &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</p>
<p>rbac/ &#x76EE;&#x5F55;&#x4E0B;&#x7684; role_binding.yaml&#x3001;role.yaml&#x3001;service_account.yaml &#x6587;&#x4EF6;&#x7684;&#x521B;&#x5EFA;&#x662F;&#x4E3A;&#x4E86;&#x5411; operator &#x63D0;&#x4F9B;&#x5FC5;&#x8981;&#x7684;&#x6743;&#x9650;&#xFF0C;&#x4EE5;&#x4FBF;&#x76D1;&#x89C6; Player-stats CRs &#x548C;&#x5B89;&#x88C5; player-stats Helm &#x56FE;&#x8868;&#x5230; Kubernetes&#x3002;&#x5B83;&#x901A;&#x8FC7; service_account.yaml &#x4E2D;&#x5B9A;&#x4E49;&#x7684; service account&#xFF0C;&#x4F7F;&#x7528; Kubernetes API &#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6765;&#x6267;&#x884C;&#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#x3002;&#x4E00;&#x65E6;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x901A;&#x8FC7;&#xFF0C;&#x5C06;&#x6839;&#x636E; role.yaml&#x3001;role_binding.yaml &#x8D44;&#x6E90;&#x5411; operator &#x63D0;&#x4F9B;&#x6388;&#x6743;&#x3002;role.yaml &#x6587;&#x4EF6;&#x5B9A;&#x4E49;&#x4E86;&#x7EC6;&#x7C92;&#x5EA6;&#x7684;&#x6743;&#x9650;&#xFF0C;&#x8FD9;&#x4E9B;&#x6743;&#x9650;&#x5141;&#x8BB8; operator &#x6267;&#x884C;&#x786E;&#x5207;&#x7684;&#x8D44;&#x6E90;&#x548C;&#x64CD;&#x4F5C;&#x3002;role_binding.yaml &#x6587;&#x4EF6;&#x5C06;&#x89D2;&#x8272;&#x7ED1;&#x5B9A;&#x5230; operator &#x7684; service account &#x4E0A;&#x3002;</p>
<p>&#x4E86;&#x89E3;&#x4E86; rbac/ &#x6587;&#x4EF6;&#x5939;&#x4E2D;&#x7684;&#x8D44;&#x6E90;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x6309;&#x7167;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#x90E8;&#x7F72; player-stats operator &#x4E86;&#xFF1A;</p>
<ol>
<li><p>Minikube VM&#x4E2D;&#x6CA1;&#x6709;<strong>kubectl</strong>&#x547D;&#x4EE4;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x8FD8;&#x767B;&#x5F55;&#x5728;VM&#x4E2D;&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x9000;&#x51FA;&#x8FDE;&#x63A5;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ <span class="token builtin class-name">exit</span>
</code></pre>
</li>
<li><p>&#x524D;&#x9762;&#x7528; <strong>operator-sdk</strong> &#x521B;&#x5EFA;&#x7684;&#x8D44;&#x6E90;&#x4F4D;&#x4E8E;&#x6E90;&#x7801;&#x5B58;&#x50A8;&#x5E93;&#x7684; playerstats-operator/ &#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x3002;&#x5982;&#x679C;&#x4F60;&#x6CA1;&#x6709;&#x5728;&#x4E4B;&#x524D;&#x7684;&#x7AE0;&#x8282;&#x4E2D;&#x514B;&#x9686;&#x8FD9;&#x4E2A;&#x5B58;&#x50A8;&#x5E93;&#xFF0C;&#x73B0;&#x5728;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x514B;&#x9686;&#x5B83;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ <span class="token function">git</span> clone https://github.com/weiwendi/learn-helm.git
</code></pre>
<p><strong>operator-sdk</strong> CLI &#x57FA;&#x4E8E; player-stats Helm &#x56FE;&#x8868;&#x4E2D;&#x7684;&#x6A21;&#x677F;&#x6587;&#x4EF6;&#x751F;&#x6210;&#x4E86;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684; role.yaml &#x6587;&#x4EF6;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x4F60;&#x8FD8;&#x8BB0;&#x5F97;&#x7684;&#x8BDD;&#xFF0C;player-stats &#x56FE;&#x8868;&#x5305;&#x542B;&#x4E00;&#x4E9B;&#x8D44;&#x6E90;&#xFF0C;&#x8FD9;&#x4E9B;&#x8D44;&#x6E90;&#x53EA;&#x80FD;&#x57FA;&#x4E8E;&#x6761;&#x4EF6;&#x503C;&#x521B;&#x5EFA;&#xFF0C;&#x5982; Job &#x94A9;&#x5B50;&#x8D44;&#x6E90;&#xFF0C;&#x53EA;&#x6709;&#x542F;&#x7528;&#x4E86;&#x6301;&#x4E45;&#x6027;&#x5B58;&#x50A8;&#x624D;&#x4F1A;&#x5305;&#x542B;&#x8FD9;&#x4E9B;&#x8D44;&#x6E90;&#x3002;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x663E;&#x793A;&#x4E86; Job &#x6A21;&#x677F;&#x7684;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;</p>
<pre class="language-"><code class="lang-yaml">NaN
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> batch/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Job
</code></pre>
<p><strong>operator-sdk</strong> CLI &#x6CA1;&#x6709;&#x81EA;&#x52A8;&#x4E3A; Jobs &#x521B;&#x5EFA;&#x57FA;&#x4E8E;&#x89D2;&#x8272;&#x7684;&#x8BBF;&#x95EE;&#x63A7;&#x5236;(RBAC)&#x89C4;&#x5219;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4E0D;&#x786E;&#x5B9A;&#x8981;&#x90E8;&#x7F72;&#x7684;&#x56FE;&#x8868;&#x4E2D;&#x662F;&#x5426;&#x5305;&#x542B;&#x4E86;&#x8FD9;&#x4E2A;&#x6A21;&#x677F;&#x3002;</p>
<p>&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x5C06;&#x8FD9;&#x4E9B;&#x89C4;&#x5219;&#x6DFB;&#x52A0;&#x5230;&#x4E86;role.yaml &#x6587;&#x4EF6;&#xFF0C;&#x4F4D;&#x4E8E;<a href="https://github.com/weiwendi/learn-helm/blob/main/playerstats-operator/config/rbac/role.yaml#L62-L67" target="_blank">https://github.com/weiwendi/learn-helm/blob/main/playerstats-operator/config/rbac/role.yaml#L62-L67</a>.</p>
<pre class="language-"><code class="lang-yaml"><span class="token punctuation">-</span> <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">&quot;*&quot;</span>
  <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">&quot;batch&quot;</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">&quot;jobs&quot;</span>
</code></pre>
</li>
<li><p>&#x6709;&#x4E09;&#x79CD;&#x65B9;&#x5F0F;&#x8FD0;&#x884C; Operator&#xFF0C;&#x6211;&#x4EEC;&#x91C7;&#x7528;&#x5728;&#x96C6;&#x7FA4;&#x4E2D;&#x8FD0;&#x884C; Deployment &#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x5B98;&#x7F51;&#x4ECB;&#x7ECD; <a href="https://sdk.operatorframework.io/docs/building-operators/helm/tutorial/&#x3002;&#x4F46;&#x5728;&#x8FD0;&#x884C;" target="_blank">https://sdk.operatorframework.io/docs/building-operators/helm/tutorial/&#x3002;&#x4F46;&#x5728;&#x8FD0;&#x884C;</a> Operator &#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x505A;&#x4E00;&#x4E9B;&#x8F85;&#x52A9;&#x6027;&#x7684;&#x4FEE;&#x6539;&#xFF0C;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x66F4;&#x987A;&#x5229;&#x7684;&#x8FD0;&#x884C; Operator&#x3002;</p>
<ol>
<li><p>&#x4FEE;&#x6539; Makefile &#x4E2D; kustomize &#x5DE5;&#x5177;&#x7684;&#x83B7;&#x53D6;&#x65B9;&#x5F0F;&#x3002;&#x5728; Makefile &#x539F;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528; <strong>curl</strong> &#x547D;&#x4EE4;&#x4ECE; <a href="https://github.com/kubernetes-sigs/kustomize/releases" target="_blank">https://github.com/kubernetes-sigs/kustomize/releases</a> &#x4E0B;&#x8F7D; kustomize &#x7684; tar &#x5305;&#xFF0C;&#x5E76;&#x89E3;&#x538B;&#x5230; Makefile &#x540C;&#x7EA7;&#x76EE;&#x5F55;&#x7684; bin/ &#x76EE;&#x5F55;&#x4E2D;&#xFF0C;&#x8FD9;&#x4E2A;&#x4E0B;&#x8F7D;&#x8FC7;&#x7A0B;&#x8017;&#x65F6;&#x6BD4;&#x8F83;&#x957F;&#xFF0C;&#x7F51;&#x7EDC;&#x4E0D;&#x7A33;&#x5B9A;&#x7684;&#x73AF;&#x5883;&#x4E2D;&#x5BB9;&#x6613;&#x51FA;&#x73B0;&#x5F02;&#x5E38;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x63D0;&#x524D;&#x51C6;&#x5907;&#x597D;&#x8BE5;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x628A; <strong>curl</strong> &#x547D;&#x4EE4;&#x6362;&#x6210; <strong>cp</strong> &#x547D;&#x4EE4;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash"><span class="token comment"># &#x539F;&#x547D;&#x4EE4;&#x7C7B;&#x4F3C;&#x5982;&#x4E0B;&#xFF1A;</span>
<span class="token function">curl</span> -sSLo - https://github.com/kubernetes-sigs/kustomize/releases/download/kustomize/v3.8.7/kustomize_v3.8.7_<span class="token variable"><span class="token variable">$(</span>OS<span class="token variable">)</span></span>_<span class="token variable"><span class="token variable">$(</span>ARCH<span class="token variable">)</span></span>.tar.gz <span class="token operator">|</span> <span class="token punctuation">\</span>tar xzf - -C bin/ <span class="token punctuation">;</span><span class="token punctuation">\</span>

<span class="token comment"># &#x4E0B;&#x8F7D;&#x5BF9;&#x5E94;&#x7684; tar.gz &#x5305;&#x5E76;&#x89E3;&#x538B;&#x5230;&#x67D0;&#x4E2A;&#x76EE;&#x5F55;&#xFF0C;&#x4ECE;&#x8BE5;&#x76EE;&#x5F55;&#x8FDB;&#x884C;&#x62F7;&#x8D1D;</span>
<span class="token comment"># &#x6CE8;&#x610F; kustomize &#x6587;&#x4EF6;&#x8981;&#x6709;&#x6267;&#x884C;&#x6743;&#x9650;</span>
<span class="token function">cp</span> /root/software/kustomize <span class="token variable"><span class="token variable">$(</span><span class="token function">dir</span> <span class="token punctuation">$(</span>KUSTOMIZE<span class="token punctuation">)</span><span class="token variable">)</span></span> <span class="token punctuation">;</span><span class="token punctuation">\</span>
</code></pre>
</li>
<li><p>&#x4FEE;&#x6539; kube-rbac-proxy &#x955C;&#x50CF;&#x3002;&#x8FD0;&#x884C; Operator &#x9700;&#x8981; kube-rbac-proxy &#x955C;&#x50CF;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F; gcr.io/kubebuilder/kube-rbac-proxy:v0.8.0 &#x7684;&#x955C;&#x50CF;&#x4ED3;&#x5E93;&#xFF0C;&#x6211;&#x4EEC;&#x628A;&#x955C;&#x50CF;&#x6539;&#x6210; registry.cn-beijing.aliyuncs.com/sretech/kube-rbac-proxy:v0.8.0&#xFF1A;</p>
<pre class="language-"><code class="lang-bash"><span class="token punctuation">[</span>aiops@aiops0113 playerstats-operator<span class="token punctuation">]</span>$ <span class="token function">sed</span> -i <span class="token string">&apos;s/gcr.io\/kubebuilder\/kube-rbac-proxy:v0.8.0/registry.cn-beijing.aliyuncs.com\/sretech\/kube-rbac-proxy:v0.8.0/g&apos;</span> config/default/manager_auth_proxy_patch.yaml
</code></pre>
<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x4EE5;&#x540E;&#x955C;&#x50CF; tag &#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x751F;&#x53D8;&#x5316;&#xFF0C;&#x4E0D;&#x518D;&#x662F; v0.8.0&#xFF0C;&#x8FD9;&#x65F6;&#x518D;&#x4F7F;&#x7528;&#x4E0A;&#x9762;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x4F1A;&#x66FF;&#x6362;&#x5931;&#x8D25;&#x3002;</p>
</li>
</ol>
</li>
<li><p>&#x63A5;&#x4E0B;&#x6765;&#x6267;&#x884C; <strong>make deploy</strong> &#x547D;&#x4EE4;&#xFF0C;&#x5B89;&#x88C5; config/rbac &#x4E2D;&#x7684;&#x6E05;&#x5355;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash"><span class="token function">make</span> deploy <span class="token assign-left variable">IMG</span><span class="token operator">=</span><span class="token string">&quot;quay.io/sretech/playerstats-operator:v0.0.1&quot;</span>
</code></pre>
</li>
<li><p>&#x9A8C;&#x8BC1; playerstats-operator &#x662F;&#x5426;&#x542F;&#x52A8;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">kubectl get deployment -n playerstats-operator-system
NAME                                      READY   UP-TO-DATE   AVAILABLE   AGE
playerstats-operator-controller-manager   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           8m
</code></pre>
</li>
</ol>
<p>&#x73B0;&#x5728;&#xFF0C;Player-stats Operator &#x5DF2;&#x7ECF;&#x90E8;&#x7F72;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x5B83;&#x6765;&#x5B89;&#x88C5; Player-stats Helm &#x56FE;&#x8868;&#x3002;</p>
<h3 id="846-&#x90E8;&#x7F72;-player-stats-&#x5E94;&#x7528;&#x7A0B;&#x5E8F;">8.4.6 &#x90E8;&#x7F72; player-stats &#x5E94;&#x7528;&#x7A0B;&#x5E8F;</h3>
<p>&#x5C06; Helm &#x7528;&#x4F5C;&#x72EC;&#x7ACB;&#x5DE5;&#x5177;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <strong>helm install</strong> &#x547D;&#x4EE4;&#x5B89;&#x88C5; Helm &#x56FE;&#x8868;&#x3002;&#x4F7F;&#x7528; Helm operator&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x521B;&#x5EFA; CR &#x5B89;&#x88C5; Helm &#x56FE;&#x8868;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ kubectl apply -f playerstats-operator/config/samples/charts_v1alpha1_player-stats.yaml -n operators
</code></pre>
<p>&#x89C2;&#x5BDF; <strong>operators</strong> &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x7684; Pod &#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ kubectl get pods -n operators -w
NAME                                   READY   STATUS              RESTARTS   AGE
mongo-fc6f6b868-s4lfg                  <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          10s
player-stats-sample-5599464bfd-6bzzn   <span class="token number">0</span>/1     Running             <span class="token number">0</span>          10s
player-stats-sample-5599464bfd-6bzzn   <span class="token number">0</span>/1     Running             <span class="token number">1</span>          42s
player-stats-sample-5599464bfd-6bzzn   <span class="token number">0</span>/1     Running             <span class="token number">2</span>          74s
player-stats-sample-5599464bfd-6bzzn   <span class="token number">0</span>/1     Running             <span class="token number">3</span>          112s
mongo-fc6f6b868-s4lfg                  <span class="token number">0</span>/1     Running             <span class="token number">0</span>          118s
mongo-fc6f6b868-s4lfg                  <span class="token number">1</span>/1     Running             <span class="token number">0</span>          2m3s
player-stats-sample-5599464bfd-6bzzn   <span class="token number">1</span>/1     Running             <span class="token number">3</span>          2m13s
</code></pre>
<p>&#x5F53;&#x521B;&#x5EFA; Player-stats CR &#x65F6;&#xFF0C;operator &#x4F1A;&#x6267;&#x884C; <strong>helm install</strong> &#x547D;&#x4EE4;&#x5B89;&#x88C5; player-stats &#x56FE;&#x8868;&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <strong>helm list</strong> &#x786E;&#x8BA4;release&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ helm list -n operators
NAME                   NAMESPACE    REVISION    UPDATED
player-stats-sample    operators    <span class="token number">1</span>           <span class="token number">2021</span>-08-26 07:33:24
</code></pre>
<p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4FEE;&#x6539; player-stats-sample CR &#x6765;&#x6267;&#x884C;&#x7248;&#x672C;&#x5347;&#x7EA7;&#xFF0C;&#x5C06; playerstats-operator/config/samples/charts_v1alpha1_player-stats.yaml &#x6587;&#x4EF6;&#x4E2D; replicas &#x7684;&#x503C;&#x4ECE; 1 &#x6539;&#x4E3A; 2&#xFF1A;</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">replicaCount</span><span class="token punctuation">:</span> <span class="token number">2</span>
</code></pre>
<p>&#x5E94;&#x7528;&#x66F4;&#x6539;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ kubectl apply -f playerstats-operator/config/samples/charts_v1alpha1_player-stats.yaml -n operators
</code></pre>
<p>&#x8FD9;&#x65F6;&#x5C06;&#x89E6;&#x53D1; <strong>helm upgrade</strong> &#x547D;&#x4EE4;&#xFF0C;player-stats Helm &#x56FE;&#x8868;&#x7684;&#x5347;&#x7EA7;&#x53C8;&#x4F1A;&#x89E6;&#x53D1; upgrade hook &#x5907;&#x4EFD; MongoDB &#x6570;&#x636E;&#x3002;&#x5982;&#x679C;&#x4F60;&#x5728;&#x4FEE;&#x6539; CR &#x540E;&#x5BF9; operators &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x7684; Pod &#x8FDB;&#x884C;&#x76D1;&#x63A7;&#xFF0C;&#x80FD;&#x770B;&#x5230;&#x5907;&#x4EFD; Job &#x5F00;&#x59CB;&#x6267;&#x884C;&#x3002;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <strong>helm list</strong> &#x547D;&#x4EE4;&#x67E5;&#x770B; player-stats-sample &#x7684;&#x7248;&#x672C;&#x53D8;&#x6210;&#x4E86; 2&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ helm list -n operators
NAME                   NAMESPACE    REVISION    
player-stats-sample    operators    <span class="token number">2</span>
</code></pre>
<p>&#x5C3D;&#x7BA1;&#x4FEE;&#x8BA2;&#x53F7;&#x53D8;&#x6210;&#x4E86; 2&#xFF0C;&#x4F46;&#x622A;&#x81F3;&#x7F16;&#x5199;&#x6B64;&#x6587;&#x65F6;&#xFF0C;&#x57FA;&#x4E8E; helm operator &#x7684;&#x4E00;&#x4E2A;&#x9650;&#x5236;&#x662F;&#xFF0C;&#x4E0D;&#x80FD;&#x50CF;&#x4F7F;&#x7528; helm cli &#x90A3;&#x6837;&#x5BF9;&#x4EE5;&#x524D;&#x7248;&#x672C;&#x8FDB;&#x884C;&#x56DE;&#x6EDA;&#x3002;&#x5982;&#x679C;&#x4F60;&#x5BF9; player-stats-sample &#x6267;&#x884C; <strong>helm history</strong>&#xFF0C;&#x67E5;&#x770B;&#x53D1;&#x5E03;&#x5386;&#x53F2;&#xFF0C;&#x53EA;&#x80FD;&#x770B;&#x5230;&#x7248;&#x672C; 2&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ helm <span class="token function">history</span> player-stats-sample -n operators
REVISION    UPDATED                     STATUS 
<span class="token number">2</span>           Thu Aug <span class="token number">26</span> 08:18:27 <span class="token number">2021</span>    deployed
</code></pre>
<p>&#x8FD9;&#x662F; helm cli &#x548C; helm operator &#x4E4B;&#x95F4;&#x7684;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x533A;&#x522B;&#x3002;&#x56E0;&#x4E3A;&#x4E0D;&#x4FDD;&#x7559;&#x53D1;&#x5E03;&#x5386;&#x53F2;&#xFF0C;&#x6240;&#x4EE5;&#x57FA;&#x4E8E; Helm operator &#x4E0D;&#x5141;&#x8BB8;&#x6267;&#x884C;&#x663E;&#x793A;&#x56DE;&#x6EDA;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5728;&#x5347;&#x7EA7;&#x5931;&#x8D25;&#x65F6;&#xFF0C;&#x5C06;&#x8FD0;&#x884C; <strong>helm rollback</strong> &#x547D;&#x4EE4;&#x3002;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5C06;&#x6267;&#x884C;&#x56DE;&#x6EDA; hook&#xFF0C;&#x5C1D;&#x8BD5;&#x56DE;&#x6EDA;&#x5230;&#x5347;&#x7EA7;&#x524D;&#x7248;&#x672C;&#x3002;</p>
<p>&#x5C3D;&#x7BA1;&#x57FA;&#x4E8E; Helm &#x7684; operator &#x4E0D;&#x4FDD;&#x7559;&#x53D1;&#x5E03;&#x5386;&#x53F2;&#xFF0C;&#x4F46;&#x5B83;&#x6709;&#x4E00;&#x4E2A;&#x4F18;&#x52BF;&#x5C31;&#x662F;&#x540C;&#x6B65; application &#x7684;&#x671F;&#x671B;&#x72B6;&#x6001;&#x548C;&#x8FD0;&#x884C;&#x65F6;&#x72B6;&#x6001;&#x3002;&#x8FD9;&#x662F;&#x56E0;&#x4E3A; operator &#x80FD;&#x591F;&#x4E0D;&#x65AD;&#x76D1;&#x89C6; Kubernetes &#x73AF;&#x5883;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x5E76;&#x786E;&#x4FDD; application &#x7684;&#x914D;&#x7F6E;&#x59CB;&#x7EC8;&#x4E0E; CR &#x4E0A;&#x6307;&#x5B9A;&#x7684;&#x914D;&#x7F6E;&#x76F8;&#x540C;&#x3002;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x5982;&#x679C;&#x4FEE;&#x6539;&#x4E86; Player stats application &#x7684;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;&#xFF0C;operator &#x4F1A;&#x7ACB;&#x5373;&#x6062;&#x590D;&#x66F4;&#x6539;&#xFF0C;&#x4F7F;&#x5176;&#x4E0E; CR &#x7684;&#x5B9A;&#x4E49;&#x76F8;&#x5339;&#x914D;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4FEE;&#x6539; Player stats &#x7684;&#x67D0;&#x4E2A;&#x8D44;&#x6E90;&#x6765;&#x9A8C;&#x8BC1;&#x8FD9;&#x4E00;&#x70B9;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x76F4;&#x63A5;&#x5C06; Player stats &#x90E8;&#x7F72;&#x7684;&#x526F;&#x672C;&#x6570;&#x4ECE; 2 &#x66F4;&#x6539;&#x4E3A; 3&#xFF0C;&#x5E76;&#x89C2;&#x5BDF; operator &#x5C06;&#x5176;&#x81EA;&#x52A8;&#x6062;&#x590D;&#x4E3A; 2 &#x4E2A;&#x526F;&#x672C;&#xFF0C;&#x4EE5;&#x91CD;&#x65B0;&#x540C;&#x6B65;&#x4E3A; CR &#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x6240;&#x9700;&#x72B6;&#x6001;&#x3002;</p>
<p>&#x6267;&#x884C; <strong>kubectl patch</strong> &#x547D;&#x4EE4;&#x5C06; Player stats &#x90E8;&#x7F72;&#x7684;&#x526F;&#x672C;&#x8BA1;&#x6570;&#x4ECE; 2 &#x4FEE;&#x6539;&#x4E3A; 3&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ kubectl patch deployment player-stats-sample -p <span class="token string">&apos;{&quot;spec&quot;:{&quot;replicas&quot;:3}}&apos;</span> -n operators
</code></pre>
<p>&#x901A;&#x5E38;&#xFF0C;&#x8FD9;&#x4F1A;&#x589E;&#x52A0;&#x4E00;&#x4E2A; player-stats application &#x526F;&#x672C;&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E; Player-stats CR &#x5B9A;&#x4E49;&#x7684;&#x526F;&#x672C;&#x6570;&#x4E3A; 2&#xFF0C;Operator &#x4F1A;&#x8FC5;&#x901F;&#x5C06;&#x526F;&#x672C;&#x6570;&#x4FEE;&#x6539;&#x4E3A; 2&#xFF0C;&#x5E76;&#x7EC8;&#x6B62;&#x65B0;&#x589E; Pod &#x7684;&#x521B;&#x5EFA;&#x3002;&#x5982;&#x679C;&#x4F60;&#x9700;&#x8981;&#x628A;&#x526F;&#x672C;&#x6570;&#x8C03;&#x6574;&#x4E3A; 3&#xFF0C;&#x5FC5;&#x987B;&#x66F4;&#x65B0; Player-stats CR&#x4E0A;&#x7684; replicaCount &#x503C;&#x3002;&#x8FD9;&#x4E2A;&#x7279;&#x6027;&#x786E;&#x4FDD;&#x4E86;&#x96C6;&#x7FA4;&#x8FD0;&#x884C;&#x65F6;&#x72B6;&#x6001;&#x4E0E;&#x914D;&#x7F6E;&#x72B6;&#x6001;&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x3002;</p>
<h3 id="847-&#x5220;&#x9664;-operator">8.4.7 &#x5220;&#x9664; Operator</h3>
<p>&#x5148;&#x5220;&#x9664; player-stats-sample CR&#xFF0C;&#x5E76;&#x5378;&#x8F7D; Helm release&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ kubectl delete -f playerstats-operator/config/samples/charts_v1alpha1_player-stats.yaml -n operators
</code></pre>
<p>&#x8BE5;&#x547D;&#x4EE4;&#x4F1A;&#x5220;&#x9664; player-stats-sample &#x548C;&#x6240;&#x6709;&#x4F9D;&#x8D56;&#x7684;&#x8D44;&#x6E90;&#x3002;</p>
<p>&#x5728;&#x8D44;&#x6E90;&#x5220;&#x9664;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5220;&#x9664; Operator &#x4E86;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ <span class="token function">make</span> undeploy
/tmp/test/playerstats-operator/bin/kustomize build config/default <span class="token operator">|</span> kubectl delete -f -
namespace <span class="token string">&quot;playerstats-operator-system&quot;</span> deleted
customresourcedefinition.apiextensions.k8s.io <span class="token string">&quot;player-stats.charts.quay.io&quot;</span> deleted
serviceaccount <span class="token string">&quot;playerstats-operator-controller-manager&quot;</span> deleted
role.rbac.authorization.k8s.io <span class="token string">&quot;playerstats-operator-leader-election-role&quot;</span> deleted
clusterrole.rbac.authorization.k8s.io <span class="token string">&quot;playerstats-operator-manager-role&quot;</span> deleted
clusterrole.rbac.authorization.k8s.io <span class="token string">&quot;playerstats-operator-metrics-reader&quot;</span> deleted
clusterrole.rbac.authorization.k8s.io <span class="token string">&quot;playerstats-operator-proxy-role&quot;</span> deleted
rolebinding.rbac.authorization.k8s.io <span class="token string">&quot;playerstats-operator-leader-election-rolebinding&quot;</span> deleted
clusterrolebinding.rbac.authorization.k8s.io <span class="token string">&quot;playerstats-operator-manager-rolebinding&quot;</span> deleted
clusterrolebinding.rbac.authorization.k8s.io <span class="token string">&quot;playerstats-operator-proxy-rolebinding&quot;</span> deleted
configmap <span class="token string">&quot;playerstats-operator-manager-config&quot;</span> deleted
<span class="token function">service</span> <span class="token string">&quot;playerstats-operator-controller-manager-metrics-service&quot;</span> deleted
deployment.apps <span class="token string">&quot;playerstats-operator-controller-manager&quot;</span> deleted
</code></pre>
<p>&#x5E94;&#x8BE5;&#x786E;&#x4FDD;&#x5728;&#x5220;&#x9664; Operator &#x4E4B;&#x524D;&#x5148;&#x5220;&#x9664; CR&#x3002;&#x5F53;&#x4F60;&#x5220;&#x9664; CR &#x65F6;&#xFF0C;Operator &#x4F1A;&#x6267;&#x884C; <strong>helm uninstall</strong> &#x547D;&#x4EE4;&#x3002;&#x5982;&#x679C;&#x4F60;&#x4E0D;&#x5C0F;&#x5FC3;&#x5148;&#x5220;&#x9664;&#x4E86; Operator&#xFF0C;&#x9700;&#x8981;&#x624B;&#x52A8;&#x8FD0;&#x884C; <strong>helm uninstall</strong>&#xFF0C;&#x5220;&#x9664;&#x76F8;&#x5173;&#x8D44;&#x6E90;&#x3002;</p>
<p>&#x5728;&#x672C;&#x8282;&#x4E2D;&#xFF0C;&#x4F60;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A; Helm operator &#xFF0C;&#x5E76;&#x5B66;&#x4E60;&#x4E86;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x57FA;&#x4E8E; operator &#x7684;&#x65B9;&#x6CD5;&#x90E8;&#x7F72;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;&#x5728;&#x4E0B;&#x4E00;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x7EE7;&#x7EED;&#x8BA8;&#x8BBA;&#x5982;&#x4F55;&#x4F7F;&#x7528; Helm &#x6765;&#x7BA1;&#x7406; operators&#x3002;</p>
<p>Operator &#x7684;&#x76F8;&#x5173;&#x77E5;&#x8BC6;&#x5C31;&#x8BA8;&#x8BBA;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x6E05;&#x7406;&#x5B9E;&#x9A8C;&#x73AF;&#x5883;&#x3002;</p>
<h2 id="85-&#x6E05;&#x7406;-kubernetes-&#x73AF;&#x5883;">8.5 &#x6E05;&#x7406; Kubernetes &#x73AF;&#x5883;</h2>
<p>&#x5220;&#x9664; operators &#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ kubectl delete ns operators
</code></pre>
<p>&#x6700;&#x540E;&#xFF0C;&#x505C;&#x6B62;&#x8FD0;&#x884C;Minikube&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">$ minikube stop
</code></pre>
<footer class="page-footer-ex"> <span class="page-footer-ex-copyright"> By <a href="https://github.com/weiwendi" target="_blank">&#x9B4F;&#x6587;&#x5F1F;</a>&#xFF0C;&#x4F7F;&#x7528;<a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">&#x77E5;&#x8BC6;&#x5171;&#x4EAB; &#x7F72;&#x540D;-&#x76F8;&#x540C;&#x65B9;&#x5F0F;&#x5171;&#x4EAB; 4.0 &#x56FD;&#x9645;&#x534F;&#x8BAE;</a>&#x53D1;&#x5E03; </span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; <span class="page-footer-ex-footer-update"> <i>updated</i> 2021-08-31 14:21:05 </span> </footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="helmcicd.html" class="navigation navigation-prev " aria-label="Previous page: 使用 CI/CD 和 GitOps 实现 Helm 自动化">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="plugins.html" class="navigation navigation-next " aria-label="Next page: Helm 插件">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Helm 与 Operator","level":"2.8","depth":1,"next":{"title":"Helm 插件","level":"2.9","depth":1,"path":"helm/plugins.md","ref":"helm/plugins.md","articles":[]},"previous":{"title":"使用 CI/CD 和 GitOps 实现 Helm 自动化","level":"2.7","depth":1,"path":"helm/helmcicd.md","ref":"helm/helmcicd.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-highlight","-lunr","-search","prism","prism-themes","github","donate","codesnippet","ga","adsense","github-buttons@2.1.0","splitter","simple-page-toc","page-toc-button","image-captions","back-to-top-button","search-plus","sharing-plus","favicon","theme-default","page-footer-ex","search-pro","code","auto-scroll-table","advanced-emoji","flexible-alerts","editlink"],"ignores":["_book","node_modules"],"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"},"pluginsConfig":{"prism":{"css":["prism-themes/themes/prism-base16-ateliersulphurpool.light.css"],"lang":{"shell":"bash"}},"github":{"url":"https://github.com/weiwendi/cloudnative-handbook"},"editlink":{"label":"编辑本页","multilingual":false,"base":"https://github.com/weiwendi/cloudnative-handbook/tree/main"},"simple-page-toc":{"maxDepth":3,"skipFirstH1":true},"page-footer-ex":{"copyright":"By [魏文弟](https://github.com/weiwendi)，使用[知识共享 署名-相同方式共享 4.0 国际协议](https://creativecommons.org/licenses/by-sa/4.0/)发布","markdown":true,"update_format":"YYYY-MM-DD HH:mm:ss","update_label":"<i>updated</i>"},"splitter":{},"search-pro":{},"adsense":{"client":"pub-8736620102237076","slot":"","format":"auto","element":".page-inner section","position":"bottom"},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"auto-scroll-table":{},"code":{"copyButtons":true},"donate":{"alipay":"https://gitee.com/sretech/images/raw/master/pays/alipay.jpg","alipayText":"支付宝","button":"请杯咖啡","title":"","wechat":"https://gitee.com/sretech/images/raw/master/pays/wechatpay.jpg","wechatText":"微信"},"codesnippet":{},"fontsettings":{"theme":"white","family":"sans","size":2},"favicon":{"shortcut":"https://gitee.com/sretech/images/raw/master/favicon/favicon.ico","bookmark":"https://gitee.com/sretech/images/raw/master/favicon/favicon.ico"},"page-toc-button":{},"back-to-top-button":{},"prism-themes":{},"github-buttons":{"user":"weiwendi","repo":"cloudnative-handbook","types":["star"],"size":"small"},"flexible-alerts":{"danger":{"className":"danger","icon":"fa fa-ban","label":"Attention"},"note":{"className":"info","icon":"fa fa-info-circle","label":"Note"},"style":"callout","tip":{"className":"tip","icon":"fa fa-lightbulb-o","label":"Tip"},"warning":{"className":"warning","icon":"fa fa-exclamation-triangle","label":"Warning"},"comment":{"label":"Comment","icon":"fa fa-comments","className":"info"}},"ga":{"configuration":"auto","token":"UA-174057096-1"},"advanced-emoji":{"embedEmojis":false},"sharing":{"qq":true,"all":["douban","facebook","google","linkedin","twitter","weibo","messenger","qq","qzone"],"facebook":false,"weibo":false,"instapaper":false,"twitter":false,"vk":false,"google":false,"qzone":true},"theme-default":{"showLevel":true,"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"}},"search-plus":{},"image-captions":{"caption":"_CAPTION_","variable_name":"_pictures"}},"theme":"default","author":"魏文弟","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"_pictures":[{"backlink":"helm/jieshao.html#fig2.1.1","level":"2.1","list_caption":"Figure: 1.2dtcreate","alt":"1.2dtcreate","nro":1,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/1.2dtcreate.jpg","index":1,"caption_template":"_CAPTION_","label":"1.2dtcreate","attributes":{},"skip":false,"key":"2.1.1"},{"backlink":"helm/jieshao.html#fig2.1.2","level":"2.1","list_caption":"Figure: 1.3Service","alt":"1.3Service","nro":2,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/1.3Service.jpg","index":2,"caption_template":"_CAPTION_","label":"1.3Service","attributes":{},"skip":false,"key":"2.1.2"},{"backlink":"helm/jieshao.html#fig2.1.3","level":"2.1","list_caption":"Figure: 1.4-storageclass","alt":"1.4-storageclass","nro":3,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/1.4-storageclass.jpg","index":3,"caption_template":"_CAPTION_","label":"1.4-storageclass","attributes":{},"skip":false,"key":"2.1.3"},{"backlink":"helm/jieshao.html#fig2.1.4","level":"2.1","list_caption":"Figure: 1.6-Upgrade","alt":"1.6-Upgrade","nro":4,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/1.6-Upgrade.jpg","index":4,"caption_template":"_CAPTION_","label":"1.6-Upgrade","attributes":{},"skip":false,"key":"2.1.4"},{"backlink":"helm/bushu.html#fig2.2.1","level":"2.2","list_caption":"Figure: 2.1versions","alt":"2.1versions","nro":5,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/2.1versions.png","index":1,"caption_template":"_CAPTION_","label":"2.1versions","attributes":{},"skip":false,"key":"2.2.1"},{"backlink":"helm/bushu.html#fig2.2.2","level":"2.2","list_caption":"Figure: 2.2minikubeDrivers","alt":"2.2minikubeDrivers","nro":6,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/2.2minikubeDrivers.jpg","index":2,"caption_template":"_CAPTION_","label":"2.2minikubeDrivers","attributes":{},"skip":false,"key":"2.2.2"},{"backlink":"helm/anzhuangcharts.html#fig2.3.1","level":"2.3","list_caption":"Figure: 3.1 helm search hub wordpress outputs","alt":"3.1 helm search hub wordpress outputs","nro":7,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/3.1hubouts.jpg","index":1,"caption_template":"_CAPTION_","label":"3.1 helm search hub wordpress outputs","attributes":{},"skip":false,"key":"2.3.1"},{"backlink":"helm/anzhuangcharts.html#fig2.3.2","level":"2.3","list_caption":"Figure: 3.2 helm search hub wordpress yaml outputs","alt":"3.2 helm search hub wordpress yaml outputs","nro":8,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/3.2hubyamloutps.png","index":2,"caption_template":"_CAPTION_","label":"3.2 helm search hub wordpress yaml outputs","attributes":{},"skip":false,"key":"2.3.2"},{"backlink":"helm/anzhuangcharts.html#fig2.3.3","level":"2.3","list_caption":"Figure: 3.3 wordpress page details","alt":"3.3 wordpress page details","nro":9,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/3.3wordpressdetails.jpg","index":3,"caption_template":"_CAPTION_","label":"3.3 wordpress page details","attributes":{},"skip":false,"key":"2.3.3"},{"backlink":"helm/anzhuangcharts.html#fig2.3.4","level":"2.3","list_caption":"Figure: 3.4 bitnami wordpress","alt":"3.4 bitnami wordpress","nro":10,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/3.4bitnamiwordpress.jpg","index":4,"caption_template":"_CAPTION_","label":"3.4 bitnami wordpress","attributes":{},"skip":false,"key":"2.3.4"},{"backlink":"helm/anzhuangcharts.html#fig2.3.5","level":"2.3","list_caption":"Figure: 3.5 show chart","alt":"3.5 show chart","nro":11,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/3.5showchart.jpg","index":5,"caption_template":"_CAPTION_","label":"3.5 show chart","attributes":{},"skip":false,"key":"2.3.5"},{"backlink":"helm/anzhuangcharts.html#fig2.3.6","level":"2.3","list_caption":"Figure: 3.6 wordpress 首页","alt":"3.6 wordpress 首页","nro":12,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/3.8wordpresspage.jpg","index":6,"caption_template":"_CAPTION_","label":"3.6 wordpress 首页","attributes":{},"skip":false,"key":"2.3.6"},{"backlink":"helm/anzhuangcharts.html#fig2.3.7","level":"2.3","list_caption":"Figure: 3.7 admin pages","alt":"3.7 admin pages","nro":13,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/3.9adminpage.jpg","index":7,"caption_template":"_CAPTION_","label":"3.7 admin pages","attributes":{},"skip":false,"key":"2.3.7"},{"backlink":"helm/anzhuangcharts.html#fig2.3.8","level":"2.3","list_caption":"Figure: 3.8 dashboard","alt":"3.8 dashboard","nro":14,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/3.10adminpage2.png","index":8,"caption_template":"_CAPTION_","label":"3.8 dashboard","attributes":{},"skip":false,"key":"2.3.8"},{"backlink":"helm/kaifacharts.html#fig2.5.1","level":"2.5","list_caption":"Figure: 5.1 player stats page","alt":"5.1 player stats page","nro":15,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/5.1player-stats.jpg","index":1,"caption_template":"_CAPTION_","label":"5.1 player stats page","attributes":{},"skip":false,"key":"2.5.1"},{"backlink":"helm/helmcicd.html#fig2.7.1","level":"2.7","list_caption":"Figure: 7.1 fork","alt":"7.1 fork","nro":16,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.1fork.png","index":1,"caption_template":"_CAPTION_","label":"7.1 fork","attributes":{},"skip":false,"key":"2.7.1"},{"backlink":"helm/helmcicd.html#fig2.7.2","level":"2.7","list_caption":"Figure: 7.2 delete tar and index file","alt":"7.2 delete tar and index file","nro":17,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.2delete.jpg","index":2,"caption_template":"_CAPTION_","label":"7.2 delete tar and index file","attributes":{},"skip":false,"key":"2.7.2"},{"backlink":"helm/helmcicd.html#fig2.7.3","level":"2.7","list_caption":"Figure: 7.3 create github token.","alt":"7.3 create github token.","nro":18,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.3%20create%20github%20token.jpg","index":3,"caption_template":"_CAPTION_","label":"7.3 create github token.","attributes":{},"skip":false,"key":"2.7.3"},{"backlink":"helm/helmcicd.html#fig2.7.4","level":"2.7","list_caption":"Figure: 7.4 create jenkins github credentials","alt":"7.4 create jenkins github credentials","nro":19,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.4%20create%20github%20credentials.jpg","index":4,"caption_template":"_CAPTION_","label":"7.4 create jenkins github credentials","attributes":{},"skip":false,"key":"2.7.4"},{"backlink":"helm/helmcicd.html#fig2.7.5","level":"2.7","list_caption":"Figure: 7.5 create jenkins kubeconfig credentials","alt":"7.5 create jenkins kubeconfig credentials","nro":20,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.5%20create%20kubernetes%20credentials.jpg","index":5,"caption_template":"_CAPTION_","label":"7.5 create jenkins kubeconfig credentials","attributes":{},"skip":false,"key":"2.7.5"},{"backlink":"helm/helmcicd.html#fig2.7.6","level":"2.7","list_caption":"Figure: 7.6 add repo","alt":"7.6 add repo","nro":21,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.6%20add%20https%20github%20repository.png","index":6,"caption_template":"_CAPTION_","label":"7.6 add repo","attributes":{},"skip":false,"key":"2.7.6"},{"backlink":"helm/helmcicd.html#fig2.7.7","level":"2.7","list_caption":"Figure: 7.8 scan repo","alt":"7.8 scan repo","nro":22,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.8%20scan%20repository%20build.jpg","index":7,"caption_template":"_CAPTION_","label":"7.8 scan repo","attributes":{},"skip":false,"key":"2.7.7"},{"backlink":"helm/helmcicd.html#fig2.7.8","level":"2.7","list_caption":"Figure: 7.9 charts repo list","alt":"7.9 charts repo list","nro":23,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.9%20charts%20repo%20list.jpg","index":8,"caption_template":"_CAPTION_","label":"7.9 charts repo list","attributes":{},"skip":false,"key":"2.7.8"},{"backlink":"helm/helmcicd.html#fig2.7.9","level":"2.7","list_caption":"Figure: 7.10 stable list","alt":"7.10 stable list","nro":24,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.10%20stable%20list.jpg","index":9,"caption_template":"_CAPTION_","label":"7.10 stable list","attributes":{},"skip":false,"key":"2.7.9"},{"backlink":"helm/helmcicd.html#fig2.7.10","level":"2.7","list_caption":"Figure: 7.11 Proceed or Abort","alt":"7.11 Proceed or Abort","nro":25,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/Figure_7.17.jpg","index":10,"caption_template":"_CAPTION_","label":"7.11 Proceed or Abort","attributes":{},"skip":false,"key":"2.7.10"},{"backlink":"helm/operator.html#fig2.8.1","level":"2.8","list_caption":"Figure: 8.1 cr install helm chart","alt":"8.1 cr install helm chart","nro":26,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/8.1%20cr%20install%20chart.jpg","index":1,"caption_template":"_CAPTION_","label":"8.1 cr install helm chart","attributes":{},"skip":false,"key":"2.8.1"},{"backlink":"helm/operator.html#fig2.8.2","level":"2.8","list_caption":"Figure: 8.2 create quay image repo","alt":"8.2 create quay image repo","nro":27,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/8.2%20create%20quay%20image%20repo.jpg","index":2,"caption_template":"_CAPTION_","label":"8.2 create quay image repo","attributes":{},"skip":false,"key":"2.8.2"},{"backlink":"helm/operator.html#fig2.8.3","level":"2.8","list_caption":"Figure: 8.3 create public image repository","alt":"8.3 create public image repository","nro":28,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/8.3%20create%20public%20image%20repository.jpg","index":3,"caption_template":"_CAPTION_","label":"8.3 create public image repository","attributes":{},"skip":false,"key":"2.8.3"},{"backlink":"helm/operator.html#fig2.8.4","level":"2.8","list_caption":"Figure: 8.4 player stats operator image","alt":"8.4 player stats operator image","nro":29,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/8.4%20player%20stats%20operator%20image.jpg","index":4,"caption_template":"_CAPTION_","label":"8.4 player stats operator image","attributes":{},"skip":false,"key":"2.8.4"},{"backlink":"helm/security.html#fig2.10.1","level":"2.10","list_caption":"Figure: 9.1 gpg outputs","alt":"9.1 gpg outputs","nro":30,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/9.1%20gpg%20infors.jpg","index":1,"caption_template":"_CAPTION_","label":"9.1 gpg outputs","attributes":{},"skip":false,"key":"2.10.1"},{"backlink":"helm/security.html#fig2.10.2","level":"2.10","list_caption":"Figure: 9.2 helm versions","alt":"9.2 helm versions","nro":31,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/9.2%20helm%20release%20download.jpg","index":2,"caption_template":"_CAPTION_","label":"9.2 helm versions","attributes":{},"skip":false,"key":"2.10.2"},{"backlink":"helm/security.html#fig2.10.3","level":"2.10","list_caption":"Figure: 9.3 digital signature","alt":"9.3 digital signature","nro":32,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/9.3%20digital%20signature.jpg","index":3,"caption_template":"_CAPTION_","label":"9.3 digital signature","attributes":{},"skip":false,"key":"2.10.3"}]},"title":"云原生运维指南","language":"zh-hans","links":{"sidebar":{"博客":"https://www.aiops.red","公众号: sretech":"https://gitee.com/sretech/images/raw/master/wechatpublic.jpg"}},"gitbook":"*","description":"从理论到实践系统介绍云原生环境下的运维"},"file":{"path":"helm/operator.md","mtime":"2021-08-31T06:21:05.742Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-09-01T09:21:34.056Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-donate/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-adsense/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github-buttons/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-page-toc-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-auto-scroll-table/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-flexible-alerts/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-editlink/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>



<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>使用 CI/CD 和 GitOps 实现 Helm 自动化 · 云原生运维指南</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="魏文弟">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-base16-ateliersulphurpool.light.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-donate/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-toc-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-image-captions/image-captions.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-footer-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-auto-scroll-table/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-advanced-emoji/emoji-website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-flexible-alerts/style.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="operator.html" />
    
    
    <link rel="prev" href="ceshicharts.html" />
    

    
        <link rel="shortcut icon" href='../https:/gitee.com/sretech/images/raw/master/favicon/favicon.ico' type="image/x-icon">
    
    
        <link rel="bookmark" href='../https:/gitee.com/sretech/images/raw/master/favicon/favicon.ico' type="image/x-icon">
    
    
    

    <style>
    @media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }
    </style>
    <script>
        window["gitbook-plugin-github-buttons"] = {"user":"weiwendi","repo":"cloudnative-handbook","types":["star"],"size":"small"};
    </script>

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://www.aiops.red" target="_blank" class="custom-link">博客</a>
        </li>
    
        
        <li>
            <a href="https://gitee.com/sretech/images/raw/master/wechatpublic.jpg" target="_blank" class="custom-link">公众号: sretech</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        <li class="header">云原生运维指南</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                        <b>1.1.</b>
                    
                    序言
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../cloudnative/jieshao.html">
            
                <a href="../cloudnative/jieshao.html">
            
                    
                        <b>1.2.</b>
                    
                    课程介绍
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Helm 最佳实践</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="jieshao.html">
            
                <a href="jieshao.html">
            
                    
                        <b>2.1.</b>
                    
                    Kubernetes and Helm 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="bushu.html">
            
                <a href="bushu.html">
            
                    
                        <b>2.2.</b>
                    
                    Helm 部署
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="anzhuangcharts.html">
            
                <a href="anzhuangcharts.html">
            
                    
                        <b>2.3.</b>
                    
                    安装 Helm 图表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="chartsjinjie.html">
            
                <a href="chartsjinjie.html">
            
                    
                        <b>2.4.</b>
                    
                    Helm 图表进阶
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="kaifacharts.html">
            
                <a href="kaifacharts.html">
            
                    
                        <b>2.5.</b>
                    
                    开发 Helm 图表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="ceshicharts.html">
            
                <a href="ceshicharts.html">
            
                    
                        <b>2.6.</b>
                    
                    测试 Helm 图表
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.7" data-path="helmcicd.html">
            
                <a href="helmcicd.html">
            
                    
                        <b>2.7.</b>
                    
                    使用 CI/CD 和 GitOps 实现 Helm 自动化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="operator.html">
            
                <a href="operator.html">
            
                    
                        <b>2.8.</b>
                    
                    Helm 与 Operator
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="plugins.html">
            
                <a href="plugins.html">
            
                    
                        <b>2.9.</b>
                    
                    Helm 插件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.10" data-path="security.html">
            
                <a href="security.html">
            
                    
                        <b>2.10.</b>
                    
                    Helm 安全
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >使用 CI/CD 和 GitOps 实现 Helm 自动化</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="&#x4F7F;&#x7528;-cicd-&#x548C;-gitops-&#x5B9E;&#x73B0;-helm-&#x81EA;&#x52A8;&#x5316;">&#x4F7F;&#x7528; CI/CD &#x548C; GitOps &#x5B9E;&#x73B0; Helm &#x81EA;&#x52A8;&#x5316;</h1>
<p>&#x622A;&#x6B62;&#x5230;&#x672C;&#x7AE0;&#xFF0C;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x8BA8;&#x8BBA;&#x4E86;&#x4E24;&#x4E2A; Helm &#x7684;&#x9AD8;&#x7EA7;&#x7528;&#x6CD5;&#x3002;&#x7B2C;&#x4E00;&#x4E2A;&#x662F;&#x5C06; Helm &#x4F5C;&#x4E3A;&#x5305;&#x7BA1;&#x7406;&#x5668;&#xFF0C;&#x5728; Kubernetes &#x96C6;&#x7FA4;&#x4E2D;&#x90E8;&#x7F72;&#x5404;&#x79CD;&#x590D;&#x6742;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;&#x7B2C;&#x4E8C;&#x4E2A;&#x662F;&#x5F00;&#x53D1;&#x548C;&#x6D4B;&#x8BD5; Helm &#x56FE;&#x8868;&#xFF0C;&#x5C06; Kubernetes &#x7684;&#x590D;&#x6742;&#x6027;&#x5C01;&#x88C5;&#x5728; Helm &#x56FE;&#x8868;&#x4E2D;&#xFF0C;&#x5E76;&#x5BF9;&#x56FE;&#x8868;&#x6267;&#x884C;&#x6D4B;&#x8BD5;&#xFF0C;&#x786E;&#x4FDD;&#x6210;&#x529F;&#x4EA4;&#x4ED8;&#x4E86;&#x7528;&#x6237;&#x6240;&#x9700;&#x7684;&#x529F;&#x80FD;&#x3002;</p>
<p>&#x8FD9;&#x4E24;&#x79CD;&#x64CD;&#x4F5C;&#xFF0C;&#x90FD;&#x4F7F;&#x7528;&#x4E86;&#x591A;&#x4E2A;&#x4E0D;&#x540C;&#x7684; Helm Cli &#x547D;&#x4EE4;&#xFF0C;&#x8FD9;&#x4E9B;&#x547D;&#x4EE4;&#x867D;&#x7136;&#x80FD;&#x6709;&#x6548;&#x5730;&#x5B8C;&#x6210;&#x4EFB;&#x52A1;&#xFF0C;&#x4F46;&#x4E0D;&#x591F;&#x6709;&#x6548;&#x7387;&#xFF0C;&#x9700;&#x8981;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x624B;&#x52A8;&#x6267;&#x884C;&#x3002;&#x5728;&#x7BA1;&#x7406;&#x591A;&#x4E2A;&#x56FE;&#x8868;&#x6216;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x65F6;&#xFF0C;&#x624B;&#x52A8;&#x6267;&#x884C;&#x4F1A;&#x6210;&#x4E3A;&#x74F6;&#x9888;&#xFF0C;&#x5BFC;&#x81F4;&#x73AF;&#x5883;&#x96BE;&#x4EE5;&#x7EF4;&#x62A4;&#x548C;&#x6269;&#x5C55;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x5728; Helm &#x7684;&#x57FA;&#x7840;&#x4E0A;&#x63D0;&#x4F9B;&#x989D;&#x5916;&#x7684;&#x81EA;&#x52A8;&#x5316;&#x529F;&#x80FD;&#x3002;&#x672C;&#x7AE0;&#x6211;&#x4EEC;&#x8BA8;&#x8BBA;&#x6301;&#x7EED;&#x96C6;&#x6210;&#x548C;&#x6301;&#x7EED;&#x4EA4;&#x4ED8;(CI/CD)&#x4EE5;&#x53CA; GitOps &#x7684;&#x76F8;&#x5173;&#x6982;&#x5FF5;&#xFF0C;&#x8FD9;&#x4E9B;&#x6982;&#x5FF5;&#x662F;&#x81EA;&#x52A8;&#x8C03;&#x7528; Helm Cli &#x548C;&#x5176;&#x4ED6;&#x547D;&#x4EE4;&#x7684;&#x65B9;&#x6CD5;&#x8BBA;&#xFF0C;&#x5B9E;&#x73B0;&#x5BF9; Git &#x4ED3;&#x5E93;&#x6267;&#x884C;&#x81EA;&#x52A8;&#x5316;&#x6D41;&#x7A0B;&#xFF0C;&#x8FD9;&#x4E9B;&#x6D41;&#x7A0B;&#x5305;&#x62EC;&#x5728;&#x56FE;&#x8868;&#x5F00;&#x53D1;&#x8FC7;&#x7A0B;&#x4E2D;&#x6784;&#x5EFA;&#x3001;&#x6D4B;&#x8BD5;&#x548C;&#x6253;&#x5305;&#x56FE;&#x8868;&#xFF0C;&#x4F7F;&#x7528; Helm &#x81EA;&#x52A8;&#x90E8;&#x7F72;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</p>
<p>&#x672C;&#x7AE0;&#x7684;&#x5B66;&#x4E60;&#x91CD;&#x70B9;&#xFF1A;</p>
<ul>
<li>&#x7406;&#x89E3; CI/CD &#x548C; GitOps</li>
<li>&#x8BBE;&#x7F6E;&#x6240;&#x9700;&#x73AF;&#x5883;</li>
<li>&#x521B;&#x5EFA; CI &#x7BA1;&#x9053;&#x6784;&#x5EFA; Helm &#x56FE;&#x8868;</li>
<li>&#x521B;&#x5EFA; CD &#x7BA1;&#x9053;&#x90E8;&#x7F72; Helm &#x56FE;&#x8868;</li>
</ul>
<h2 id="cicd-&#x548C;-gitops-&#x4ECB;&#x7ECD;">CI/CD &#x548C; GitOps &#x4ECB;&#x7ECD;</h2>
<p>&#x8FC4;&#x4ECA;&#x4E3A;&#x6B62;&#xFF0C;&#x6211;&#x4EEC;&#x8BA8;&#x8BBA;&#x4E86;&#x8BB8;&#x591A; Helm &#x5F00;&#x53D1;&#x3001;&#x6D4B;&#x8BD5;&#x3001;&#x90E8;&#x7F72;&#x7684;&#x76F8;&#x5173;&#x6982;&#x5FF5;&#xFF0C;&#x4F46;&#x8FD9;&#x4E9B;&#x4EC5;&#x9650;&#x4E8E;&#x624B;&#x52A8;&#x914D;&#x7F6E;&#x548C;&#x8C03;&#x7528; Helm Cli &#x5B9E;&#x73B0;&#x3002;&#x867D;&#x7136;&#x5728;&#x521D;&#x5B66; Helm &#x65F6;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x505A;&#xFF0C;&#x4F46;&#x5F53;&#x4F60;&#x51C6;&#x5907;&#x5C06;&#x56FE;&#x8868;&#x90E8;&#x7F72;&#x5230;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#xFF0C;&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E00;&#x5C55;&#x8EAB;&#x624B;&#x65F6;&#xFF0C;&#x5C31;&#x4E0D;&#x5F97;&#x4E0D;&#x8003;&#x8651;&#x4EE5;&#x4E0B;&#x4E24;&#x4E2A;&#x95EE;&#x9898;&#x4E86;&#xFF1A;</p>
<ul>
<li>&#x5982;&#x4F55;&#x624D;&#x80FD;&#x786E;&#x4FDD;&#x56FE;&#x8868;&#x5F00;&#x53D1;&#x548C;&#x90E8;&#x7F72;&#x9075;&#x5FAA;&#x4E86;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#xFF1F;</li>
<li>&#x65B0;&#x6210;&#x5458;&#x52A0;&#x5165;&#x65F6;&#x4F1A;&#x5BF9;&#x5F00;&#x53D1;&#x548C;&#x90E8;&#x7F72;&#x8FC7;&#x7A0B;&#x4EA7;&#x751F;&#x4EC0;&#x4E48;&#x5F71;&#x54CD;&#xFF1F;</li>
</ul>
<p>&#x8FD9;&#x4E24;&#x4E2A;&#x95EE;&#x9898;&#x9002;&#x7528;&#x4E8E;&#x4EFB;&#x4F55;&#x8F6F;&#x4EF6;&#x9879;&#x76EE;&#xFF0C;&#x800C;&#x4E0D;&#x4EC5;&#x662F; Helm &#x56FE;&#x8868;&#x5F00;&#x53D1;&#x3002;&#x867D;&#x7136;&#x5230;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x4ECB;&#x7ECD;&#x4E86;&#x5F88;&#x591A;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#xFF0C;&#x4F46;&#x5728;&#x6709;&#x65B0;&#x6210;&#x5458;&#x52A0;&#x5165;&#x65F6;&#xFF0C;&#x4ED6;&#x4EEC;&#x53EF;&#x80FD;&#x5BF9;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x7406;&#x89E3;&#xFF0C;&#x751A;&#x81F3;&#x5728;&#x6267;&#x884C;&#x5173;&#x952E;&#x6B65;&#x9AA4;&#x65F6;&#x7F3A;&#x4E4F;&#x7EAA;&#x5F8B;&#x6027;&#x3002;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x81EA;&#x52A8;&#x5316;&#x548C;&#x53EF;&#x91CD;&#x590D;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x5EFA;&#x7ACB;&#x8BF8;&#x5982; CI/CD &#x4E4B;&#x7C7B;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x5176;&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x6311;&#x6218;&#x3002;</p>
<h3 id="cicd">CI/CD</h3>
<p>&#x6BCF;&#x6B21;&#x8F6F;&#x4EF6;&#x53D8;&#x66F4;&#x65F6;&#xFF0C;&#x90FD;&#x671F;&#x671B;&#x6709;&#x81EA;&#x52A8;&#x5316;&#x7684;&#x8F6F;&#x4EF6;&#x5F00;&#x53D1;&#x8FC7;&#x7A0B;&#xFF0C;&#x8FD9;&#x5C31;&#x662F; CI &#x4EA7;&#x751F;&#x7684;&#x80CC;&#x666F;&#x3002;CI &#x4E0D;&#x4EC5;&#x786E;&#x4FDD;&#x4E86;&#x8F6F;&#x4EF6;&#x53D8;&#x66F4;&#x8FC7;&#x7A0B;&#x9075;&#x5FAA;&#x4E86;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#xFF0C;&#x800C;&#x4E14;&#x6709;&#x52A9;&#x4E8E;&#x907F;&#x514D;&#x8BB8;&#x591A;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x9762;&#x4E34;&#x7684;&#x5171;&#x540C;&#x95EE;&#x9898;&#xFF1A;&#x201C;&#x5728;&#x6211;&#x7684;&#x673A;&#x5668;&#x4E0A;&#x5C31;&#x80FD;&#x6B63;&#x5E38;&#x8FD0;&#x884C;&#xFF0C;&#x600E;&#x4E48;&#x90E8;&#x7F72;&#x5728;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x5C31;&#x4E0D;&#x884C;&#x4E86;&#x5462;&#xFF1F;&#x201D;&#x3002;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x8BA8;&#x8BBA;&#x8FC7;&#x4F7F;&#x7528;&#x7248;&#x672C;&#x63A7;&#x5236;&#x7CFB;&#x7EDF;(&#x5982; git)&#x5B58;&#x50A8;&#x4EE3;&#x7801;&#xFF0C;&#x901A;&#x5E38;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x72EC;&#x7ACB;&#x7684;&#x6E90;&#x4EE3;&#x7801;&#x526F;&#x672C;&#xFF0C;&#x8FD9;&#x5C31;&#x5BFC;&#x81F4;&#x7EF4;&#x62A4;&#x4EE3;&#x7801;&#x5E93;&#x4F1A;&#x5F88;&#x56F0;&#x96BE;&#xFF0C;&#x56E0;&#x4E3A;&#x5176;&#x4ED6;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x4E5F;&#x4F1A;&#x63D0;&#x4EA4;&#x4EE3;&#x7801;&#x3002;</p>
<p>CI &#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x81EA;&#x52A8;&#x5316;&#x5DE5;&#x5177;&#x5B9E;&#x73B0;&#xFF0C;&#x6BCF;&#x6B21;&#x4EE3;&#x7801;&#x53D1;&#x751F;&#x66F4;&#x6539;&#x65F6;&#xFF0C;&#x81EA;&#x52A8;&#x5316;&#x5DE5;&#x5177;&#x90FD;&#x4F1A;&#x68C0;&#x7D22;&#x4EE3;&#x7801;&#x5E76;&#x6267;&#x884C;&#x9884;&#x5B9A;&#x6B65;&#x9AA4;&#x3002;&#x5E38;&#x7528;&#x7684;&#x81EA;&#x52A8;&#x5316;&#x5DE5;&#x5177;&#x5305;&#x62EC; Jenkins&#x3001;TeamCity&#xFF0C;&#x4EE5;&#x53CA;&#x5404;&#x79CD;&#x57FA;&#x4E8E;&#x8F6F;&#x4EF6;&#x5373;&#x670D;&#x52A1;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;&#x6709;&#x4E86;&#x8FD9;&#x4E9B;&#x81EA;&#x52A8;&#x5316;&#x5DE5;&#x5177;&#x7684;&#x52A0;&#x6301;&#xFF0C;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x53EF;&#x4EE5;&#x5C06;&#x66F4;&#x591A;&#x7CBE;&#x529B;&#x7528;&#x4E8E;&#x4EE3;&#x7801;&#x7F16;&#x5199;&#xFF0C;&#x5E76;&#x80FD;&#x591F;&#x9891;&#x7E41;&#x5730;&#x63D0;&#x4EA4;&#x4EE3;&#x7801;&#xFF0C;&#x8FDB;&#x800C;&#x66F4;&#x5FEB;&#x7684;&#x3001;&#x66F4;&#x5B89;&#x5168;&#x7684;&#x4EA4;&#x4ED8;&#x8F6F;&#x4EF6;&#x3002;</p>
<p>&#x8FD9;&#x4E9B;&#x5DE5;&#x5177;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x5173;&#x952E;&#x7279;&#x6027;&#xFF0C;&#x5C31;&#x662F;&#x80FD;&#x591F;&#x53CA;&#x65F6;&#x62A5;&#x544A;&#x9879;&#x76EE;&#x7684;&#x5F53;&#x524D;&#x72B6;&#x6001;&#x3002;&#x4E0E;&#x5728;&#x8F6F;&#x4EF6;&#x5F00;&#x53D1;&#x5468;&#x671F;&#x7684;&#x6700;&#x540E;&#x9636;&#x6BB5;&#x53D1;&#x73B0;&#x7834;&#x574F;&#x6027;&#x7684;&#x53D8;&#x66F4;&#x4E0D;&#x540C;&#xFF0C;&#x901A;&#x8FC7;&#x4F7F;&#x7528; CI&#xFF0C;&#x4E00;&#x65E6;&#x5728;&#x4EE3;&#x7801;&#x5206;&#x652F;&#x4E2D;&#x5408;&#x5E76;&#x4E86;&#x53D8;&#x66F4;&#xFF0C;&#x5C31;&#x4F1A;&#x6267;&#x884C;&#x6D41;&#x7A0B;&#xFF0C;&#x5E76;&#x5C06;&#x7ED3;&#x679C;&#x901A;&#x77E5;&#x5230;&#x76F8;&#x5173;&#x4EBA;&#x5458;&#x3002;&#x5FEB;&#x901F;&#x901A;&#x77E5;&#x7684;&#x673A;&#x5236;&#xFF0C;&#x4E3A;&#x5F15;&#x5165;&#x53D8;&#x66F4;&#x7684;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x63D0;&#x4F9B;&#x4E86;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x7684;&#x65F6;&#x673A;&#xFF0C;&#x8BA9;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x5728;&#x4EE3;&#x7801;&#x7684;&#x5F00;&#x53D1;&#x9636;&#x6BB5;&#x5C31;&#x80FD;&#x88AB;&#x53D1;&#x73B0;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5728;&#x4EA4;&#x4ED8;&#x9636;&#x6BB5;&#x3002;</p>
<p>&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6700;&#x7EC8;&#x4EA4;&#x4ED8;&#x662F;&#x8981;&#x8FD0;&#x884C;&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x7684;&#xFF0C;&#x501F;&#x9274;&#x8F6F;&#x4EF6;&#x4EA4;&#x4ED8;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E2D;&#x8BB8;&#x591A; CI &#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x8BDE;&#x751F;&#x4E86; CD&#x3002;CD &#x662F;&#x4E00;&#x7EC4;&#x5B9A;&#x4E49;&#x597D;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x901A;&#x8FC7;&#x53D1;&#x5E03;&#x8FC7;&#x7A0B;(&#x901A;&#x5E38;&#x662F;&#x7BA1;&#x9053;)&#x53D1;&#x5E03;&#x8F6F;&#x4EF6;&#x3002;CI &#x548C; CD &#x7ECF;&#x5E38;&#x642D;&#x914D;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x56E0;&#x4E3A; CI &#x7684;&#x6267;&#x884C;&#x5F15;&#x64CE;&#x4E5F;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0; CD&#x3002;CD &#x5DF2;&#x7ECF;&#x5F97;&#x5230;&#x4E86;&#x8BB8;&#x591A;&#x7EC4;&#x7EC7;&#x548C;&#x516C;&#x53F8;&#x7684;&#x8BA4;&#x53EF;&#xFF0C;&#x5E76;&#x8D8A;&#x6765;&#x8D8A;&#x6D41;&#x884C;&#xFF0C;&#x5728;&#x8FD9;&#x4E9B;&#x516C;&#x53F8;&#x4E2D;&#xFF0C;&#x4E3A;&#x4E86;&#x4F7F;&#x8F6F;&#x4EF6;&#x7684;&#x53D1;&#x5E03;&#x8FC7;&#x7A0B;&#x66F4;&#x8FDB;&#x4E00;&#x6B65;&#xFF0C;&#x9700;&#x8981;&#x5B9E;&#x65BD;&#x9002;&#x5F53;&#x7684;&#x53D8;&#x66F4;&#x63A7;&#x5236;&#x6216;&#x5BA1;&#x6279;&#x3002;&#x7531;&#x4E8E; CI/CD &#x7684;&#x8BB8;&#x591A;&#x6982;&#x5FF5;&#x90FD;&#x662F;&#x4EE5;&#x53EF;&#x91CD;&#x590D;&#x7684;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;&#x81EA;&#x52A8;&#x5316;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x4E00;&#x65E6;&#x56E2;&#x961F;&#x786E;&#x4FE1;&#x4ED6;&#x4EEC;&#x6709;&#x4E86;&#x4E00;&#x4E2A;&#x53EF;&#x9760;&#x7684;&#x6846;&#x67B6;&#xFF0C;&#x5C31;&#x5B8C;&#x5168;&#x4E0D;&#x9700;&#x8981;&#x624B;&#x52A8;&#x5BA1;&#x6279;&#x4E86;&#x3002;</p>
<p>&#x5B9E;&#x73B0;&#x6784;&#x5EFA;&#x3001;&#x6D4B;&#x8BD5;&#x3001;&#x90E8;&#x7F72;&#x548C;&#x53D1;&#x5E03;&#x8FC7;&#x7A0B;&#x7684;&#x5B8C;&#x5168;&#x81EA;&#x52A8;&#x5316;&#xFF0C;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x4EFB;&#x4F55;&#x4EBA;&#x4E3A;&#x5E72;&#x9884;&#x7684;&#x8FC7;&#x7A0B;&#x79F0;&#x4E3A;&#x6301;&#x7EED;&#x90E8;&#x7F72;(continuous deployment)&#x3002;&#x867D;&#x7136;&#x8BB8;&#x591A;&#x8F6F;&#x4EF6;&#x9879;&#x76EE;&#x4ECE;&#x6765;&#x6CA1;&#x6709;&#x5B8C;&#x5168;&#x5B9E;&#x73B0;&#x6301;&#x7EED;&#x90E8;&#x7F72;&#xFF0C;&#x4F46;&#x53EA;&#x8981;&#x5B9E;&#x73B0; CI/CD &#x5F3A;&#x8C03;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x56E2;&#x961F;&#x5C31;&#x80FD;&#x591F;&#x66F4;&#x5FEB;&#x5730;&#x4EA7;&#x751F;&#x771F;&#x6B63;&#x7684;&#x4E1A;&#x52A1;&#x4EF7;&#x503C;&#x3002;&#x5728;&#x4E0B;&#x4E00;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x4ECB;&#x7ECD; GitOps&#xFF0C;&#x7528;&#x4E8E;&#x6539;&#x8FDB;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x7BA1;&#x7406;&#x53CA;&#x5176;&#x914D;&#x7F6E;&#x3002;</p>
<h2 id="gitops-&#x5C06;-cicd-&#x63D0;&#x5347;&#x5230;&#x65B0;&#x9AD8;&#x5EA6;">GitOps &#x5C06; CI/CD &#x63D0;&#x5347;&#x5230;&#x65B0;&#x9AD8;&#x5EA6;</h2>
<p>Kubernetes &#x652F;&#x6301;&#x58F0;&#x660E;&#x5F0F;&#x914D;&#x7F6E;&#xFF0C;&#x548C;&#x5176;&#x4ED6;&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#x7F16;&#x5199;&#x7684;&#x7A0B;&#x5E8F;&#x4E00;&#x6837;&#xFF0C;Kubernetes &#x6E05;&#x5355;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; CI/CD &#x7BA1;&#x9053;&#x8FDB;&#x884C;&#x7BA1;&#x7406;&#x3002;&#x6E05;&#x5355;&#x5E94;&#x8BE5;&#x5B58;&#x50A8;&#x5728;&#x4EE3;&#x7801;&#x4ED3;&#x5E93;&#x4E2D;(&#x5982; git)&#xFF0C;&#x5E76;&#x4E14;&#x6BCF;&#x6B21;&#x7684;&#x6784;&#x5EFA;&#x3001;&#x6D4B;&#x8BD5;&#x3001;&#x90E8;&#x7F72;&#x6B65;&#x9AA4;&#x5E94;&#x8BE5;&#x76F8;&#x540C;&#x3002;&#x5728; Git &#x5B58;&#x50A8;&#x5E93;&#x4E2D;&#x7BA1;&#x7406; Kubernetes &#x96C6;&#x7FA4;&#x914D;&#x7F6E;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF0C;&#x7136;&#x540E;&#x4EE5;&#x81EA;&#x52A8;&#x5316;&#x7684;&#x65B9;&#x5F0F;&#x5E94;&#x7528;&#x8FD9;&#x4E9B;&#x8D44;&#x6E90;&#xFF0C;&#x8FD9;&#x4E00;&#x8D8B;&#x52BF;&#x4FC3;&#x4F7F;&#x4E86; GitOps &#x6982;&#x5FF5;&#x7684;&#x6D41;&#x884C;&#x3002;GitOps &#x4E8E; 2017 &#x5E74;&#x9996;&#x6B21;&#x7531; WeaveWorks &#x8F6F;&#x4EF6;&#x516C;&#x53F8;&#x63D0;&#x51FA;&#xFF0C;&#x6B64;&#x540E;&#x4F5C;&#x4E3A;&#x7BA1;&#x7406; Kubernetes &#x914D;&#x7F6E;&#x7684;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x5B83;&#x7684;&#x53D7;&#x6B22;&#x8FCE;&#x7A0B;&#x5EA6;&#x4E0D;&#x65AD;&#x63D0;&#x9AD8;&#x3002;&#x867D;&#x7136; GitOps &#x5728; Kubernetes &#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x5E7F;&#x4E3A;&#x4EBA;&#x77E5;&#xFF0C;&#x4F46;&#x5B83;&#x7684;&#x539F;&#x7406;&#x53EF;&#x4EE5;&#x5E94;&#x7528;&#x4E8E;&#x4EFB;&#x4F55;&#x672C;&#x5730;&#x4E91;&#x539F;&#x751F;&#x73AF;&#x5883;&#x3002;</p>
<p>&#x548C; CI/CD &#x7C7B;&#x4F3C;&#xFF0C;&#x76EE;&#x524D;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x5F88;&#x591A;&#x7BA1;&#x7406; GitOps &#x6D41;&#x7A0B;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x5982; Intuit &#x7684; ArgoCD&#x3001;WeaveWorks &#x7684; Flux&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x4F60;&#x65E0;&#x9700;&#x7279;&#x610F;&#x4F7F;&#x7528;&#x4E13;&#x95E8;&#x4E3A; GitOps &#x8BBE;&#x8BA1;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x56E0;&#x4E3A;&#x4EFB;&#x4F55; CI/CD &#x81EA;&#x52A8;&#x5316;&#x6D41;&#x7A0B;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x90FD;&#x53EF;&#x4EE5;&#x3002;&#x4F20;&#x7EDF;&#x7684; CI/CD &#x5DE5;&#x5177;&#x548C;&#x4E3A; GitOps &#x8BBE;&#x8BA1;&#x7684;&#x5DE5;&#x5177;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x952E;&#x533A;&#x522B;&#x5728;&#x4E8E;&#xFF0C;GitOps &#x5DE5;&#x5177;&#x80FD;&#x591F;&#x6301;&#x7EED;&#x89C2;&#x5BDF; Kubernetes &#x96C6;&#x7FA4;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x5E76;&#x5728;&#x5F53;&#x524D;&#x72B6;&#x6001;&#x4E0E; Git &#x5E93;&#x4E2D;&#x6E05;&#x5355;&#x6240;&#x5B9A;&#x4E49;&#x7684;&#x72B6;&#x6001;&#x4E0D;&#x7B26;&#x65F6;&#xFF0C;&#x5E94;&#x7528;&#x6240;&#x9700;&#x7684;&#x914D;&#x7F6E;&#x3002;&#x8FD9;&#x4E9B;&#x5DE5;&#x5177;&#x6709;&#x6548;&#x5229;&#x7528;&#x4E86; Kubernetes &#x539F;&#x751F;&#x7684;&#x63A7;&#x5236;&#x5668;&#x3002;</p>
<p>&#x7531;&#x4E8E; Helm &#x56FE;&#x8868;&#x6700;&#x7EC8;&#x662F;&#x4F5C;&#x4E3A; Kubernetes &#x8D44;&#x6E90;&#x5448;&#x73B0;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5B83;&#x4EEC;&#x4E5F;&#x9002;&#x7528;&#x4E8E; GitOps &#x6D41;&#x7A0B;&#xFF0C;&#x5E76;&#x4E14;&#x5F88;&#x591A; GitOps &#x5DE5;&#x5177;&#x539F;&#x751F;&#x652F;&#x6301; Helm&#x3002;&#x5728;&#x672C;&#x7AE0;&#x7684;&#x5269;&#x4F59;&#x90E8;&#x5206;&#xFF0C;&#x6211;&#x5C06;&#x8BA8;&#x8BBA;&#x5982;&#x4F55;&#x4F7F;&#x7528; CI/CD &#x548C; GitOps &#x90E8;&#x7F72; Helm &#x56FE;&#x8868;&#xFF0C;&#x5E76;&#x628A; Jenkins &#x4F5C;&#x4E3A; CI &#x548C; CD &#x7684;&#x9996;&#x9009;&#x5DE5;&#x5177;&#x3002;</p>
<h2 id="&#x8BBE;&#x7F6E;&#x73AF;&#x5883;">&#x8BBE;&#x7F6E;&#x73AF;&#x5883;</h2>
<p>&#x5728;&#x672C;&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x914D;&#x7F6E;&#x4E24;&#x4E2A;&#x7BA1;&#x9053;&#xFF0C;&#x6F14;&#x793A;&#x56F4;&#x7ED5; Helm &#x5B9E;&#x73B0;&#x4E0D;&#x540C;&#x7A0B;&#x5EA6;&#x7684;&#x81EA;&#x52A8;&#x5316;&#x3002;</p>
<p>&#x6309;&#x7167;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#x8BBE;&#x7F6E;&#x672C;&#x5730;&#x73AF;&#x5883;&#xFF1A;</p>
<ol>
<li><p>&#x5220;&#x9664;&#x539F;&#x6765;&#x7684; Minikube&#xFF0C;&#x542F;&#x52A8;&#x4E00;&#x4E2A; 4G &#x5185;&#x5B58;&#x7684; Minikube&#xFF1A;</p>
<pre class="language-"><code class="lang-shell"><span class="token punctuation">[</span>aiops@aiops0113 ~<span class="token punctuation">]</span>$ minikube delete
<span class="token punctuation">[</span>aiops@aiops0113 ~<span class="token punctuation">]</span>$ minikube start --memory<span class="token operator">=</span>4g --image-mirror-country<span class="token operator">=</span><span class="token string">&apos;cn&apos;</span> <span class="token punctuation">\</span>
                     --iso-url<span class="token operator">=</span>https://kubernetes.oss-cn-hangzhou.aliyuncs.com/minikube/iso/minikube-v1.20.0.iso
</code></pre>
</li>
<li><p>&#x5728; Minikube &#x542F;&#x52A8;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x521B;&#x5EFA;&#x540D;&#x4E3A; cicd &#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">$ kubectl create ns cicd
</code></pre>
</li>
</ol>
<p>&#x6B64;&#x5916;&#xFF0C;&#x4F60;&#x8FD8;&#x9700;&#x8981; Fork Helm &#x5305;&#x5B58;&#x50A8;&#x5E93;&#xFF0C;&#x4EE5;&#x4FBF;&#x6839;&#x636E;&#x6B65;&#x9AA4;&#x64CD;&#x4F5C;&#xFF1A;</p>
<p>&#x5305;&#x5B58;&#x50A8;&#x5E93;&#x5730;&#x5740;&#xFF1A;<a href="https://github.com/weiwendi/charts" target="_blank">https://github.com/weiwendi/charts</a></p>
<ol>
<li><p>&#x5355;&#x51FB;&#x53F3;&#x4E0A;&#x89D2;&#x7684; &#x201C;Fork&#x201D; &#x6309;&#x94AE;&#x521B;&#x5EFA;&#x5305;&#x5B58;&#x50A8;&#x5E93;&#x7684; Fork&#xFF1A;</p>
<figure id="fig2.7.1"><img src="https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.1fork.png" alt="7.1 fork"><figcaption>7.1 fork</figcaption></figure>
</li>
<li><p>&#x521B;&#x5EFA;&#x5305;&#x5B58;&#x50A8;&#x5E93;&#x7684;&#x5206;&#x652F;&#x540E;&#xFF0C;&#x8FD0;&#x884C;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x5C06;&#x8BE5;&#x5206;&#x652F;&#x514B;&#x9686;&#x5230;&#x672C;&#x5730;&#x673A;&#x5668;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">$ <span class="token function">git</span> clone https://github.com/<span class="token variable">$GITHUB_USERNAME</span>/charts
</code></pre>
</li>
</ol>
<p>&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#x4ECE;&#x4F60;&#x7684;&#x56FE;&#x8868;&#x5B58;&#x50A8;&#x5E93;&#x4E2D;&#x5220;&#x9664;&#x56FE;&#x8868;&#xFF1A;</p>
<ol>
<li><p>&#x5207;&#x6362;&#x5230;&#x672C;&#x5730;&#x56FE;&#x8868;&#x5B58;&#x50A8;&#x5E93;&#x7684;&#x76EE;&#x5F55;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;&#x76EE;&#x5F55;&#x540D;&#x4E3A; charts&#xFF1A;</p>
<pre class="language-"><code class="lang-shell"><span class="token punctuation">[</span>aiops@aiops0113 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> charts/
<span class="token punctuation">[</span>aiops@aiops0113 ~<span class="token punctuation">]</span>$ <span class="token function">ls</span>
   <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token comment"># CNAME &#x6587;&#x4EF6;&#x548C;&#x56FE;&#x8868;&#x65E0;&#x5173;&#xFF0C;&#x53EA;&#x56E0;&#x6211;&#x4E3A;&#x8BE5;&#x4ED3;&#x5E93;&#x8BBE;&#x7F6E;&#x4E86;&#x81EA;&#x5B9A;&#x4E49;&#x57DF;&#x540D;&#xFF0C;GitHub &#x81EA;&#x52A8;&#x751F;&#x6210;&#x4E86; CNAME &#x6587;&#x4EF6;&#x3002;</span>
</code></pre>
</li>
<li><p>&#x4ECE;&#x5B58;&#x50A8;&#x5E93;&#x4E2D;&#x5220;&#x9664; README.md &#x4E4B;&#x5916;&#x7684;&#x6587;&#x4EF6;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell"><span class="token punctuation">[</span>aiops@aiops0113 charts<span class="token punctuation">]</span>$ <span class="token function">rm</span> -rf <span class="token variable"><span class="token variable">$(</span><span class="token function">ls</span> <span class="token operator">|</span><span class="token function">egrep</span> -v <span class="token string">&apos;(README.md)&apos;</span><span class="token variable">)</span></span>
<span class="token punctuation">[</span>aiops@aiops0113 charts<span class="token punctuation">]</span>$ <span class="token function">ls</span>
README.md
</code></pre>
</li>
<li><p>&#x628A;&#x66F4;&#x6539;&#x63A8;&#x9001;&#x5230;&#x8FDC;&#x7A0B; GitHub &#x4ED3;&#x5E93;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell"><span class="token punctuation">[</span>aiops@aiops0113 charts<span class="token punctuation">]</span>$ <span class="token function">git</span> <span class="token function">add</span> --all
<span class="token punctuation">[</span>aiops@aiops0113 charts<span class="token punctuation">]</span>$ <span class="token function">git</span> commit -m <span class="token string">&apos;Preparing for ci/cd.&apos;</span>
<span class="token punctuation">[</span>aiops@aiops0113 charts<span class="token punctuation">]</span>$ <span class="token function">git</span> push origin main
</code></pre>
</li>
<li><p>&#x5728; GitHub &#x4E0A;&#x786E;&#x8BA4;&#x56FE;&#x8868;&#x548C;&#x7D22;&#x5F15;&#x6587;&#x4EF6;&#x5DF2;&#x88AB;&#x5220;&#x9664;&#xFF0C;&#x53EA;&#x5269; README.md &#x6587;&#x4EF6;&#xFF1A;</p>
<figure id="fig2.7.2"><img src="https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.2delete.jpg" alt="7.2 delete tar and index file"><figcaption>7.2 delete tar and index file</figcaption></figure>
</li>
</ol>
<p>&#x7ECF;&#x8FC7;&#x4EE5;&#x4E0A;&#x56DB;&#x6B65;&#xFF0C;&#x4F60;&#x5DF2;&#x7ECF;&#x542F;&#x52A8;&#x4E86; Minikube&#xFF0C;Fork &#x4E86;&#x56FE;&#x8868;&#x5305;&#x5B58;&#x50A8;&#x5E93;&#xFF0C;&#x5E76;&#x4ECE; charts &#x4E2D;&#x5220;&#x9664;&#x4E86; player-stats &#x56FE;&#x8868;&#x53CA;&#x7D22;&#x5F15;&#x7B49;&#x6587;&#x4EF6;&#x3002;&#x73B0;&#x5728;&#xFF0C;&#x6211;&#x4EEC;&#x5F00;&#x59CB;&#x5B66;&#x4E60;&#x521B;&#x5EFA; CI &#x7BA1;&#x9053;&#x53D1;&#x5E03; Helm &#x56FE;&#x8868;&#x3002;</p>
<h2 id="&#x521B;&#x5EFA;-ci-&#x7BA1;&#x9053;&#x6784;&#x5EFA;-helm-&#x56FE;&#x8868;">&#x521B;&#x5EFA; CI &#x7BA1;&#x9053;&#x6784;&#x5EFA; Helm &#x56FE;&#x8868;</h2>
<p>&#x4EE5;&#x56FE;&#x8868;&#x5F00;&#x53D1;&#x8005;&#x7684;&#x89D2;&#x5EA6;&#xFF0C;CI &#x7684;&#x6982;&#x5FF5;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x6784;&#x5EFA;&#x3001;&#x6D4B;&#x8BD5;&#x3001;&#x6253;&#x5305;&#x548C;&#x53D1;&#x5E03; Helm &#x56FE;&#x8868;&#x5230;&#x56FE;&#x8868;&#x5B58;&#x50A8;&#x5E93;&#x3002;&#x5728;&#x672C;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x8BA8;&#x8BBA;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x7AEF;&#x5230;&#x7AEF;&#x7684; CI &#x7BA1;&#x9053;&#x7B80;&#x5316;&#x8FD9;&#x4E00;&#x8FC7;&#x7A0B;&#xFF0C;&#x5E76;&#x9010;&#x6B65;&#x5F15;&#x5BFC;&#x4F60;&#x521B;&#x5EFA;&#x793A;&#x4F8B;&#x7BA1;&#x9053;&#x3002;&#x9996;&#x5148;&#xFF0C;&#x6211;&#x4EEC;&#x4ECE;&#x8BBE;&#x8BA1;&#x793A;&#x4F8B;&#x7BA1;&#x9053;&#x6240;&#x9700;&#x7684;&#x7EC4;&#x4EF6;&#x5F00;&#x59CB;&#x3002;</p>
<h3 id="ci-&#x7BA1;&#x9053;&#x8BBE;&#x8BA1;">CI &#x7BA1;&#x9053;&#x8BBE;&#x8BA1;</h3>
<p>&#x5728;&#x4E4B;&#x524D;&#x7684;&#x7AE0;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x8BA8;&#x8BBA;&#x4E86;Helm &#x56FE;&#x8868;&#x7684;&#x5F00;&#x53D1;&#xFF0C;&#x6574;&#x4E2A;&#x5F00;&#x53D1;&#x8FC7;&#x7A0B;&#x5F88;&#x5927;&#x7A0B;&#x5EA6;&#x662F;&#x624B;&#x52A8;&#x5B8C;&#x6210;&#x7684;&#x3002;&#x867D;&#x7136; Helm &#x53EF;&#x4EE5;&#x5728; Kubernetes &#x96C6;&#x7FA4;&#x4E2D;&#x521B;&#x5EFA;&#x81EA;&#x52A8;&#x5316;&#x7684;&#x6D4B;&#x8BD5;&#x94A9;&#x5B50;&#xFF0C;&#x4F46;&#x5728;&#x4EE3;&#x7801;&#x66F4;&#x6539;&#x540E;&#xFF0C;&#x4ECD;&#x9700;&#x624B;&#x52A8;&#x6267;&#x884C; <strong>helm lint</strong>&#x3001;<strong>helm test</strong> &#x6216;&#x8005; <strong>ct lint-and-test</strong> &#x547D;&#x4EE4;&#xFF0C;&#x4EE5;&#x786E;&#x4FDD;&#x80FD;&#x591F;&#x901A;&#x8FC7;&#x6D4B;&#x8BD5;&#x3002;&#x4E00;&#x65E6;&#x66F4;&#x6539;&#x540E;&#x7684;&#x4EE3;&#x7801;&#x7ECF;&#x8FC7;&#x4E86;&#x6D4B;&#x8BD5;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x6267;&#x884C; <strong>helm package</strong> &#x547D;&#x4EE4;&#x5BF9;&#x56FE;&#x8868;&#x6253;&#x5305;&#xFF0C;&#x518D;&#x6267;&#x884C; <strong>helm repo index</strong> &#x547D;&#x4EE4;&#x521B;&#x5EFA; index.yaml &#x6587;&#x4EF6;&#x3002;&#x5982;&#x679C;&#x56FE;&#x8868;&#x5E93;&#x662F; GitHub&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x628A;&#x5305;&#x6587;&#x4EF6;&#x548C;&#x7D22;&#x5F15;&#x6587;&#x4EF6;&#x63A8;&#x9001;&#x5230; GitHub &#x4ED3;&#x5E93;&#x4E2D;&#x4E86;&#x3002;</p>
<p>&#x867D;&#x7136;&#x8FD9;&#x4E9B;&#x6B65;&#x9AA4;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x624B;&#x52A8;&#x6267;&#x884C;&#x547D;&#x4EE4;&#x5B8C;&#x6210;&#xFF0C;&#x4F46;&#x5F53;&#x4F60;&#x5F00;&#x53D1;&#x7684;&#x56FE;&#x8868;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#xFF0C;&#x6216;&#x8005;&#x6709;&#x66F4;&#x591A;&#x7684;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x53C2;&#x4E0E;&#x5176;&#x4E2D;&#xFF0C;&#x8FD9;&#x4E2A;&#x5DE5;&#x4F5C;&#x6D41;&#x5C31;&#x4F1A;&#x9010;&#x6E10;&#x53D8;&#x5F97;&#x96BE;&#x4EE5;&#x638C;&#x63A7;&#x3002;&#x5728;&#x624B;&#x52A8;&#x6267;&#x884C;&#x65F6;&#xFF0C;&#x5F88;&#x53EF;&#x80FD;&#x63D0;&#x4EA4;&#x672A;&#x7ECF;&#x6D4B;&#x8BD5;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x800C;&#x4E14;&#x5F88;&#x96BE;&#x4FDD;&#x8BC1;&#x6BCF;&#x4F4D;&#x5F00;&#x53D1;&#x8005;&#x90FD;&#x9075;&#x5B88;&#x4E86;&#x6D4B;&#x8BD5;&#x89C4;&#x8303;&#x3002;&#x5E78;&#x8FD0;&#x7684;&#x662F;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x81EA;&#x52A8;&#x53D1;&#x5E03;&#x6D41;&#x7A0B;&#x7684; CI &#x7BA1;&#x9053;&#x907F;&#x514D;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#x6982;&#x8FF0;&#x4E86;&#x4E00;&#x4E2A; CI &#x5DE5;&#x4F5C;&#x6D41;&#x7A0B;&#xFF0C;&#x5B83;&#x4F7F;&#x7528;&#x4E86;&#x672C;&#x4E66;&#x5230;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#x4ECB;&#x7ECD;&#x7684;&#x547D;&#x4EE4;&#x548C;&#x5DE5;&#x5177;&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;&#x5047;&#x8BBE;&#x4E86;&#x56FE;&#x8868;&#x88AB;&#x4FDD;&#x5B58;&#x5728; GitHub &#x4ED3;&#x5E93;&#xFF1A;</p>
<ol>
<li>&#x56FE;&#x8868;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x5BF9; git monorepo &#x4E2D;&#x5BF9;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x56FE;&#x8868;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x4E86;&#x4FEE;&#x6539;&#x3002;</li>
<li>&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x63A8;&#x9001;&#x4FEE;&#x6539;&#x540E;&#x7684;&#x4EE3;&#x7801;&#x5230;&#x8FDC;&#x7A0B;&#x4ED3;&#x5E93;&#x3002;</li>
<li>&#x6267;&#x884C; <strong>ct lint</strong> &#x548C; <strong>ct install</strong> &#x547D;&#x4EE4;&#xFF0C;&#x5728; Kubernetes &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x81EA;&#x52A8;&#x68C0;&#x6D4B;&#x548C;&#x6D4B;&#x8BD5;&#x4FEE;&#x6539;&#x7684;&#x56FE;&#x8868;&#x3002;</li>
<li>&#x5982;&#x679C;&#x7ECF;&#x8FC7;&#x6D4B;&#x8BD5;&#xFF0C;&#x81EA;&#x52A8;&#x6267;&#x884C; <strong>helm package</strong> &#x547D;&#x4EE4;&#x5C06;&#x56FE;&#x8868;&#x6253;&#x5305;&#x3002;</li>
<li>&#x4F7F;&#x7528; <strong>helm repo index</strong> &#x547D;&#x4EE4;&#x751F;&#x6210; index.yaml &#x7D22;&#x5F15;&#x6587;&#x4EF6;&#x3002;</li>
<li>&#x6253;&#x5305;&#x540E;&#x7684;&#x56FE;&#x8868;&#x548C;&#x66F4;&#x65B0;&#x540E;&#x7684; index.yaml &#x6587;&#x4EF6;&#x4F1A;&#x81EA;&#x52A8;&#x63A8;&#x9001;&#x5230;&#x5B58;&#x50A8;&#x5E93;&#x3002;&#x5B83;&#x4EEC;&#x88AB;&#x63A8;&#x9001;&#x5230; job &#x5BF9;&#x5E94;&#x7684;&#x5206;&#x652F;&#x4E0A;&#x3002;</li>
</ol>
<p>&#x5728;&#x4E0B;&#x4E00;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x4F7F;&#x7528; Jenkins &#x6267;&#x884C;&#x6B64;&#x8FC7;&#x7A0B;&#x3002;&#x9996;&#x5148;&#x6211;&#x4EEC;&#x5148;&#x4E86;&#x89E3; Jenkins &#x662F;&#x4EC0;&#x4E48;&#x4EE5;&#x53CA;&#x5B83;&#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;&#x3002;</p>
<h3 id="jenkins-&#x4ECB;&#x7ECD;">Jenkins &#x4ECB;&#x7ECD;</h3>
<p>Jenkins &#x662F;&#x4E00;&#x4E2A;&#x5F00;&#x6E90;&#x670D;&#x52A1;&#xFF0C;&#x7528;&#x4E8E;&#x6267;&#x884C;&#x81EA;&#x52A8;&#x5316;&#x4EFB;&#x52A1;&#x548C;&#x5DE5;&#x4F5C;&#x6D41;&#x7A0B;&#x3002;&#x5B83;&#x901A;&#x8FC7; Jenkins &#x7684;&#x7BA1;&#x9053;&#x5373;&#x4EE3;&#x7801;&#x529F;&#x80FD;&#x521B;&#x5EFA; CI/CD &#x7BA1;&#x9053;&#xFF0C;&#x8BE5;&#x529F;&#x80FD;&#x901A;&#x8FC7;&#x540D;&#x4E3A; Jenkinsfile &#x7684;&#x6587;&#x4EF6;&#x5B9E;&#x73B0;&#xFF0C;Jenkinsfile &#x6587;&#x4EF6;&#x7528;&#x4E8E;&#x5B9A;&#x4E49; Jenkins &#x7BA1;&#x9053;&#x3002;</p>
<p>Jenkins &#x7BA1;&#x9053;&#x662F;&#x7528; Groovy &#x7279;&#x5B9A;&#x9886;&#x57DF;&#x8BED;&#x8A00;(Domain-Specific Language DSL)&#x7F16;&#x5199;&#x7684;&#x3002;Groovy &#x662F;&#x4E00;&#x79CD;&#x7C7B;&#x4F3C;&#x4E8E; Java &#x7684;&#x8BED;&#x8A00;&#xFF0C;&#x4F46;&#x4E0E; Java &#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x4E00;&#x79CD;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7684;&#x811A;&#x672C;&#x8BED;&#x8A00;&#xFF0C;&#x9002;&#x5408;&#x7F16;&#x5199;&#x6613;&#x4E8E;&#x9605;&#x8BFB;&#x7684;&#x81EA;&#x52A8;&#x5316;&#x811A;&#x672C;&#x3002;&#x5728;&#x672C;&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x5C06;&#x5E26;&#x4F60;&#x5B66;&#x4E60;&#x4E24;&#x4E2A;&#x5DF2;&#x7ECF;&#x7F16;&#x5199;&#x597D;&#x7684; Jenkinsfile &#x6587;&#x4EF6;&#xFF1A;ciJenkinsfile &#x548C; cdJenkinsfile&#x3002;&#x4F60;&#x4E0D;&#x9700;&#x8981;&#x6709;&#x4EFB;&#x4F55;&#x7F16;&#x5199; Jenkinsfile &#x6587;&#x4EF6;&#x7684;&#x7ECF;&#x9A8C;&#xFF0C;&#x56E0;&#x4E3A;&#x5BF9; Jenkins &#x7684;&#x6DF1;&#x5165;&#x7814;&#x7A76;&#x8D85;&#x51FA;&#x4E86;&#x672C;&#x4E66;&#x7684;&#x8303;&#x56F4;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5728;&#x672C;&#x7AE0;&#x7ED3;&#x675F;&#x65F6;&#xFF0C;&#x4F60;&#x5E94;&#x8BE5;&#x80FD;&#x591F;&#x628A;&#x5B66;&#x5230;&#x7684;&#x6982;&#x5FF5;&#x5E94;&#x7528;&#x5230;&#x4F60;&#x9009;&#x62E9;&#x7684;&#x81EA;&#x52A8;&#x5316;&#x5DE5;&#x5177;&#x4E2D;&#x3002;&#x867D;&#x7136;&#x672C;&#x7AE0;&#x4EE5; Jenkins &#x4E3A;&#x4F8B;&#xFF0C;&#x4F46;&#x5176;&#x6982;&#x5FF5;&#x53EF;&#x4EE5;&#x5E94;&#x7528;&#x4E8E;&#x4EFB;&#x4F55;&#x5176;&#x4ED6;&#x81EA;&#x52A8;&#x5316;&#x5DE5;&#x5177;&#x3002;</p>
<p>&#x5F53; Jenkinsfile &#x88AB;&#x521B;&#x5EFA;&#x540E;&#xFF0C;&#x5B9A;&#x4E49;&#x7684;&#x5DE5;&#x4F5C;&#x6D41;&#x6B65;&#x9AA4;&#x96C6;&#x4F1A;&#x5728; Jenkins &#x4E3B;&#x670D;&#x52A1;&#x5668;&#x6216;&#x4E00;&#x53F0;&#x5355;&#x72EC;&#x7684; Agent &#x4E0A;&#x6267;&#x884C;&#x3002;&#x53EF;&#x4EE5;&#x628A; Agent &#x4F5C;&#x4E3A; Kubernetes &#x7684;&#x4E00;&#x4E2A; Pod &#x542F;&#x52A8;&#xFF0C;&#x4ECE;&#x800C;&#x7B80;&#x5316; Agent &#x7684;&#x521B;&#x5EFA;&#x548C;&#x7BA1;&#x7406;&#x3002;&#x5728; Agent &#x6267;&#x884C;&#x5B8C; Job &#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x4E3A;&#x81EA;&#x52A8;&#x7EC8;&#x6B62;&#x3002;&#x5F53;&#x6709;&#x65B0;&#x7684;&#x6784;&#x5EFA;&#x4EFB;&#x52A1;&#x65F6;&#xFF0C;&#x4F1A;&#x5728;&#x4E00;&#x4E2A;&#x65B0;&#x521B;&#x5EFA;&#x7684;&#x5E72;&#x51C0; Pod &#x4E2D;&#x6267;&#x884C;&#x3002;&#x5728;&#x672C;&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x4F7F;&#x7528; Jenkins Agent &#x8FD0;&#x884C;&#x793A;&#x4F8B;&#x7BA1;&#x9053;&#x3002;</p>
<p>Jenkins &#x53EF;&#x4EE5;&#x626B;&#x63CF;&#x4EE3;&#x7801;&#x4ED3;&#x5E93;&#x4E2D;&#x662F;&#x5426;&#x5305;&#x542B; Jenkinsfile &#x6587;&#x4EF6;&#xFF0C;&#x8FD9;&#x4E00;&#x529F;&#x80FD;&#x4F7F;&#x5B83;&#x5F88;&#x9002;&#x5408; GitOps &#x7684;&#x6982;&#x5FF5;&#x3002;&#x5BF9;&#x4E8E;&#x5305;&#x542B; Jenkinsfile &#x6587;&#x4EF6;&#x7684;&#x5206;&#x652F;&#xFF0C;&#x4F1A;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0; Job&#xFF0C;&#x514B;&#x9686;&#x6240;&#x9700;&#x5206;&#x652F;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x8FD9;&#x8BA9;&#x6D4B;&#x8BD5;&#x65B0;&#x529F;&#x80FD;&#x53D8;&#x5F97;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#xFF0C;&#x56E0;&#x4E3A;&#x65B0;&#x7684; Job &#x53EF;&#x4EE5;&#x4E0E;&#x5B83;&#x4EEC;&#x76F8;&#x5E94;&#x7684;&#x5206;&#x652F;&#x4E00;&#x8D77;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x3002;</p>
<p>&#x5BF9; Jenkins &#x6709;&#x4E86;&#x57FA;&#x672C;&#x7684;&#x4E86;&#x89E3;&#x4E4B;&#x540E;&#xFF0C;&#x73B0;&#x5728;&#x8BA9;&#x6211;&#x4EEC;&#x5C06; Jenkins &#x5B89;&#x88C5;&#x5230; Minikube &#x73AF;&#x5883;&#x4E2D;&#x3002;</p>
<h3 id="&#x5B89;&#x88C5;-jenkins">&#x5B89;&#x88C5; Jenkins</h3>
<p>&#x4E0E;&#x5728; Kubernetes &#x4E0A;&#x90E8;&#x7F72;&#x7684;&#x5176;&#x4ED6;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E00;&#x6837;&#xFF0C;Jenkins &#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; Helm Hub &#x4E0A;&#x7684;&#x56FE;&#x8868;&#x90E8;&#x7F72;&#x3002;&#x5728;&#x672C;&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528; Jenkins &#x5B98;&#x65B9;&#x63D0;&#x4F9B;&#x7684; Jenkins Helm &#x56FE;&#x8868;&#x3002;&#x9996;&#x5148;&#x6DFB;&#x52A0; jenkins &#x56FE;&#x8868;&#x4ED3;&#x5E93;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell"><span class="token punctuation">[</span>aiops@aiops0113 charts<span class="token punctuation">]</span>$ helm repo <span class="token function">add</span> jenkins https://charts.jenkins.io
<span class="token string">&quot;jenkins&quot;</span> has been added to your repositories
</code></pre>
<p>Jenkins &#x56FE;&#x8868;&#x9664;&#x4E86;&#x63D0;&#x4F9B; Kubernetes &#x7684;&#x76F8;&#x5173;&#x503C;&#xFF0C;&#x5982;&#x8D44;&#x6E90;&#x9650;&#x5236;&#x3001;service &#x7C7B;&#x578B;&#x7B49;&#xFF0C;&#x8FD8;&#x5305;&#x542B;&#x4E86;&#x4E0E; Jenkins &#x76F8;&#x5173;&#x7684;&#x503C;&#xFF0C;&#x7528;&#x4E8E;&#x81EA;&#x52A8;&#x914D;&#x7F6E;&#x4E0D;&#x540C;&#x7684; Jenkins &#x7EC4;&#x4EF6;&#x3002;&#x5728;&#x5B89;&#x88C5;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x503C;&#x6587;&#x4EF6;&#xFF0C;&#x7528;&#x6765;&#x4FEE;&#x6539; Jenkins Master &#x7684; service &#x7C7B;&#x578B;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F; ClusterIP&#xFF0C;&#x6211;&#x4EEC;&#x628A;&#x5B83;&#x6539;&#x6210; NodePort&#x3002;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;&#x7528;&#x7684;&#x662F; Multibranch &#x7C7B;&#x578B;&#x7684; Job&#xFF0C;Jenkins &#x9ED8;&#x8BA4;&#x5E76;&#x6CA1;&#x6709;&#x5B89;&#x88C5;&#x6B64;&#x63D2;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x4E5F;&#x9700;&#x8981;&#x5728;&#x503C;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x63D0;&#x4F9B;&#x6B64;&#x63D2;&#x4EF6;&#x7684;&#x5B89;&#x88C5;&#x4FE1;&#x606F;&#x3002;&#x6700;&#x7EC8;&#x7684;&#x503C;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell"><span class="token punctuation">[</span>aiops@aiops0113 jenkins<span class="token punctuation">]</span>$ <span class="token function">cat</span> values.yaml
controller:
  serviceType: NodePort
  installPlugins:
    - workflow-multibranch:2.26
</code></pre>
<p>&#x6267;&#x884C; <strong>helm install</strong> &#x547D;&#x4EE4;&#x5B89;&#x88C5; Jenkins&#xFF1A;</p>
<pre class="language-"><code class="lang-shell"><span class="token punctuation">[</span>aiops@aiops0113 jenkins<span class="token punctuation">]</span>$ helm <span class="token function">install</span> jenkins jenkins/jenkins --values ~/learn-helm/jenkins/values.yaml -n cicd

NAME: jenkins
LAST DEPLOYED: Thu Jul  <span class="token number">8</span> 02:24:10 <span class="token number">2021</span>
NAMESPACE: cicd
STATUS: deployed
REVISION: <span class="token number">1</span>
NOTES:
<span class="token number">1</span>. Get your <span class="token string">&apos;admin&apos;</span> user password by running:
  kubectl <span class="token builtin class-name">exec</span> --namespace cicd -it svc/jenkins -c jenkins -- /bin/cat /run/secrets/chart-admin-password <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span>
<span class="token number">2</span>. Get the Jenkins URL to visit by running these commands <span class="token keyword">in</span> the same shell:
  <span class="token builtin class-name">export</span> <span class="token assign-left variable">NODE_PORT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>kubectl get --namespace cicd -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">&quot;{.spec.ports[0].nodePort}&quot;</span> services jenkins<span class="token variable">)</span></span>
  <span class="token builtin class-name">export</span> <span class="token assign-left variable">NODE_IP</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>kubectl get nodes --namespace cicd -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">&quot;{.items[0].status.addresses[0].address}&quot;</span><span class="token variable">)</span></span>
  <span class="token builtin class-name">echo</span> http://<span class="token variable">$NODE_IP</span><span class="token builtin class-name">:</span><span class="token variable">$NODE_PORT</span>/login

<span class="token number">3</span>. Login with the password from step <span class="token number">1</span> and the username: admin
<span class="token number">4</span>. Configure security realm and authorization strategy
<span class="token number">5</span>. Use Jenkins Configuration as Code by specifying configScripts <span class="token keyword">in</span> your values.yaml file, see documentation: http:///configuration-as-code and examples: https://github.com/jenkinsci/configuration-as-cod
e-plugin/tree/master/demos
For <span class="token function">more</span> information on running Jenkins on Kubernetes, visit:
https://cloud.google.com/solutions/jenkins-on-container-engine

For <span class="token function">more</span> information about Jenkins Configuration as Code, visit:
https://jenkins.io/projects/jcasc/


NOTE: Consider using a custom image with pre-installed plugins
</code></pre>
<p>&#x547D;&#x4EE4;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x4F1A;&#x8F93;&#x51FA; NOTES &#x4FE1;&#x606F;&#xFF0C;&#x8FD9;&#x65F6; Jenkins Master Pod &#x53EF;&#x80FD;&#x8FD8;&#x6CA1;&#x542F;&#x52A8;&#x5B8C;&#x6210;&#xFF0C;&#x5B83;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x5316;&#x7684;&#x9636;&#x6BB5;&#x3002;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x76D1;&#x542C; Jenkins Master Pod &#x7684;&#x72B6;&#x6001;&#xFF0C;&#x5F53;&#x5168;&#x90E8; READY &#x65F6;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; NOTES &#x63D0;&#x4F9B;&#x7684;&#x4FE1;&#x606F;&#x8BBF;&#x95EE; Jenkins Master &#x4E86;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell"><span class="token punctuation">[</span>aiops@aiops0113 jenkins<span class="token punctuation">]</span>$ kubectl get pod -w -n cicd

<span class="token comment"># &#x83B7;&#x53D6; admin &#x8D26;&#x53F7;&#x7684;&#x767B;&#x5F55;&#x5BC6;&#x7801;</span>
<span class="token punctuation">[</span>aiops@aiops0113 jenkins<span class="token punctuation">]</span>$ kubectl <span class="token builtin class-name">exec</span> --namespace cicd -it svc/jenkins -c jenkins -- /bin/cat /run/secrets/chart-admin-password <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span>

<span class="token comment"># &#x83B7;&#x53D6; node IP</span>
<span class="token punctuation">[</span>aiops@aiops0113 jenkins<span class="token punctuation">]</span>$ kubectl get nodes --namespace cicd -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">&quot;{.items[0].status.addresses[0].address}&quot;</span>

<span class="token comment"># &#x83B7;&#x53D6; node port</span>
<span class="token punctuation">[</span>aiops@aiops0113 jenkins<span class="token punctuation">]</span><span class="token variable">$kubectl</span> get --namespace cicd -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">&quot;{.spec.ports[0].nodePort}&quot;</span> services jenkins
</code></pre>
<p>&#x6709;&#x4E86;&#x8FD9;&#x4E09;&#x4E2A;&#x4FE1;&#x606F;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x767B;&#x5F55; Jenkins &#x63A7;&#x5236;&#x53F0;&#x4E86;&#x3002;&#x4E0B;&#x4E00;&#x8282;&#xFF0C;&#x6211;&#x4EEC;&#x8BA8;&#x8BBA;&#x5982;&#x4F55;&#x914D;&#x7F6E; Jenkins&#x3002;</p>
<h3 id="&#x914D;&#x7F6E;-jenkins">&#x914D;&#x7F6E; Jenkins</h3>
<p>&#x6839;&#x636E; NOTES &#x63D0;&#x4F9B;&#x7684;&#x4FE1;&#x606F;&#x767B;&#x5F55; Jenkins &#x63A7;&#x5236;&#x53F0;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9; Jenkins &#x505A;&#x4E00;&#x4E9B;&#x5FC5;&#x8981;&#x7684;&#x914D;&#x7F6E;&#x3002;</p>
<p>&#x9996;&#x5148;&#xFF0C;&#x6211;&#x4EEC;&#x6DFB;&#x52A0;&#x4E24;&#x4E2A;&#x51ED;&#x636E;&#xFF0C;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x5411; GitHub &#x63D0;&#x4EA4;&#x4EE3;&#x7801;&#xFF0C;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x8BBF;&#x95EE; Kubernetes &#x96C6;&#x7FA4;&#x3002;</p>
<p>&#x51ED;&#x636E;&#x521B;&#x5EFA;&#x8DEF;&#x5F84;&#x5927;&#x81F4;&#x5982;&#x6B64;&#xFF1A;&#x201C;Manage Jenkins &#x201D; --&gt; &#x201C;Manage Credentials&#x201D;  --&gt; &#x201C;Jenkins&#x201D; --&gt; &#x201C;&#x5168;&#x5C40;&#x51ED;&#x636E; (unrestricted)&#x201D; --&gt; &#x201C;Add Credentials&#x201D;&#x3002;</p>
<h4 id="&#x521B;&#x5EFA;-github-&#x51ED;&#x636E;">&#x521B;&#x5EFA; GitHub &#x51ED;&#x636E;</h4>
<p>&#x5728; CI &#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x628A;&#x7ECF;&#x8FC7;&#x6D4B;&#x8BD5;&#x7684; Helm &#x56FE;&#x8868;&#x5305;&#x63A8;&#x9001;&#x5230; Fork &#x51FA;&#x7684; GitHub &#x5305;&#x5B58;&#x50A8;&#x5E93;&#xFF0C;&#x8FD9;&#x4E2A;&#x64CD;&#x4F5C;&#x9700;&#x8981;&#x5411; GitHub &#x63D0;&#x4F9B;&#x51ED;&#x636E;&#x3002;&#x5728; 2021 &#x5E74; 8 &#x6708; 13 &#x65E5;&#x4E4B;&#x540E;&#xFF0C;GitHub &#x5C06;&#x4E0D;&#x518D;&#x652F;&#x6301;&#x5BC6;&#x7801;&#x9A8C;&#x8BC1;&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528; <strong>personal access token</strong> &#x66FF;&#x6362;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x5148;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; token&#xFF0C;&#x767B;&#x5F55; GitHub &#x9875;&#x9762;&#xFF0C;&#x70B9;&#x51FB;&#x53F3;&#x4E0A;&#x89D2;&#x5934;&#x50CF;&#x65C1;&#x7684;&#x5012;&#x4E09;&#x89D2;&#xFF0C;&#x4F1A;&#x5F39;&#x51FA;&#x4E00;&#x4E2A;&#x7A97;&#x53E3;&#xFF0C;&#x70B9;&#x51FB;&#x5176;&#x4E2D;&#x7684; &#x201C;Settings&#x201D; &#x6309;&#x94AE;&#xFF0C;&#x5728;&#x5F39;&#x51FA;&#x7684;&#x65B0;&#x9875;&#x9762;&#x4E2D;&#xFF0C;&#x70B9;&#x51FB;&#x5DE6;&#x4FA7;&#x680F;&#x7684; &#x201C;Developer settings&#x201D;&#xFF0C;&#x70B9;&#x51FB; &#x201C;Personal access tokens&#x201D;&#xFF0C;&#x518D;&#x70B9;&#x51FB; &#x201C;Generate new token&#x201D;&#xFF0C;&#x586B;&#x5199; Note &#x4FE1;&#x606F;&#xFF0C;&#x8BBE;&#x7F6E;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#xFF0C;&#x52FE;&#x9009; repo &#x76F8;&#x5173;&#x6743;&#x9650;&#xFF0C;&#x6700;&#x540E;&#x70B9;&#x51FB;&#x5E95;&#x90E8;&#x7684; &#x201C;Generate token&#x201D; &#x521B;&#x5EFA; token&#xFF0C;&#x7136;&#x540E;&#x628A;&#x751F;&#x4EA7;&#x7684; token &#x590D;&#x5236;&#x51FA;&#x6765;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x5728;&#x521B;&#x5EFA; GitHub &#x51ED;&#x636E;&#x65F6;&#x7528;&#x5230;&#x3002;</p>
<figure id="fig2.7.3"><img src="https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.3%20create%20github%20token.jpg" alt="7.3 create github token."><figcaption>7.3 create github token.</figcaption></figure>
<p>&#x6709;&#x4E86; GitHub token&#xFF0C;&#x6211;&#x4EEC;&#x5230; Jenkins &#x63A7;&#x5236;&#x53F0;&#x4E2D;&#x521B;&#x5EFA;&#x51ED;&#x636E;&#xFF0C;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x8BF7;&#x53C2;&#x8003;&#x4E0B;&#x56FE;&#xFF1A;</p>
<figure id="fig2.7.4"><img src="https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.4%20create%20github%20credentials.jpg" alt="7.4 create jenkins github credentials"><figcaption>7.4 create jenkins github credentials</figcaption></figure>
<ul>
<li>Kind&#xFF1A;&#x4F7F;&#x7528;&#x4F55;&#x79CD;&#x65B9;&#x5F0F;&#x521B;&#x5EFA;&#x8BE5;&#x51ED;&#x636E;&#xFF0C;&#x6211;&#x4EEC;&#x9009;&#x62E9;&#x7528;&#x6237;&#x540D;&#x3001;&#x5BC6;&#x7801;&#x7684;&#x65B9;&#x5F0F;&#x3002;</li>
<li>Scope&#xFF1A;&#x51ED;&#x636E;&#x7684;&#x4F7F;&#x7528;&#x8303;&#x56F4;&#x3002;</li>
<li>Username&#xFF1A;&#x521B;&#x5EFA;&#x8BE5;&#x51ED;&#x636E;&#x4F7F;&#x7528;&#x7684;&#x7528;&#x6237;&#x540D;&#xFF0C;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x586B;&#x5199;&#x4F60; GitHub &#x7684;&#x7528;&#x6237;&#x540D;&#x3002;</li>
<li>Password&#xFF1A;&#x521B;&#x5EFA;&#x8BE5;&#x51ED;&#x636E;&#x4F7F;&#x7528;&#x7684;&#x5BC6;&#x7801;/token&#xFF0C;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x628A;&#x5728; GitHub &#x4E0A;&#x590D;&#x5236;&#x7684; token &#x7C98;&#x8D34;&#x8FDB;&#x53BB;&#x3002;</li>
<li>ID&#xFF1A;&#x51ED;&#x636E;&#x7684;&#x6807;&#x8BC6;&#x7B26;&#xFF0C;&#x53EF;&#x4EE5;&#x586B;&#x5199;&#x4E00;&#x4E2A;&#x6709;&#x6807;&#x793A;&#x6027;&#x7684;&#x540D;&#x79F0;&#x3002;&#x5728; Jenkinsfile &#x4E2D;&#x4F1A;&#x901A;&#x8FC7;&#x51ED;&#x636E; ID &#x5F15;&#x7528;&#x51ED;&#x636E;&#x3002;</li>
<li>Description&#xFF1A;&#x51ED;&#x636E;&#x63CF;&#x8FF0;&#x4FE1;&#x606F;&#x3002;</li>
</ul>
<h4 id="&#x521B;&#x5EFA;-kubeconfig-&#x51ED;&#x636E;">&#x521B;&#x5EFA; kubeconfig &#x51ED;&#x636E;</h4>
<p>&#x5728; CI/CD &#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x901A;&#x8FC7; kubectl &#x548C; helm &#x547D;&#x4EE4;&#x64CD;&#x4F5C; Kubernetes &#x96C6;&#x7FA4;&#xFF0C;&#x8FD9;&#x5C31;&#x9700;&#x8981;&#x5728; Jenkins &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x8BBF;&#x95EE; Kubernetes &#x96C6;&#x7FA4;&#x7684;&#x51ED;&#x636E;&#xFF0C;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x89C1;&#x4E0B;&#x56FE;&#xFF1A;</p>
<figure id="fig2.7.5"><img src="https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.5%20create%20kubernetes%20credentials.jpg" alt="7.5 create jenkins kubeconfig credentials"><figcaption>7.5 create jenkins kubeconfig credentials</figcaption></figure>
<ul>
<li>Kind&#xFF1A;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x4E0A;&#x4F20;&#x7684;&#x662F; kubeconfig &#x6587;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x7C7B;&#x578B;&#x9009;&#x62E9;&#x4E3A; Secret file&#x3002;</li>
<li>File&#xFF1A;&#x9009;&#x62E9;&#x8981;&#x4E0A;&#x4F20;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x5728;&#x6F14;&#x793A;&#x4E2D;&#x6211;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x4E86; <code>~/.kube/config</code> &#x6587;&#x4EF6;&#x3002;</li>
</ul>
<h4 id="&#x521B;&#x5EFA;-ci-&#x7BA1;&#x9053;">&#x521B;&#x5EFA; CI &#x7BA1;&#x9053;</h4>
<p>CI &#x662F;&#x901A;&#x8FC7;&#x5177;&#x4F53;&#x7684; item &#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x5728;&#x5B89;&#x88C5; Jenkins &#x540E;&#xFF0C;&#x9700;&#x8981;&#x6211;&#x4EEC;&#x624B;&#x52A8;&#x521B;&#x5EFA; CI item&#x3002;</p>
<p>Item &#x7684;&#x7C7B;&#x578B;&#x6709;&#x591A;&#x79CD;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x591A;&#x5206;&#x652F;&#x6D41;&#x6C34;&#x7EBF;&#x7C7B;&#x578B;&#x3002;&#x5728;&#x9996;&#x9875;&#x70B9;&#x51FB; &#x201C;New Item&#x201D;&#xFF0C;&#x8F93;&#x5165; item &#x540D;&#x79F0;&#xFF0C;&#x6211;&#x4EEC; CI &#x793A;&#x4F8B;&#x7684; item &#x540D;&#x79F0;&#x4E3A; &#x201C;testAndRelease&#x201D;&#xFF0C;&#x70B9;&#x51FB; &#x201D;&#x591A;&#x5206;&#x652F;&#x6D41;&#x6C34;&#x7EBF;&#x201C;&#xFF0C;&#x7136;&#x540E;&#x70B9;&#x51FB; &#x201D;OK&#x201C; &#x521B;&#x5EFA;&#x3002;&#x4F1A;&#x5F39;&#x51FA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x914D;&#x7F6E;&#x9875;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x914D;&#x7F6E; &#x201C;Branch Sources&#x201D; &#x548C; &#x201C;Build Configuration&#x201D; &#x4E24;&#x4E2A;&#x90E8;&#x5206;&#xFF0C;&#x5176;&#x4ED6;&#x9ED8;&#x8BA4;&#x5373;&#x53EF;&#x3002;</p>
<p>&#x5728; &#x201C;Branch Sources&#x201D; &#x4E0B;&#x70B9;&#x51FB; &#x201D;Add source&#x201C; --&gt; &#x201C;GitHub&#x201D;&#xFF0C;&#x5728; &#x201C;Repository HTTPS URL&#x201D; &#x6846;&#x4E2D;&#x8F93;&#x5165;&#x6E90;&#x7801;&#x4ED3;&#x5E93;&#x5730;&#x5740;&#xFF0C;&#x5176;&#x4ED6;&#x5730;&#x65B9;&#x4FDD;&#x6301;&#x9ED8;&#x8BA4;&#x5373;&#x53EF;&#xFF0C;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</p>
<figure id="fig2.7.6"><img src="https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.6%20add%20https%20github%20repository.png" alt="7.6 add repo"><figcaption>7.6 add repo</figcaption></figure>
<p>&#x5728; &#x201C;Build Configuration&#x201D; &#x90E8;&#x5206;&#xFF0C;&#x201C;Mode&#x201D; &#x9009;&#x62E9;&#x9ED8;&#x8BA4;&#x7684; &#x201C;by Jenkinsfile&#x201D;&#xFF0C;&#x201C;Script Path&#x201D; &#x662F; Jenkinsfile &#x6587;&#x4EF6;&#x7684;&#x8DEF;&#x5F84;&#x53CA;&#x540D;&#x79F0;&#xFF0C;&#x6211;&#x628A; CI &#x7528;&#x5230;&#x7684; Jenkinsfile &#x653E;&#x5728;&#x4E86;&#x6E90;&#x7801;&#x4ED3;&#x5E93;&#x4E2D;&#x7684;&#x6839;&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x8D77;&#x540D;&#x4E3A; ciJenkinsfile&#xFF0C;&#x6240;&#x4EE5; &#x201C;Script Path&#x201D; &#x90E8;&#x5206;&#x53EA;&#x9700;&#x586B;&#x5199;&#x6587;&#x4EF6;&#x540D; ciJenkinsfile &#x5373;&#x53EF;&#xFF0C;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</p>
<p> <img src="https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.7%20add%20ciJenkinsfile.jpg" alt="7.7 add ci jenkinsfile"></p>
<p>&#x70B9;&#x51FB; Save&#xFF0C;&#x4FDD;&#x5B58;&#x914D;&#x7F6E;&#x540E;&#xFF0C;Jenkins &#x4F1A;&#x81EA;&#x52A8;&#x5BF9;&#x6211;&#x4EEC;&#x7684;&#x914D;&#x7F6E;&#x505A;&#x68C0;&#x67E5;&#xFF0C;&#x8F93;&#x51FA;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#x5C31;&#x662F;&#x914D;&#x7F6E;&#x5B8C;&#x6210;&#x4E86;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">Started
<span class="token punctuation">[</span>Tue Jul <span class="token number">13</span> 07:06:29 UTC <span class="token number">2021</span><span class="token punctuation">]</span> Starting branch indexing<span class="token punctuation">..</span>.
07:06:31 Connecting to https://api.github.com with no credentials, anonymous access
Examining weiwendi/learn-helm

  Checking branches<span class="token punctuation">..</span>.

  Getting remote branches<span class="token punctuation">..</span>.

    Checking branch main

  Getting remote pull requests<span class="token punctuation">..</span>.
      &#x2018;ciJenkinsfile&#x2019; found
    Met criteria
Scheduled build <span class="token keyword">for</span> branch: main

  <span class="token number">1</span> branches were processed

  Checking pull-requests<span class="token punctuation">..</span>.

  <span class="token number">0</span> pull requests were processed

Finished examining weiwendi/learn-helm

<span class="token punctuation">[</span>Tue Jul <span class="token number">13</span> 07:06:34 UTC <span class="token number">2021</span><span class="token punctuation">]</span> Finished branch indexing. Indexing took <span class="token number">5.3</span> sec
Finished: SUCCESS
</code></pre>
<p>&#x8FD9;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x7EC6;&#x5FC3;&#x7684;&#x8BDD;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0; Jenkins &#x63A7;&#x5236;&#x53F0;&#x5DE6;&#x4E0B;&#x89D2; &#x201C;Build Executor Status&#x201D; &#x4F1A;&#x6709;&#x6784;&#x5EFA;&#x4EFB;&#x52A1;&#x5728;&#x6267;&#x884C;&#xFF0C;&#x70B9;&#x51FB;&#x8FDB;&#x5EA6;&#x6761;&#xFF0C;&#x80FD;&#x591F;&#x770B;&#x5230;&#x7BA1;&#x9053;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x7684;&#x65E5;&#x5FD7;&#x4FE1;&#x606F;&#x3002;</p>
<figure id="fig2.7.7"><img src="https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.8%20scan%20repository%20build.jpg" alt="7.8 scan repo"><figcaption>7.8 scan repo</figcaption></figure>
<p>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x7ED3;&#x5408;&#x65E5;&#x5FD7;&#x8F93;&#x51FA;&#x4E0E; ciJenkinsfile &#x6587;&#x4EF6;&#xFF0C;&#x6211;&#x4EEC;&#x8BA8;&#x8BBA;&#x4E0B; CI &#x7BA1;&#x9053;&#x7684;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x3002;</p>
<h3 id="ci-&#x7BA1;&#x9053;&#x4ECB;&#x7ECD;">CI &#x7BA1;&#x9053;&#x4ECB;&#x7ECD;</h3>
<p>&#x901A;&#x8FC7; Jenkinsfile &#x521B;&#x5EFA; CI &#x7BA1;&#x9053;&#xFF0C;Jenkinsfile &#x6587;&#x4EF6;&#x4F4D;&#x4E8E; learn-helm &#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x540D;&#x79F0;&#x4E3A; ciJenkinsfile&#xFF0C;&#x53EF;&#x4EE5;&#x5728; <a href="https://github.com/weiwendi/learn-helm/blob/master/ciJenkinsfile" target="_blank">https://github.com/weiwendi/learn-helm/blob/master/ciJenkinsfile</a> &#x67E5;&#x770B;&#x6587;&#x4EF6;&#x3002;</p>
<p>ciJenkinsfile &#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code class="lang-groovy"><span class="token comment">// &#x58F0;&#x660E; CI Pipeline.</span>
pipeline <span class="token punctuation">{</span>

    <span class="token comment">// environment &#x7528;&#x4E8E;&#x8BBE;&#x7F6E;&#x53D8;&#x91CF;,&#x53D8;&#x91CF;&#x4F5C;&#x7528;&#x57DF;&#x662F;&#x8BE5;&#x7BA1;&#x9053;.</span>
    environment <span class="token punctuation">{</span>

        <span class="token comment">// &#x4E3A; Helm Charts &#x6E90;&#x4EE3;&#x7801;&#x4ED3;&#x5E93;&#x53CA; Helm Charts Package &#x4ED3;&#x5E93;&#x8BBE;&#x7F6E;&#x53D8;&#x91CF;.</span>
        <span class="token comment">// gitSourceRepo &#x4ED3;&#x5E93;&#x5305;&#x542B;&#x4E86; Helm Charts &#x7684;&#x6E90;&#x4EE3;&#x7801;&#xFF0C;&#x4E5F;&#x6709;&#x672C;&#x4E66;&#x5176;&#x4ED6;&#x76F8;&#x5173;&#x4EE3;&#x7801;&#xFF0C;&#x5982; Jenkinsfile.</span>
        <span class="token comment">// gitPackageRepo &#x662F; Helm Package &#x5B58;&#x50A8;&#x5E93;.</span>
        <span class="token comment">// &#x8FD9;&#x4E24;&#x4E2A;&#x4ED3;&#x5E93;&#x5730;&#x5740;&#xFF0C;&#x4F60;&#x90FD;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x6210; Fork &#x540E;&#x7684;&#x5730;&#x5740;.</span>
        gitSourceRepo <span class="token operator">=</span> <span class="token string">&apos;https://github.com/weiwendi/learn-helm.git&apos;</span>
        gitPackageRepo <span class="token operator">=</span> <span class="token string">&apos;https://github.com/weiwendi/charts.git&apos;</span>

        <span class="token comment">// &#x5B9A;&#x4E49;&#x51ED;&#x8BC1;&#x53D8;&#x91CF;&#xFF0C;&#x6211;&#x4EEC;&#x5728; Jenkins &#x63A7;&#x5236;&#x53F0;&#x521B;&#x5EFA;&#x4E86;&#x4E24;&#x4E2A;&#x51ED;&#x8BC1;&#xFF0C;ID &#x5206;&#x522B;&#x4E3A; github&#x3001;kubeconfig.</span>
        <span class="token comment">// &#x5728;&#x5411; gitPackageRepo &#x63A8;&#x9001; Charts &#x5305;&#x65F6;&#x4F1A;&#x7528;&#x5230; GITAUTH &#x53D8;&#x91CF;.</span>
        <span class="token comment">// KUBECONFIG &#x4F1A;&#x88AB;&#x6302;&#x5728;&#x5230; Pod &#x4E2D;&#xFF0C;&#x4E0E; Kubernetes &#x96C6;&#x7FA4;&#x8FDB;&#x884C;&#x4EA4;&#x4E92;.</span>
        GITAUTH <span class="token operator">=</span> <span class="token function">credentials</span><span class="token punctuation">(</span><span class="token string">&apos;github&apos;</span><span class="token punctuation">)</span>
        KUBECONFIG <span class="token operator">=</span> <span class="token function">credentials</span><span class="token punctuation">(</span><span class="token string">&apos;kubeconfig&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// &#x5B9A;&#x4E49;&#x6267;&#x884C; Job &#x7684; jenkins agent;</span>
    <span class="token comment">// agent &#x662F;&#x8FD0;&#x884C;&#x5728; Kubernetes &#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x4E00;&#x4E2A; Pod. </span>
    agent <span class="token punctuation">{</span>
        kubernetes <span class="token punctuation">{</span>
            yaml <span class="token string">&apos;&apos;&apos;
apiVersion: v1
kind: Pod
spec:
  serviceAccountName: jenkins
  containers:
    # &#x5B9A;&#x4E49;&#x5BB9;&#x5668;&#x7684;&#x540D;&#x79F0;
  - name: test-and-release-ci
    # &#x6307;&#x5B9A;&#x5BB9;&#x5668;&#x7684;&#x955C;&#x50CF;,&#x8BE5;&#x955C;&#x50CF;&#x5305;&#x542B;&#x4E86; helm/ct/yamllint/yamale/git/kubectl.
    # &#x955C;&#x50CF; Dockerfile &#x53EF;&#x4EE5;&#x5728;&#x6E90;&#x7801;&#x4ED3;&#x5E93;&#x7684; docker &#x76EE;&#x5F55;&#x4E0B;&#x67E5;&#x770B;.
    image: registry.cn-beijing.aliyuncs.com/sretech/cttools:latest
    command:
    - sleep
    args:
    - infinity
    resources:
      requests:
        memory: &quot;1024Mi&quot;
        cpu: &quot;1000m&quot;
      limits:
        memory: &quot;1024Mi&quot;
        cpu: &quot;1000m&quot;
&apos;&apos;&apos;</span>
            <span class="token comment">// &#x8BBE;&#x7F6E;&#x6267;&#x884C;&#x5404; stages &#x65F6;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528; test-and-release-ci &#x5BB9;&#x5668;</span>
            defaultContainer <span class="token string">&apos;test-and-release-ci&apos;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Jenkins &#x9009;&#x9879;</span>
    options <span class="token punctuation">{</span>

        <span class="token comment">// &#x663E;&#x793A;&#x6267;&#x884C;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x9700;&#x8981; Timestamper &#x63D2;&#x4EF6;&#x652F;&#x6301;.</span>
        <span class="token function">timestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment">// &#x5728; Stage View &#x4E2D;&#x5C55;&#x793A;&#x8FD1;  10 &#x6B21;&#x6784;&#x5EFA;&#x4FE1;&#x606F;</span>
        <span class="token function">buildDiscarder</span><span class="token punctuation">(</span><span class="token function">logRotator</span><span class="token punctuation">(</span>numToKeepStr<span class="token punctuation">:</span> <span class="token string">&apos;10&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// &#x5B9A;&#x4E49;&#x7BA1;&#x9053;&#x6267;&#x884C;&#x7684;&#x5404;&#x4E2A;&#x9636;&#x6BB5;&#x3001;&#x6BCF;&#x4E2A;&#x9636;&#x6BB5;&#x7684;&#x5177;&#x4F53;&#x6B65;&#x9AA4;&#xFF0C;&#x5EFA;&#x8BAE;&#x5305;&#x542B;&#x81F3;&#x5C11;&#x4E00;&#x4E2A; stage.</span>
    stages <span class="token punctuation">{</span>

        <span class="token comment">// stage &#x5B9A;&#x4E49;&#x4E86; pipeline &#x5B8C;&#x6210;&#x7684;&#x6240;&#x6709;&#x5B9E;&#x9645;&#x5DE5;&#x4F5C;.</span>
        <span class="token comment">// &#x9996;&#x5148;&#xFF0C;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x6253;&#x5370;&#x6784;&#x5EFA;&#x4FE1;&#x606F;&#x7684; stage.</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">&apos;Build Messages&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token comment">// steps &#x5B9A;&#x4E49;&#x4E86;&#x7BA1;&#x9053;&#x4E2D;&#x5177;&#x4F53;&#x6267;&#x884C;&#x7684;&#x6B65;&#x9AA4;.</span>
            steps <span class="token punctuation">{</span>

                <span class="token comment">// container &#x9009;&#x62E9;&#x54EA;&#x4E2A;&#x5BB9;&#x5668;&#x6267;&#x884C;&#x8BE5; steps&#xFF0C;&#x4E0D;&#x662F;&#x7528; container &#x9009;&#x9879;&#x7684;&#x8BDD;&#xFF0C;&#x4F1A;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x5BB9;&#x5668;&#x6267;&#x884C; steps.</span>
                <span class="token function">container</span><span class="token punctuation">(</span><span class="token string">&quot;test-and-release-ci&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    echo <span class="token string">&quot; workspace: ${WORKSPACE}\n gitPackageRepo: ${gitPackageRepo}\n gitSourceRepo: ${gitSourceRepo}\n branch: ${env.BRANCH_NAME}\n buildId: ${BUILD_ID}&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>    

        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">&quot;Copy Kubeconfig&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                script <span class="token punctuation">{</span>
                    sh <span class="token string">&apos;&apos;&apos;
                        mkdir -p ~/.kube
                        cp ${KUBECONFIG} ~/.kube/config
                    &apos;&apos;&apos;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">&quot;List Changed Charts&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                script <span class="token punctuation">{</span>
                    sh <span class="token string">&quot;ct list-changed&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">&quot;Lint&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">container</span><span class="token punctuation">(</span><span class="token string">&quot;test-and-release-ci&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    sh <span class="token string">&quot;ct lint&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">&quot;Install &amp; Test&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                script <span class="token punctuation">{</span>
                    sh <span class="token string">&quot;ct install --upgrade&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">&quot;Package Charts&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                script <span class="token punctuation">{</span>
                    sh <span class="token string">&quot;helm package --dependency-update helm-charts/charts/*&quot;</span>
                    sh <span class="token string">&quot;ls -l&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">&quot;Push Charts to Chart Repo&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                script <span class="token punctuation">{</span>
                    <span class="token keyword">def</span> baseBranch <span class="token operator">=</span> <span class="token string">&quot;main&quot;</span>

                    <span class="token comment">// &#x514B;&#x9686; Helm Chart Package &#x5305;&#x5B58;&#x50A8;&#x5E93;&#x5230; chart-repo &#x76EE;&#x5F55;.</span>
                    sh <span class="token string">&quot;git clone ${env.gitPackageRepo} chart-repo&quot;</span>

                    <span class="token comment">// &#x4F7F;&#x7528; if &#x8BED;&#x53E5;&#xFF0C;&#x6839;&#x636E;&#x5206;&#x652F;&#x5224;&#x65AD;&#x56FE;&#x8868;&#x5305;&#x5E94;&#x8BE5;&#x63A8;&#x9001;&#x5230; stable &#x6216;&#x662F; staging &#x76EE;&#x5F55;.</span>
                    <span class="token keyword">def</span> repoType
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>env<span class="token punctuation">.</span>BRANCH_NAME <span class="token operator">==</span> baseBranch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        repoType <span class="token operator">=</span> <span class="token string">&quot;stable&quot;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        repoType <span class="token operator">=</span> <span class="token string">&quot;staging&quot;</span>
                    <span class="token punctuation">}</span>

                    <span class="token comment">// &#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x521B;&#x5EFA; stable &#x6216; staging &#x76EE;&#x5F55;.</span>
                    <span class="token keyword">def</span> files <span class="token operator">=</span> <span class="token function">sh</span><span class="token punctuation">(</span>script<span class="token punctuation">:</span> <span class="token string">&quot;ls chart-repo&quot;</span><span class="token punctuation">,</span> returnStdout<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>files<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>repoType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        sh <span class="token string">&quot;mkdir chart-repo/${repoType}&quot;</span>
                    <span class="token punctuation">}</span>

                        <span class="token comment">// &#x79FB;&#x52A8;&#x56FE;&#x8868;&#x5305;&#x5230; stable &#x6216; staging &#x76EE;&#x5F55;.</span>
                        sh <span class="token string">&quot;mv *.tgz chart-repo/${repoType}/&quot;</span>

                        <span class="token comment">// &#x66F4;&#x65B0;&#x7D22;&#x5F15;&#x6587;&#x4EF6;.</span>
                        sh <span class="token string">&quot;helm repo index chart-repo/${repoType}&quot;</span>

                        <span class="token comment">// &#x66F4;&#x65B0; git &#x914D;&#x7F6E;&#x4FE1;&#x606F;&#xFF0C;&#x9700;&#x8981;&#x586B;&#x5199;&#x4F60;&#x81EA;&#x5DF1;&#x7684; github &#x90AE;&#x7BB1;&#x53CA;&#x7528;&#x6237;&#x540D;.</span>
                        sh <span class="token string">&quot;&quot;&quot;
                            git config --global user.email &apos;weiwendi@aiops.red&apos;
                            git config --global user.name &apos;weiwendi&apos;
                        &quot;&quot;&quot;</span>

                    <span class="token function">dir</span><span class="token punctuation">(</span><span class="token string">&quot;chart-repo&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Add and commit the changes</span>
                sh <span class="token string">&quot;git add --all&quot;</span>
            sh <span class="token string">&quot;git commit -m &apos;pushing charts from branch ${env.BRANCH_NAME}&apos;&quot;</span>

                        <span class="token comment">// &#x63A8;&#x9001;&#x56FE;&#x8868;&#x5305;&#x5230; gitPackageRepo &#x4ED3;&#x5E93;.</span>
            script <span class="token punctuation">{</span>
                <span class="token comment">// Inject GitHub auth and push to the repo where charts are being served</span>
                    <span class="token keyword">def</span> authRepo <span class="token operator">=</span> env<span class="token punctuation">.</span>gitPackageRepo<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&apos;://&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;://${GITAUTH_USR}:${GITAUTH_PSW}@&apos;</span><span class="token punctuation">)</span>
                sh <span class="token string">&quot;git push ${authRepo} ${baseBranch}&quot;</span>
                <span class="token punctuation">}</span>

                    <span class="token punctuation">}</span>

                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x7BA1;&#x9053;&#x5728;&#x6267;&#x884C;&#x65F6;&#xFF0C;&#x9996;&#x5148;&#x5728; Kubernetes &#x7684; cicd &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; Pod&#xFF0C;&#x4F5C;&#x4E3A; jenkins agent&#xFF0C;&#x7528;&#x6765;&#x5B8C;&#x6210;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x6784;&#x5EFA;&#x4EFB;&#x52A1;&#x3002;Pod &#x7684;&#x547D;&#x540D;&#x89C4;&#x8303;&#x662F; &#x201C;itemname-branchname-buildnumber-xx-xx&#x201D;&#x3002;</p>
<p>Pod &#x4E2D;&#x5305;&#x542B;&#x4E86;&#x4E24;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#x6211;&#x5728; ciJenkinsfile &#x6587;&#x4EF6;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#xFF0C;&#x540D;&#x79F0;&#x4E3A; &#x201C;test-and-release-ci&#x201D;&#xFF0C;&#x4F7F;&#x7528;&#x6307;&#x5B9A;&#x7684; cttools &#x955C;&#x50CF;&#xFF1B;&#x53E6;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x662F; jnlp&#xFF0C;&#x4E0E; jenkins master &#x901A;&#x4FE1;&#x3002;</p>
<p>cttools &#x955C;&#x50CF;&#x662F;&#x6211;&#x6784;&#x5EFA;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x5728; <a href="https://github.com/weiwendi/learn-helm/blob/master/docker/cttools/Dockerfile" target="_blank">https://github.com/weiwendi/learn-helm/blob/master/docker/cttools/Dockerfile</a> &#x4E2D;&#x67E5;&#x770B; Dockerfile &#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x3002;&#x955C;&#x50CF;&#x5730;&#x5740;&#x662F; registry.cn-beijing.aliyuncs.com/sretech/cttools&#xFF0C;&#x5305;&#x542B;&#x4E86;&#x7B2C;&#x516D;&#x7AE0;&#x4E2D;&#x4ECB;&#x7ECD;&#x7684;&#x4E00;&#x4E9B;&#x5DE5;&#x5177;&#xFF1A;</p>
<ul>
<li><strong>helm</strong></li>
<li><strong>ct</strong></li>
<li><strong>yamllint</strong></li>
<li><strong>yamale</strong></li>
<li><strong>git</strong></li>
<li><strong>kubectl</strong></li>
</ul>
<p>&#x7531;&#x4E8E;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#x5305;&#x542B;&#x4E86;&#x6D4B;&#x8BD5; Helm &#x56FE;&#x8868;&#x6240;&#x9700;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x4F5C;&#x4E3A;&#x6267;&#x884C; Helm &#x56FE;&#x8868;&#x7684; CI &#x7684;&#x955C;&#x50CF;&#x3002;</p>
<p>&#x5F53; Jenkins agent &#x8FD0;&#x884C;&#x65F6;&#xFF0C;&#x4F1A;&#x81EA;&#x52A8;&#x514B;&#x9686;&#x6307;&#x5B9A;&#x7684;&#x4EE3;&#x7801;&#x4ED3;&#x5E93;&#x3002;&#x8FD9;&#x662F;&#x7531; Jenkins &#x6267;&#x884C;&#x7684;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x5728; Jenkinsfile &#x4E2D;&#x914D;&#x7F6E;&#x3002;&#x53EF;&#x4EE5;&#x5728;&#x65E5;&#x5FD7;&#x4E2D;&#x770B;&#x5230;&#x8FD9;&#x4E00;&#x8FC7;&#x7A0B; &#xFF0C;&#x5728; Pod &#x521B;&#x5EFA;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x6709;&#x4E00;&#x4E2A;&#x53EB; SCM &#x7684; stage &#x88AB;&#x6267;&#x884C;&#xFF0C;&#x62C9;&#x53D6;&#x6211;&#x4EEC;&#x5728; item &#x4E2D;&#x914D;&#x7F6E;&#x7684; github &#x4ED3;&#x5E93;&#x4EE3;&#x7801;&#x3002;</p>
<p>&#x5728; Jenkins agent &#x5B8C;&#x6210;&#x514B;&#x9686;&#x540E;&#xFF0C;&#x5C31;&#x5F00;&#x59CB;&#x6267;&#x884C; Jenkinsfile &#x6587;&#x4EF6;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x9636;&#x6BB5;(stages)&#x3002;&#x9636;&#x6BB5;&#x662F;&#x7BA1;&#x9053;&#x4E2D;&#x7684;&#x903B;&#x8F91;&#x5206;&#x7EC4;&#xFF0C;&#x80FD;&#x53EF;&#x89C6;&#x5316;&#x6B65;&#x9AA4;&#x3002;&#x6267;&#x884C;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x548C; lint &#x76F8;&#x5173;&#x7684;&#x9636;&#x6BB5;&#x662F; &#x201C;lint stage&#x201D;&#xFF0C;&#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell"><span class="token function">sh</span> <span class="token string">&apos;ct lint&apos;</span>
</code></pre>
<p><strong>sh</strong> &#x7528;&#x4E8E;&#x8FD0;&#x884C; bash shell &#x547D;&#x4EE4;&#x6216;&#x8005;&#x811A;&#x672C;&#xFF0C;&#x672C;&#x5904;&#x7528;&#x4E8E;&#x6267;&#x884C; <strong>ct lint</strong> &#x5B50;&#x547D;&#x4EE4;&#xFF0C;&#x7528;&#x6765;&#x68C0;&#x6D4B;&#x6240;&#x6709;&#x9488;&#x5BF9; main &#x5206;&#x652F;&#x4FEE;&#x6539;&#x7684;&#x56FE;&#x8868;&#x4E2D;&#x7684; Chart.yaml&#x3001;values.yaml &#x6587;&#x4EF6;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x7B2C;&#x516D;&#x7AE0;&#x8BA8;&#x8BBA;&#x8FC7;&#x3002;</p>
<p>&#x5982;&#x679C;&#x68C0;&#x6D4B;&#x6210;&#x529F;&#xFF0C;&#x7BA1;&#x9053;&#x5C06;&#x6267;&#x884C;&#x4E0B;&#x4E00;&#x4E2A;&#x9636;&#x6BB5;&#xFF0C;&#x4E5F;&#x5C31;&#x662F; &#x201C;test stage&#x201D;&#xFF0C;&#x8BE5;&#x9636;&#x6BB5;&#x6267;&#x884C;&#x7684;&#x547D;&#x4EE4;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell"><span class="token function">sh</span> <span class="token string">&apos;ct install --upgrade&apos;</span>
</code></pre>
<p>&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x770B;&#x8D77;&#x6765;&#x4E5F;&#x5F88;&#x719F;&#x6089;&#x3002;&#x5B83;&#x5B89;&#x88C5;&#x4E3B;&#x5206;&#x652F;&#x4E0A;&#x7684;&#x6BCF;&#x4E2A;&#x4FEE;&#x6539;&#x8FC7;&#x7684;&#x56FE;&#x8868;&#x7248;&#x672C;&#xFF0C;&#x5E76;&#x6267;&#x884C;&#x5B9A;&#x4E49;&#x597D;&#x7684;&#x6D4B;&#x8BD5;&#x6B65;&#x9AA4;&#x3002;&#x5B83;&#x8FD8;&#x80FD;&#x786E;&#x4FDD;&#x4ECE;&#x4E0A;&#x4E00;&#x7248;&#x672C;&#x7684;&#x4EFB;&#x4F55;&#x5347;&#x7EA7;&#x90FD;&#x662F;&#x6210;&#x529F;&#x7684;&#xFF0C;&#x8FD9;&#x6709;&#x52A9;&#x4E8E;&#x5411;&#x540E;&#x517C;&#x5BB9;&#x3002;</p>
<p>&#x867D;&#x7136;&#x524D;&#x9762;&#x4E24;&#x4E2A;&#x9636;&#x6BB5;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FD0;&#x884C; <strong>ct lind-and-install --upgrade</strong> &#x547D;&#x4EE4;&#x5B9E;&#x73B0;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x4E24;&#x4E2A;&#x9636;&#x6BB5;&#x53EF;&#x4EE5;&#x5408;&#x5E76;&#x6210;&#x4E00;&#x4E2A;&#xFF0C;&#x4F46;&#x4E3A;&#x4E86;&#x66F4;&#x597D;&#x7684;&#x53EF;&#x89C6;&#x5316;&#x6240;&#x6267;&#x884C;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x628A;&#x5B83;&#x5206;&#x89E3;&#x6210;&#x4E86;&#x4E0D;&#x540C;&#x7684;&#x9636;&#x6BB5;&#x3002;</p>
<p>&#x5982;&#x679C; &#x201C;test stage&#x201D; &#x6267;&#x884C;&#x6210;&#x529F;&#xFF0C;&#x7BA1;&#x9053;&#x5C06;&#x7EE7;&#x7EED;&#x6267;&#x884C; &#x201C;package charts stage&#x201D; &#x9636;&#x6BB5;&#xFF0C;&#x547D;&#x4EE4;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell"><span class="token function">sh</span> <span class="token string">&apos;helm package --dependency-update helm-charts/charts/*&apos;</span>
</code></pre>
<p>&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x5C06; helm-charts/charts &#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x56FE;&#x8868;&#x6253;&#x5305;&#xFF0C;&#x5B83;&#x8FD8;&#x5C06;&#x66F4;&#x65B0;&#x548C;&#x4E0B;&#x8F7D;&#x58F0;&#x660E;&#x7684;&#x4F9D;&#x8D56;&#x9879;&#x3002;</p>
<p>&#x5982;&#x679C;&#x6253;&#x5305;&#x6210;&#x529F;&#xFF0C;&#x7BA1;&#x9053;&#x5C06;&#x8FDB;&#x5165;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x9636;&#x6BB5; &#x201C;Push Charts to gitPackageRepo&#x201D;&#x3002;&#x8FD9;&#x662F;&#x6700;&#x590D;&#x6742;&#x7684;&#x9636;&#x6BB5;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5C06;&#x5B83;&#x62C6;&#x5206;&#x6210;&#x66F4;&#x5C0F;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x7B2C;&#x4E00;&#x6B65;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">// &#x514B;&#x9686; Helm Chart Package &#x5305;&#x5B58;&#x50A8;&#x5E93;&#x5230; chart-repo &#x76EE;&#x5F55;.
<span class="token function">sh</span> <span class="token string">&quot;git clone <span class="token variable">${env.gitPackageRepo}</span> chart-repo&quot;</span>

// &#x4F7F;&#x7528; <span class="token keyword">if</span> &#x8BED;&#x53E5;&#xFF0C;&#x6839;&#x636E;&#x5206;&#x652F;&#x5224;&#x65AD;&#x56FE;&#x8868;&#x5305;&#x5E94;&#x8BE5;&#x63A8;&#x9001;&#x5230; stable &#x6216;&#x662F; staging &#x76EE;&#x5F55;.
def repoType
<span class="token keyword">if</span> <span class="token punctuation">(</span>env.BRANCH_NAME <span class="token operator">==</span> baseBranch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    repoType <span class="token operator">=</span> <span class="token string">&quot;stable&quot;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    repoType <span class="token operator">=</span> <span class="token string">&quot;staging&quot;</span>
<span class="token punctuation">}</span>

// &#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x521B;&#x5EFA; stable &#x6216; staging &#x76EE;&#x5F55;.
def files <span class="token operator">=</span> sh<span class="token punctuation">(</span>script: <span class="token string">&quot;ls chart-repo&quot;</span>, returnStdout: <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>files.contains<span class="token punctuation">(</span>repoType<span class="token punctuation">))</span> <span class="token punctuation">{</span>
    <span class="token function">sh</span> <span class="token string">&quot;mkdir chart-repo/<span class="token variable">${repoType}</span>&quot;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x8981;&#x63A8;&#x9001;&#x5230;&#x7684; Helm &#x56FE;&#x8868;&#x5B58;&#x50A8;&#x5E93;&#x662F;&#x5355;&#x72EC;&#x7684; GitHub &#x9875;&#x9762;&#xFF0C;&#x56E0;&#x6B64;&#x5FC5;&#x987B;&#x5148;&#x5C06;&#x5B58;&#x50A8;&#x5E93;&#x514B;&#x9686;&#x5230; Jenkins agent &#x672C;&#x5730;&#xFF0C;&#x4EE5;&#x4FBF;&#x6DFB;&#x52A0;&#x65B0;&#x56FE;&#x8868;&#x5E76;&#x63A8;&#x9001;&#x4FEE;&#x6539;&#x3002;&#x514B;&#x9686; GitHub &#x5B58;&#x50A8;&#x5E93;&#x540E;&#xFF0C;&#x5C06;&#x6839;&#x636E; CI/CD &#x7BA1;&#x9053;&#x8FD0;&#x884C;&#x7684;&#x5206;&#x652F;&#x8BBE;&#x7F6E;&#x540D;&#x4E3A; repoType &#x7684;&#x53D8;&#x91CF;&#x3002;&#x6B64;&#x53D8;&#x91CF;&#x7528;&#x4E8E;&#x786E;&#x5B9A;&#x5C06;&#x524D;&#x4E00;&#x9636;&#x6BB5;&#x6253;&#x5305;&#x7684;&#x56FE;&#x8868;&#x63A8;&#x9001;&#x5230; stable(&#x7A33;&#x5B9A;) &#x6216; staging(&#x4E34;&#x65F6;) &#x56FE;&#x8868;&#x5B58;&#x50A8;&#x5E93;&#x4E2D;&#x3002;</p>
<p>stable &#x548C; staging &#x4F5C;&#x4E3A;&#x4E24;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x56FE;&#x8868;&#x5B58;&#x50A8;&#x5E93;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5728; GitHub &#x9875;&#x9762;&#x521B;&#x5EFA;&#x4E24;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x76EE;&#x5F55;&#x6765;&#x5B9E;&#x73B0;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">  charts/
  stable/
  staging/
</code></pre>
<p>stable &#x548C; staging &#x76EE;&#x5F55;&#x4E2D;&#x4F1A;&#x5305;&#x542B;&#x81EA;&#x5DF1;&#x7684; index.yaml &#x6587;&#x4EF6;&#xFF0C;&#x7528;&#x4E8E;&#x628A;&#x5B83;&#x4EEC;&#x533A;&#x5206;&#x4E3A;&#x4E0D;&#x540C;&#x7684;&#x56FE;&#x8868;&#x5B58;&#x50A8;&#x5E93;&#x3002;</p>
<p>&#x5982;&#x679C;&#x57FA;&#x4E8E;&#x5206;&#x652F;&#x7684;&#x7BA1;&#x9053;&#x6267;&#x884C;&#x4F9D;&#x8D56;&#x4E8E;&#x8FD9;&#x4E24;&#x4E2A;&#x76EE;&#x5F55;&#xFF0C;&#x4E3A;&#x65B9;&#x4FBF;&#x8D77;&#x89C1;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x4E0A;&#x4E00;&#x4E2A;&#x9636;&#x6BB5;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x5B83;&#x4EEC;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x5DF2;&#x7ECF;&#x786E;&#x5B9A;&#x4E86;&#x56FE;&#x8868;&#x5E94;&#x63A8;&#x9001;&#x5230;&#x7684;&#x5B58;&#x50A8;&#x5E93;&#xFF0C;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x4E0B;&#x4E00;&#x4E2A;&#x9636;&#x6BB5;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell"><span class="token function">sh</span> <span class="token string">&quot;&quot;</span>&quot;
    // &#x5C06;&#x56FE;&#x8868;&#x5305;&#x79FB;&#x52A8;&#x5230; chart-repo &#x7684; stable &#x6216; staging &#x76EE;&#x5F55;&#x4E2D;.
    <span class="token function">mv</span> *.tgz chart-repo/<span class="token variable">${repoType}</span>/

    // &#x66F4;&#x65B0; index.html.
    helm repo index chart-repo/<span class="token variable">${repoType}</span>

    // &#x66F4;&#x65B0; <span class="token function">git</span> &#x914D;&#x7F6E;&#x4FE1;&#x606F;&#xFF0C;&#x9700;&#x8981;&#x628A;&#x90AE;&#x7BB1;&#x3001;&#x7528;&#x6237;&#x540D;&#x6539;&#x4E3A;&#x4F60;&#x81EA;&#x5DF1;&#x7684;.
    <span class="token function">git</span> config --global user.email <span class="token string">&apos;weiwendi@aiops.red&apos;</span>
    <span class="token function">git</span> config --global user.name <span class="token string">&apos;weiwendi&apos;</span>
<span class="token string">&quot;&quot;</span>&quot;
</code></pre>
<p>&#x7B2C;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;&#x5C06;&#x4E0A;&#x4E00;&#x4E2A;&#x9636;&#x6BB5;&#x4E2D;&#x6253;&#x7684;&#x56FE;&#x8868;&#x5305;&#x590D;&#x5236;&#x5230; stable/ &#x548C; staging/ &#x76EE;&#x5F55;&#x4E2D;&#x3002;&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x4F7F;&#x7528; <strong>helm repo index</strong> &#x547D;&#x4EE4;&#x66F4;&#x65B0; stable/ &#x6216; staging/ &#x76EE;&#x5F55;&#x4E2D;&#x7684; index.yaml &#x6587;&#x4EF6;&#xFF0C;&#x4EE5;&#x53CD;&#x6620;&#x66F4;&#x6539;&#x6216;&#x589E;&#x52A0;&#x7684;&#x56FE;&#x8868;&#x3002;</p>
<p>&#x9700;&#x8981;&#x8BB0;&#x4F4F;&#x7684;&#x4E00;&#x70B9;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x56FE;&#x8868;&#x5B58;&#x50A8;&#x5E93;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x6BD4;&#x5982; ChartMuseum(&#x4E00;&#x4E2A;&#x7531;Helm&#x793E;&#x533A;&#x7EF4;&#x62A4;&#x7684;&#x56FE;&#x8868;&#x5E93;&#x89E3;&#x51B3;&#x65B9;&#x6848;)&#xFF0C;&#x90A3;&#x4E48; <strong>helm repo index</strong> &#x547D;&#x4EE4;&#x5C31;&#x4E0D;&#x9700;&#x8981;&#x4E86;&#x3002;&#x5F53; ChartMuseum &#x6536;&#x5230;&#x4E00;&#x4E2A;&#x65B0;&#x6253;&#x5305;&#x7684; Helm &#x56FE;&#x8868;&#x65F6;&#xFF0C; index.yaml &#x6587;&#x4EF6;&#x4F1A;&#x81EA;&#x52A8;&#x66F4;&#x65B0;&#x3002;&#x5BF9;&#x4E8E;&#x4E0D;&#x81EA;&#x52A8;&#x66F4;&#x65B0; index.yaml &#x6587;&#x4EF6;&#x7684;&#xFF0C;&#x4F8B;&#x5982; GitHub &#x9875;&#x9762;&#xFF0C;<strong>helm repo index</strong> &#x547D;&#x4EE4;&#x662F;&#x5FC5;&#x987B;&#x7684;&#xFF0C;&#x6B63;&#x5982;&#x6211;&#x4EEC;&#x5728;&#x8FD9;&#x4E2A;&#x7BA1;&#x9053;&#x4E2D;&#x770B;&#x5230;&#x7684;&#x3002;</p>
<p>&#x8BE5;&#x9636;&#x6BB5;&#x4E2D;&#x7684;&#x6700;&#x540E;&#x4E24;&#x6761;&#x547D;&#x4EE4;&#x7528;&#x6765;&#x8BBE;&#x7F6E; git &#x90AE;&#x7BB1;&#x548C;&#x7528;&#x6237;&#x540D;&#xFF0C;&#x8FD9;&#x662F;&#x63D0;&#x4EA4;&#x5185;&#x5BB9;&#x5230; git &#x5B58;&#x50A8;&#x5E93;&#x5FC5;&#x987B;&#x7684;&#x6B65;&#x9AA4;&#x3002;&#x5728;&#x672C;&#x4F8B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x7528;&#x6237;&#x540D;&#x8BBE;&#x7F6E;&#x4E3A; weiwendi&#xFF0C;&#x90AE;&#x7BB1;&#x8BBE;&#x7F6E;&#x4E3A; weiwendi@aiops.red&#xFF0C;&#x8FD9;&#x4E9B;&#x90FD;&#x662F;&#x793A;&#x4F8B;&#xFF0C;&#x5728;&#x64CD;&#x4F5C;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x628A;&#x5B83;&#x4EEC;&#x6539;&#x6210;&#x4F60;&#x7684;&#x771F;&#x5B9E;&#x90AE;&#x7BB1;&#x548C;&#x7528;&#x6237;&#x540D;&#x3002;</p>
<p>&#x6700;&#x540E;&#x4E00;&#x6B65;&#x662F; push &#x64CD;&#x4F5C;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">dir<span class="token punctuation">(</span><span class="token string">&quot;chart-repo&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    // Add and commit the changes.
    <span class="token function">sh</span> <span class="token string">&quot;&quot;</span>&quot;
        <span class="token function">git</span> <span class="token function">add</span> --all
        <span class="token function">git</span> commit -m <span class="token string">&apos;pushing charts from branch ${env.BRANCH_NAME}&apos;</span>
    <span class="token string">&quot;&quot;</span>&quot;

    // &#x63A8;&#x9001;&#x56FE;&#x8868;&#x5305;&#x5230; gitPackageRepo &#x4ED3;&#x5E93;.
    script <span class="token punctuation">{</span>
        // Inject GitHub auth and push to the repo where charts are being served
        def authRepo <span class="token operator">=</span> env.gitPackageRepo.replace<span class="token punctuation">(</span><span class="token string">&quot;://&quot;</span>, <span class="token string">&quot;://<span class="token variable">${GITAUTH_USR}</span>:<span class="token variable">${GITAUTH_PSW}</span>@&quot;</span><span class="token punctuation">)</span>
        <span class="token function">sh</span> <span class="token string">&quot;git push <span class="token variable">${authRepo}</span> <span class="token variable">${baseBranch}</span>&quot;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<p>&#x9996;&#x5148;&#x4F7F;&#x7528; <strong>git add</strong> &#x548C; <strong>git commit</strong> &#x547D;&#x4EE4;&#x6DFB;&#x52A0;&#x548C;&#x63D0;&#x4EA4;&#x56FE;&#x8868;&#x5305;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x4F7F;&#x7528; <strong>git push</strong> &#x547D;&#x4EE4;&#x63A8;&#x9001;&#x5230;&#x5B58;&#x50A8;&#x5E93;&#xFF0C;&#x63A8;&#x9001;&#x65F6;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; GITAUTH &#x7684;&#x51ED;&#x636E;&#x53D8;&#x91CF;&#x3002;&#x8FD9;&#x4E2A;&#x51ED;&#x8BC1;&#x662F;&#x5B89;&#x88C5;&#x671F;&#x95F4;&#x901A;&#x8FC7; Jenkins &#x63A7;&#x5236;&#x53F0;&#x521B;&#x5EFA;&#x7684;&#x51ED;&#x636E;&#x3002;GITAUTH &#x51ED;&#x636E;&#x53EF;&#x4EE5;&#x5B89;&#x5168;&#x7684;&#x5F15;&#x7528;&#x5BC6;&#x7801;&#xFF0C;&#x4ECE;&#x800C;&#x907F;&#x514D;&#x5728;&#x7BA1;&#x9053;&#x4EE3;&#x7801;&#x4E2D;&#x4EE5;&#x660E;&#x6587;&#x7684;&#x5F62;&#x5F0F;&#x663E;&#x793A;&#x5BC6;&#x7801;&#x3002;</p>
<p>Helm &#x793E;&#x533A;&#x53D1;&#x5E03;&#x4E86;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; Chart Releaser &#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x5B83;&#x901A;&#x8FC7;&#x8C03;&#x7528; <strong>helm repo index</strong> &#x547D;&#x4EE4;&#x751F;&#x6210; index.yaml &#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x4F7F;&#x7528; <strong>git push</strong> &#x5C06;&#x5176;&#x63A8;&#x9001;&#x5230; GitHub&#x3002;Chart Releaser &#x5DE5;&#x5177;&#x65E8;&#x5728;&#x901A;&#x8FC7;&#x7BA1;&#x7406; GitHub &#x9875;&#x9762;&#x4E2D;&#x5305;&#x542B;&#x7684; Helm &#x56FE;&#x8868;&#xFF0C;&#x6765;&#x62BD;&#x8C61;&#x8FD9;&#x4E9B;&#x989D;&#x5916;&#x7684;&#x590D;&#x6742;&#x6027;&#x3002;&#x4E0D;&#x8FC7;&#xFF0C;&#x6211;&#x4EEC;&#x51B3;&#x5B9A;&#x4E0D;&#x5728;&#x672C;&#x7AE0;&#x4E2D;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x6765;&#x5B9E;&#x73B0;&#x7BA1;&#x9053;&#xFF0C;&#x56E0;&#x4E3A; Chart Releaser &#x4E0D;&#x652F;&#x6301; Helm 3(&#x5728;&#x64B0;&#x5199;&#x672C;&#x6587;&#x65F6;)&#x3002;</p>
<p>&#x5728;&#x6784;&#x5EFA;&#x65E5;&#x5FD7;&#x4E2D;&#xFF0C;Stage &#x7684; steps &#x524D;&#x90FD;&#x4F1A;&#x663E;&#x793A;&#x6267;&#x884C;&#x65F6;&#x95F4;&#xFF0C;&#x8FD9;&#x662F;&#x7531; options.timestamps() &#x5B9A;&#x4E49;&#x7684;&#x3002;&#x6240;&#x6709; stage &#x6267;&#x884C;&#x5B8C;&#x6210;&#xFF0C;&#x6700;&#x540E;&#x8F93;&#x51FA; <code>Finished&#xFF1A;SUCCESS</code> &#x5B57;&#x6BB5;&#xFF0C;&#x6574;&#x4E2A; CI &#x7BA1;&#x9053;&#x4E5F;&#x5C31;&#x6210;&#x529F;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x4E86;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x719F;&#x6089;&#x4E86; CI &#x7BA1;&#x9053;&#x7684;&#x6982;&#x8FF0;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x6765;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x793A;&#x4F8B;&#x3002;</p>
<h3 id="&#x8FD0;&#x884C;-ci-&#x7BA1;&#x9053;">&#x8FD0;&#x884C; CI &#x7BA1;&#x9053;</h3>
<p>&#x6211;&#x4EEC;&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x4ECB;&#x7ECD;&#x8FC7;&#xFF0C;&#x5728;&#x4FDD;&#x5B58; item &#x914D;&#x7F6E;&#x540E;&#xFF0C;&#x4F1A;&#x89E6;&#x53D1; &#x201C;Scan Repositor&#x201C; &#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x9488;&#x5BF9;&#x914D;&#x7F6E;&#x7684;&#x5206;&#x652F;&#x81EA;&#x52A8;&#x8FD0;&#x884C; CI &#x7BA1;&#x9053;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; Jenkins &#x9875;&#x9762;&#x7684; &#x201D;testAndRelease&#x201C; &#x8FDE;&#x63A5;&#x67E5;&#x770B;&#x3002;&#x4F60;&#x4F1A;&#x770B;&#x5230;&#x4E00;&#x4E2A;&#x6210;&#x529F;&#x6267;&#x884C;&#x7684; Job&#xFF0C;&#x8FD0;&#x884C;&#x5728; main &#x5206;&#x652F;&#x4E0A;&#x3002;</p>
<p>Jenkins &#x4E2D;&#x7684;&#x6BCF;&#x4E2A; pipeline &#x6784;&#x5EFA;&#x90FD;&#x5305;&#x542B;&#x6267;&#x884C;&#x8F93;&#x51FA;&#x7684;&#x76F8;&#x5173;&#x65E5;&#x5FD7;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x70B9;&#x51FB;&#x5DE6;&#x4FA7;&#x84DD;&#x8272;&#x5706;&#x5708;&#x65C1;&#x8FB9;&#x7684;&#x94FE;&#x63A5;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x4E0B;&#x4E00;&#x4E2A;&#x5C4F;&#x5E55;&#x4E0A;&#x9009;&#x62E9; <strong>Console Output</strong> &#x67E5;&#x770B;&#x6784;&#x5EFA;&#x65E5;&#x5FD7;&#x3002;&#x8FD9;&#x4E2A;&#x6784;&#x5EFA;&#x65E5;&#x5FD7;&#x663E;&#x793A;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A; stage <strong>Lint</strong> &#x6210;&#x529F;&#x5730;&#x663E;&#x793A;&#x4E86;&#x4EE5;&#x4E0B;&#x4FE1;&#x606F;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">All charts linted successfully

----------------------------------

No chart changes detected.

This is what we would <span class="token function">expect</span> because no charts were changed from the perspective of the master branch. A similar output can be seen under the <span class="token function">install</span> stage as well:

All charts installed successfully

-----------------------------------

No chart changes detected.

Because both the Lint and Install stages completed without error, the pipeline continued to the Package Charts stage. Here, you can view the output::

+ helm package --dependency-update helm-charts/charts/player-stats helm-charts/charts/nginx

Successfully packaged chart and saved it to: /home/jenkins/agent/workspace/t_and_Release_Helm_Charts_master/player-stats-1.0.0.tgz

Successfully packaged chart and saved it to: /home/jenkins/agent/workspace/t_and_Release_Helm_Charts_master/nginx-1.0.0.tgz

Finally, the pipeline concludes by cloning your GitHub Pages repository, creating a stable folder within it, copying the packaged charts over to the stable folder, committing the changes to the GitHub Pages repository locally, and pushing the changes to GitHub. We can observe that each <span class="token function">file</span> that was added to our repository is outputted <span class="token keyword">in</span> the following lines:

+ <span class="token function">git</span> commit -m <span class="token string">&apos;pushing charts from branch master&apos;</span>

<span class="token punctuation">[</span>master 9769f5a<span class="token punctuation">]</span> pushing charts from branch master

<span class="token number">3</span> files changed, <span class="token number">32</span> insertions<span class="token punctuation">(</span>+<span class="token punctuation">)</span>

create mode <span class="token number">100644</span> stable/player-stats-1.0.0.tgz

create mode <span class="token number">100644</span> stable/index.yaml

create mode <span class="token number">100644</span> stable/nginx-1.0.0.tgz
</code></pre>
<p>GitHub &#x5B58;&#x50A8;&#x5E93;&#x5728;&#x81EA;&#x52A8;&#x63A8;&#x9001;&#x540E;&#xFF0C;&#x9875;&#x9762;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF0C;&#x8BF7;&#x5FFD;&#x7565; CNAME &#x6587;&#x4EF6;&#xFF1A;</p>
<figure id="fig2.7.8"><img src="https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.9%20charts%20repo%20list.jpg" alt="7.9 charts repo list"><figcaption>7.9 charts repo list</figcaption></figure>
<p>&#x5728; stable &#x6587;&#x4EF6;&#x5939;&#x4E2D;&#xFF0C;&#x4F60;&#x5E94;&#x8BE5;&#x80FD;&#x591F;&#x770B;&#x5230;&#x4E09;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x6587;&#x4EF6;&#xFF1A;&#x4E24;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x56FE;&#x8868;&#x548C;&#x4E00;&#x4E2A; index.yaml &#x6587;&#x4EF6;&#xFF1A;</p>
<figure id="fig2.7.9"><img src="https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.10%20stable%20list.jpg" alt="7.10 stable list"><figcaption>7.10 stable list</figcaption></figure>
<p>&#x7B2C;&#x4E00;&#x4E2A; pipeline &#x6784;&#x5EFA;&#x6210;&#x529F;&#x5730;&#x521B;&#x5EFA;&#x4E86;&#x521D;&#x59CB;&#x7684; stable &#x56FE;&#x8868;&#x96C6;&#xFF0C;&#x4F46;&#x5B83;&#x6CA1;&#x6709;&#x6F14;&#x793A;&#x5982;&#x4F55;&#x5728;&#x65B0;&#x56FE;&#x8868;&#x88AB;&#x8BA4;&#x4E3A;&#x7A33;&#x5B9A;&#xFF0C;&#x5E76;&#x51C6;&#x5907;&#x597D;&#x4F9B;&#x6700;&#x7EC8;&#x7528;&#x6237;&#x4F7F;&#x7528;&#x524D;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x68C0;&#x67E5;&#x548C;&#x6D4B;&#x8BD5;&#x3002;&#x4E3A;&#x4E86;&#x6F14;&#x793A;&#x8FD9;&#x4E00;&#x70B9;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4ECE; main &#x5206;&#x652F;&#x4E0A;&#x68C0;&#x51FA;&#x4E00;&#x4E2A; feature &#x5206;&#x652F;&#xFF0C;&#x7528;&#x6765;&#x4FEE;&#x6539;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x56FE;&#x8868;&#xFF0C;&#x5E76;&#x5C06;&#x66F4;&#x6539;&#x63A8;&#x9001;&#x5230; feature &#x5206;&#x652F;&#xFF0C;&#x7136;&#x540E;&#x5728; Jenkins &#x4E2D;&#x5F00;&#x59CB;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x6784;&#x5EFA;&#x3002;</p>
<p>&#x9996;&#x5148;&#xFF0C;&#x5728; main &#x5206;&#x652F;&#x4E0A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; chapter7 &#x7684;&#x65B0;&#x5206;&#x652F;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">$ <span class="token builtin class-name">cd</span> charts
$ <span class="token function">git</span> checkout main
$ <span class="token function">git</span> checkout -b chapter7
</code></pre>
<p>&#x5728;&#x8FD9;&#x4E2A;&#x5206;&#x652F;&#x4E0A;&#xFF0C;&#x6211;&#x4EEC;&#x7B80;&#x5355;&#x7684;&#x4FEE;&#x6539; nginx &#x56FE;&#x8868;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x4EE5;&#x89E6;&#x53D1;&#x56FE;&#x8868;&#x7684; linting &#x548C; testing&#x3002;Nginx &#x662F;&#x4E00;&#x4E2A; WEB &#x670D;&#x52A1;&#x5668;&#x548C;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#xFF0C;&#x5B83;&#x6BD4; player-stats &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8981;&#x8F7B;&#x91CF;&#x7684;&#x591A;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x5305;&#x5B58;&#x50A8;&#x5E93;&#x4E2D;&#x7684; nginx &#x56FE;&#x8868;&#xFF0C;&#x4EE5;&#x907F;&#x514D; Minikube &#x4E2D;&#x8FD0;&#x884C; Jenkins &#x65F6;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x7684;&#x8D44;&#x6E90;&#x9650;&#x5236;&#x3002;</p>
<p>&#x5C06; helm-charts/charts/nginx/Chart.yaml &#x6587;&#x4EF6;&#x4E2D; version &#x7684;&#x503C;&#x4ECE; 1.0.0 &#x6539;&#x4E3A; 1.0.1&#xFF1A;</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> 1.0.1
</code></pre>
<p>&#x6267;&#x884C; <strong>git status</strong> &#x547D;&#x4EE4;&#x67E5;&#x770B;&#x66F4;&#x6539;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">$ <span class="token function">git</span> status

On branch chapter7
Changes not staged <span class="token keyword">for</span> commit:
  <span class="token punctuation">(</span>use <span class="token string">&apos;git add &lt;file&gt;...&apos;</span> to update what will be committed<span class="token punctuation">)</span>
  <span class="token punctuation">(</span>use <span class="token string">&apos;git checkout -- &lt;file&gt;...&apos;</span> to discard changes <span class="token keyword">in</span> working directory<span class="token punctuation">)</span>
        modified:   helm-charts/charts/nginx/Chart.yaml
no changes added to commit <span class="token punctuation">(</span>use <span class="token string">&apos;git add&apos;</span> and/or <span class="token string">&apos;git commit -a&apos;</span><span class="token punctuation">)</span>
</code></pre>
<p>nginx &#x56FE;&#x8868;&#x7684; Chart.yaml &#x6587;&#x4EF6;&#x5DF2;&#x7ECF;&#x88AB;&#x4FEE;&#x6539;&#xFF0C;add &#x4FEE;&#x6539;&#x540E;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C; commit&#xFF0C;&#x6700;&#x540E;&#x5C06;&#x5176;&#x63A8;&#x9001;&#x5230;&#x4F60;&#x7684; Fork&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">$ <span class="token function">git</span> <span class="token function">add</span> helm-charts
$ <span class="token function">git</span> commit -m <span class="token string">&apos;bumping NGINX chart version to demonstrate chart testing pipeline&apos;</span>
$ <span class="token function">git</span> push origin chapter7
</code></pre>
<p>&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728; Jenkins &#x4E2D;&#x89E6;&#x53D1;&#x626B;&#x63CF;&#x5B58;&#x50A8;&#x5E93;&#xFF0C;&#x4EE5;&#x4FBF; Jenkins &#x80FD;&#x591F;&#x68C0;&#x6D4B;&#x5E76;&#x9488;&#x5BF9;&#x8FD9;&#x4E2A;&#x5206;&#x652F;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x6784;&#x5EFA;&#x3002;&#x70B9;&#x51FB; &#x201C;testAndRelease&#x201D; &#x6309;&#x94AE;&#xFF0C;&#x70B9;&#x51FB;&#x5DE6;&#x4FA7;&#x680F;&#x83DC;&#x5355;&#x4E2D;&#x7684;  &#x201C;Scan Repository Now&#x201D; &#x6309;&#x94AE;&#xFF0C;&#x89E6;&#x53D1; Jenkins &#x68C0;&#x6D4B;&#x65B0;&#x5206;&#x652F;&#xFF0C;&#x5E76;&#x81EA;&#x52A8;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x6784;&#x5EFA;&#x3002;&#x626B;&#x63CF;&#x5927;&#x7EA6;10&#x79D2;&#x5185;&#x5B8C;&#x6210;&#x3002;&#x5237;&#x65B0;&#x9875;&#x9762;&#xFF0C;&#x65B0;&#x7684; chapter7 &#x5206;&#x652F;&#x5C06;&#x51FA;&#x73B0;&#x5728;&#x9875;&#x9762;&#x4E0A;&#x3002;</p>
<p>chapter7 job &#x4F1A;&#x6BD4; main job &#x6267;&#x884C;&#x66F4;&#x957F;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x56E0;&#x4E3A; chapter7 job &#x5305;&#x542B;&#x4E00;&#x4E2A;&#x4FEE;&#x6539;&#x7684; Helm &#x56FE;&#x8868;&#xFF0C;&#x8BE5;&#x56FE;&#x8868;&#x4F1A;&#x4F7F;&#x7528; testing &#x5DE5;&#x5177;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#x3002;&#x53EF;&#x4EE5;&#x5728; chapter7 job &#x7684;&#x8F93;&#x51FA;&#x4E2D;&#x67E5;&#x770B; pipeline &#x7684;&#x64CD;&#x4F5C;&#x3002;pipeline &#x6267;&#x884C;&#x7ED3;&#x675F;&#xFF0C;&#x4F1A;&#x663E;&#x793A;&#x4EE5;&#x4E0B;&#x4FE1;&#x606F;&#xFF1A;</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">Finished</span><span class="token punctuation">:</span> SUCCESS
</code></pre>
<p>&#x5728;&#x63A7;&#x5236;&#x53F0;&#x8F93;&#x51FA;&#x7684;&#x65E5;&#x5FD7;&#x5F00;&#x5934;&#x90E8;&#x5206;&#xFF0C;&#x8BF7;&#x6CE8;&#x610F; <strong>ct lint</strong> &#x548C; <strong>ct install</strong> &#x547D;&#x4EE4;&#x662F;&#x5982;&#x4F55;&#x9488;&#x5BF9; nginx chart &#x8FD0;&#x884C;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x662F;&#x552F;&#x4E00;&#x53D1;&#x751F;&#x4FEE;&#x6539;&#x7684; chart&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">Charts to be processed:

---------------------------------------------------------------

nginx <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>version: <span class="token string">&apos;1.0.1&apos;</span>, path: <span class="token string">&apos;helm-charts/charts/nginx&apos;</span><span class="token punctuation">)</span>
</code></pre>
<p>&#x8FD9;&#x4E9B;&#x547D;&#x4EE4;&#x7684;&#x8F93;&#x51FA;&#x4F60;&#x5E94;&#x8BE5;&#x5DF2;&#x7ECF;&#x5F88;&#x719F;&#x6089;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x7B2C;&#x516D;&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x63A5;&#x89E6;&#x8FC7;&#x4E86;&#x3002;</p>
<p>&#x5728; GitHub &#x9875;&#x9762;&#xFF0C;&#x4F60;&#x5E94;&#x8BE5;&#x4F1A;&#x770B;&#x5230; staging &#x6587;&#x4EF6;&#x5939;&#x4E2D;&#x65B0;&#x7248;&#x672C;&#x7684; nginx chart&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4E0D;&#x662F;&#x57FA;&#x4E8E; main &#x5206;&#x652F;&#x6784;&#x5EFA;&#x7684;&#x3002;</p>
<p>&#x8981;&#x53D1;&#x5E03; nginx-1.0.1.tgz &#x56FE;&#x8868;&#xFF0C;&#x9700;&#x8981;&#x5C06; chapter7 &#x5206;&#x652F;&#x5408;&#x5E76;&#x5230; main &#x5206;&#x652F;&#xFF0C;&#x5E76;&#x63A8;&#x9001;&#x5230;&#x8FDC;&#x7A0B;&#x5E93;&#x4E2D;&#xFF0C;&#x547D;&#x4EE4;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">$ <span class="token function">git</span> checkout main
$ <span class="token function">git</span> merge chapter7
$ <span class="token function">git</span> push origin main
</code></pre>
<p>&#x8FD4;&#x56DE; &#x201C;testAndRelease&#x201D; Jenkins &#x9875;&#x9762;&#xFF0C;&#x70B9;&#x51FB; main job&#xFF0C;&#x70B9;&#x51FB;&#x8BE5;&#x9875;&#x9762;&#x5DE6;&#x4FA7;&#x680F;&#x7684; &#x201C;Build Now&#x201D; &#x6309;&#x94AE;&#x3002;&#x4ECE;&#x8F93;&#x51FA;&#x65E5;&#x5FD7;&#x4E2D;&#x770B;&#x5230;&#xFF0C;&#x56FE;&#x8868;&#x6D4B;&#x8BD5;&#x88AB;&#x8DF3;&#x8FC7;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A; chart testing tool &#x5C06; clone &#x4E0E; main &#x5206;&#x652F;&#x8FDB;&#x884C;&#x4E86;&#x6BD4;&#x8F83;&#xFF0C;&#x7531;&#x4E8E;&#x5185;&#x5BB9;&#x76F8;&#x540C;&#xFF0C;tool &#x51B3;&#x5B9A;&#x4E0D;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#x3002;&#x5F53;&#x6784;&#x5EFA;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x5728; GitHub &#x9875;&#x9762;&#x770B;&#x5230; <strong>nginx-1.0.1.tgz</strong> &#x56FE;&#x8868;&#x5728; stable &#x5B58;&#x50A8;&#x5E93;&#x4E2D;&#x3002;</p>
<p>&#x4F7F;&#x7528; <strong>helm repo add</strong> &#x547D;&#x4EE4;&#x5728;&#x672C;&#x5730;&#x6DFB;&#x52A0;&#x5B58;&#x50A8;&#x5E93;&#xFF0C;&#x9A8C;&#x8BC1;&#x8FD9;&#x4E9B;&#x56FE;&#x8868;&#x662F;&#x5426;&#x5DF2;&#x6B63;&#x786E;&#x53D1;&#x5E03;&#x5230; GitHub stable &#x5B58;&#x50A8;&#x5E93;&#x4E2D;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">$ helm repo <span class="token function">add</span> aiops <span class="token variable">$gitPackageRepoPage</span>/stable
</code></pre>
<p>$gitPackageRepoPage &#x7684;&#x503C;&#x662F; GitHub &#x7AD9;&#x70B9;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5B9E;&#x9645;&#x7684; git &#x5B58;&#x50A8;&#x5E93;&#x3002;&#x5730;&#x5740;&#x683C;&#x5F0F;&#x7C7B;&#x4F3C;&#x4E8E; <a href="https://$GITHUB_USERNAME.github.io/charts/stable&#xFF0C;&#x8BE5;&#x94FE;&#x63A5;&#x53EF;&#x4EE5;&#x5728;" target="_blank">https://$GITHUB_USERNAME.github.io/charts/stable&#xFF0C;&#x8BE5;&#x94FE;&#x63A5;&#x53EF;&#x4EE5;&#x5728;</a> GitHub &#x9875;&#x9762;&#x7684; &#x201C;Settings&#x201D; &#x6807;&#x7B7E;&#x4E2D;&#x627E;&#x5230;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x5728; &#x201C;Settings&#x201D; &#x7684; &#x201C;Page&#x201D; &#x4E2D;&#x914D;&#x7F6E;&#x4E86; CNAME&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x7684;&#x5730;&#x5740;&#x53EF;&#x4EE5;&#x662F; <a href="https://charts.aiops.red/stable&#x3002;" target="_blank">https://charts.aiops.red/stable&#x3002;</a></p>
<p>&#x6DFB;&#x52A0;&#x4E86; stable &#x5B58;&#x50A8;&#x5E93;&#x540E;&#xFF0C;&#x8FD0;&#x884C;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x67E5;&#x770B;&#x5728;&#x4E24;&#x6B21; main &#x6784;&#x5EFA;&#x8FC7;&#x7A0B;&#x4E2D;&#x6784;&#x5EFA;&#x548C;&#x63A8;&#x9001;&#x7684;&#x5B58;&#x50A8;&#x5E93;&#x4E2D;&#x7684;&#x56FE;&#x8868;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">$ helm search repo aiops --versions
</code></pre>
<p>&#x5728;&#x672C;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x8BA8;&#x8BBA;&#x4E86;&#x5982;&#x4F55;&#x901A;&#x8FC7; CI pipeline &#x7BA1;&#x7406; Helm &#x56FE;&#x8868;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x3002;&#x6839;&#x636E;&#x793A;&#x4F8B;&#xFF0C;&#x901A;&#x8FC7;&#x9075;&#x5FAA;&#x81EA;&#x52A8;&#x5316;&#x5DE5;&#x4F5C;&#x6D41;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5728;&#x5411;&#x7528;&#x6237;&#x53D1;&#x5E03;&#x56FE;&#x8868;&#x4E4B;&#x524D;&#x8F7B;&#x677E;&#x5730;&#x6267;&#x884C;&#x4F8B;&#x884C;&#x68C0;&#x67E5;&#x548C;&#x6D4B;&#x8BD5;&#x4E86;&#x3002;</p>
<p>&#x4E0B;&#x4E00;&#x8282;&#xFF0C;&#x6211;&#x4EEC;&#x4ECB;&#x7ECD;&#x4F7F;&#x7528; CD pipeline&#xFF0C;&#x5C06; helm &#x56FE;&#x8868;&#x90E8;&#x7F72;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x73AF;&#x5883;&#x4E2D;&#x3002;</p>
<h2 id="&#x521B;&#x5EFA;-cd-&#x7BA1;&#x9053;&#x90E8;&#x7F72;-helm-&#x56FE;&#x8868;">&#x521B;&#x5EFA; CD &#x7BA1;&#x9053;&#x90E8;&#x7F72; Helm &#x56FE;&#x8868;</h2>
<p>CD &#x7BA1;&#x9053;&#x662F;&#x4E00;&#x7EC4;&#x53EF;&#x91CD;&#x590D;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x5355;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x4EE5;&#x81EA;&#x52A8;&#x5316;&#x7684;&#x65B9;&#x5F0F;&#x90E8;&#x7F72;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;&#x5728;&#x672C;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; CD &#x7BA1;&#x9053;&#x6765;&#x90E8;&#x7F72; Nginx &#x56FE;&#x8868;&#xFF0C;&#x5728;&#x4E0A;&#x4E00;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x628A;&#x5B83;&#x63A8;&#x9001;&#x5230;&#x4E86; GitHub &#x5B58;&#x50A8;&#x5E93;&#x3002;GitOps &#x8FD8;&#x53EF;&#x4EE5;&#x5E94;&#x7528;&#x4FDD;&#x5B58;&#x5230; <strong>git</strong> &#x5B58;&#x50A8;&#x5E93;&#x4E2D;&#x7684;&#x503C;&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x6765;&#x68B3;&#x7406;&#x4E00;&#x4E0B;&#x6B64;&#x7BA1;&#x9053;&#x4E2D;&#x6709;&#x54EA;&#x4E9B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li>&#x6DFB;&#x52A0;&#x5305;&#x542B; Nginx &#x56FE;&#x8868; release &#x7684; GitHub stable &#x5E93;&#x3002;</li>
<li>&#x5C06; Nginx &#x56FE;&#x8868;&#x90E8;&#x7F72;&#x5230;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x4E2D;&#x3002;</li>
<li>&#x5C06; Nginx &#x56FE;&#x8868;&#x90E8;&#x7F72;&#x5230; QA(Quality Assurance ) &#x73AF;&#x5883;&#x4E2D;&#x3002;</li>
<li>&#x7B49;&#x5F85;&#x7528;&#x6237;&#x6279;&#x51C6;&#x7BA1;&#x9053;&#x8FDB;&#x884C;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x90E8;&#x7F72;&#x3002;</li>
<li>&#x5C06; Nginx &#x56FE;&#x8868;&#x90E8;&#x7F72;&#x5230;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x3002;</li>
</ol>
<p>CD &#x5DE5;&#x4F5C;&#x6D41;&#x5305;&#x542B;&#x5728;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684; Jenkinsfile &#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x8BE5;&#x6587;&#x4EF6;&#x7684;&#x540D;&#x79F0;&#x662F; cdJenkinsfile&#x3002;&#x4E0E; ciJenkinsfile &#x4E0D;&#x540C;&#xFF0C;&#x5728;&#x521B;&#x5EFA; cdJenkinsfile &#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x66F4;&#x65B0; Minikube &#x548C; Jenkins &#x73AF;&#x5883;&#xFF0C;&#x4EE5;&#x4FBF;&#x6267;&#x884C; CD &#x6D41;&#x7A0B;&#x3002;</p>
<h3 id="&#x66F4;&#x65B0;&#x73AF;&#x5883;">&#x66F4;&#x65B0;&#x73AF;&#x5883;</h3>
<p>&#x5728; Minikube &#x4E2D;&#x521B;&#x5EFA;&#x4E09;&#x4E2A;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x5BF9;&#x5E94;&#x5F00;&#x53D1;&#x3001;QA&#x548C;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x3002;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x6F14;&#x793A; CD &#x6D41;&#x7A0B;&#xFF0C;&#x5728;&#x5B9E;&#x9645;&#x4F7F;&#x7528;&#x4E2D;&#xFF0C;&#x4E0D;&#x5EFA;&#x8BAE;&#x628A;&#x975E;&#x751F;&#x4EA7;&#x73AF;&#x5883;(&#x5F00;&#x53D1;&#x548C;QA)&#x548C;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x90E8;&#x7F72;&#x5728;&#x4E00;&#x4E2A;&#x96C6;&#x7FA4;&#x4E2D;&#x3002;</p>
<p>&#x521B;&#x5EFA; dev&#x3001;qa&#x3001;prod &#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x90E8;&#x7F72;&#x4E0D;&#x540C;&#x7684;&#x73AF;&#x5883;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">$ kubectl create ns dev
$ kubectl create ns qa
$ kubectl create ns prod
</code></pre>
<p>&#x5220;&#x9664; chapter7 &#x5206;&#x652F;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x521B;&#x5EFA;&#x65B0;&#x7684; CD &#x7BA1;&#x9053;&#x65F6;&#xFF0C;Jenkins &#x4F1A;&#x5C1D;&#x8BD5;&#x5728;&#x6BCF;&#x4E2A;&#x5206;&#x652F;&#x4E0A;&#x6267;&#x884C;&#x5B83;&#xFF0C;&#x4E3A;&#x4E86;&#x7B80;&#x5355;&#x548C;&#x907F;&#x514D;&#x8D44;&#x6E90;&#x53D7;&#x9650;&#xFF0C;&#x6211;&#x4EEC;&#x4EC5;&#x4F7F;&#x7528; main &#x5206;&#x652F;&#x3002;</p>
<p>&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x4ECE;&#x5B58;&#x50A8;&#x5E93;&#x4E2D;&#x79FB;&#x9664; chapter7 &#x5206;&#x652F;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">$ <span class="token function">git</span> push -d origin chapter7
$ <span class="token function">git</span> branch -D chapter7
</code></pre>
<p>&#x6700;&#x540E;&#xFF0C;&#x5728; Jenkins &#x63A7;&#x5236;&#x53F0;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; &#x201C;deployNginxChart&#x201D; &#x7684; item&#xFF0C;&#x6B65;&#x9AA4;&#x548C;&#x521B;&#x5EFA; &#x201C;testAndRelease&#x201D; &#x4E00;&#x6837;&#xFF0C;&#x552F;&#x4E00;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x9700;&#x8981;&#x628A; Jenkinsfile &#x7684;&#x540D;&#x5B57;&#x4ECE; &#x201C;ciJenkinsfile&#x201D; &#x6539;&#x4E3A; &#x201C;cdJenkinsfile&#x201D;&#x3002;</p>
<p>&#x4FDD;&#x5B58;&#x914D;&#x7F6E;&#x540E;&#xFF0C;&#x540C;&#x6837;&#x4F1A;&#x6267;&#x884C;&#x4EE3;&#x7801;&#x5E93;&#x626B;&#x63CF;&#xFF0C;&#x5E76;&#x81EA;&#x52A8;&#x6267;&#x884C; CD &#x7BA1;&#x9053;&#x3002;</p>
<h3 id="cd-&#x7BA1;&#x9053;&#x4ECB;&#x7ECD;">CD &#x7BA1;&#x9053;&#x4ECB;&#x7ECD;</h3>
<p>&#x5728;&#x672C;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x4ECB;&#x7ECD;&#x7BA1;&#x9053;&#x7684;&#x4E3B;&#x8981;&#x90E8;&#x5206;&#xFF0C;&#x5B8C;&#x6574;&#x7684; CD &#x7BA1;&#x9053;&#x53EF;&#x4EE5;&#x53C2;&#x8003; <a href="https://github.com/weiwendi/learn-helm/blob/master/cdJenkinsfile&#x3002;" target="_blank">https://github.com/weiwendi/learn-helm/blob/master/cdJenkinsfile&#x3002;</a></p>
<p>&#x4E0E; CI &#x7BA1;&#x9053;&#x4E00;&#x6837;&#xFF0C;&#x4E3A;&#x4E86;&#x6D4B;&#x8BD5;&#x548C;&#x53D1;&#x5E03; Helm &#x56FE;&#x8868;&#xFF0C;CD &#x7BA1;&#x9053;&#x9996;&#x5148;&#x5728; Kubernetes &#x4E2D;&#x52A8;&#x6001;&#x7684;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; Jenkins Agent Pod&#x3002;</p>
<p>Agent &#x521B;&#x5EFA;&#x5B8C;&#x6210;&#x540E;&#xFF0C;Jenkins &#x5C31;&#x4F1A;&#x9690;&#x5F0F;&#x5730; clone &#x4F60; fork &#x7684;&#x6E90;&#x4EE3;&#x7801;&#x4ED3;&#x5E93;&#x4E86;&#xFF0C;&#x5C31;&#x50CF;&#x4E4B;&#x524D;&#x5728; CI pipeline &#x4E2D;&#x6240;&#x4F5C;&#x7684;&#x90A3;&#x6837;&#x3002;</p>
<p>Pipeline &#x5B9A;&#x4E49;&#x7684;&#x7B2C;&#x4E09;&#x4E2A; stage &#x662F; Add Chart&#xFF0C;&#x5B83;&#x5C06; GitHub stable &#x5B58;&#x50A8;&#x5E93;&#x4E2D;&#x7684;&#x56FE;&#x8868;&#x6DFB;&#x52A0;&#x5230; Jenkins Agent &#x7684;&#x672C;&#x5730; Helm &#x5BA2;&#x6237;&#x7AEF;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell"><span class="token function">sh</span> <span class="token string">&quot;helm repo add aiops <span class="token variable">${env.gitPackageRepoPage}</span>/stable&quot;</span>
</code></pre>
<p>&#x6DFB;&#x52A0;&#x5B58;&#x50A8;&#x5E93;&#x4E4B;&#x540E;&#xFF0C;&#x7BA1;&#x9053;&#x5C31;&#x53EF;&#x4EE5;&#x5C06; Nginx &#x90E8;&#x7F72;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x73AF;&#x5883;&#x4E2D;&#x4E86;&#x3002;&#x4E0B;&#x4E00;&#x6B65;&#xFF0C;&#x90E8;&#x7F72; Nginx &#x56FE;&#x8868;&#x5230; dev &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#xFF0C;&#x5E76;&#x6253;&#x5370;&#x51FA;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#xFF0C;&#x65B9;&#x4FBF;&#x6211;&#x4EEC;&#x67E5;&#x770B;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">dir<span class="token punctuation">(</span><span class="token string">&quot;nginx-cd&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">sh</span> <span class="token string">&quot;&quot;</span>&quot;
        helm upgrade --install nginx-<span class="token variable">${env.BRANCH_NAME}</span> aiops/nginx --values common-values.yaml --values dev/values.yaml -n dev --wait
        kubectl -n dev <span class="token builtin class-name">exec</span> deploy/nginx-<span class="token variable">${env.BRANCH_NAME}</span> -- <span class="token function">env</span> <span class="token operator">|</span> <span class="token function">grep</span> ENVIRONMENT
    <span class="token string">&quot;&quot;</span>&quot;
<span class="token punctuation">}</span>
</code></pre>
<p><strong>dir(&apos;nginx-cd&apos;)</strong> &#x662F; Jenkins &#x7684;&#x8BED;&#x6CD5;&#xFF0C;&#x7528;&#x4E8E;&#x8BBE;&#x7F6E;&#x6267;&#x884C;&#x547D;&#x4EE4;&#x7684;&#x5DE5;&#x4F5C;&#x76EE;&#x5F55;&#x3002;&#x5728;&#x8FD9;&#x4E2A; stage &#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x7ED9; <strong>helm upgrade</strong> &#x547D;&#x4EE4;&#x63D0;&#x4F9B;&#x4E86; <strong>--install</strong> &#x6807;&#x5FD7;&#x3002;&#x5F53; release &#x5B58;&#x5728;&#x65F6;&#xFF0C;&#x6267;&#x884C; <strong>helm upgrade</strong> &#x4F1A;&#x5BF9; release &#x8FDB;&#x884C;&#x5347;&#x7EA7;&#xFF0C;&#x5982;&#x679C; release &#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x5219;&#x4F1A;&#x6267;&#x884C;&#x5931;&#x8D25;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86; <strong>--install</strong> &#x6807;&#x5FD7;&#xFF0C;&#x5F53; release &#x4E0D;&#x5B58;&#x5728;&#x65F6;&#xFF0C;&#x4F1A;&#x5B89;&#x88C5;&#x56FE;&#x8868;&#xFF0C;&#x8FD9;&#x5927;&#x5927;&#x589E;&#x52A0;&#x4E86;&#x81EA;&#x52A8;&#x5316;&#x7684;&#x7A0B;&#x5EA6;&#x3002;</p>
<p>&#x5728;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4F20;&#x9012;&#x4E86;&#x4E24;&#x4E2A;&#x503C;&#x6587;&#x4EF6;&#xFF1A;commmon-values.yaml &#x548C; dev/values.yaml&#x3002;&#x8FD9;&#x4E24;&#x4E2A;&#x6587;&#x4EF6;&#x90FD;&#x5728; nginx-cd &#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x76EE;&#x5F55;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">nginx-cd/
&#x251C;&#x2500;&#x2500; common-values.yaml
&#x251C;&#x2500;&#x2500; dev
&#x2502;   &#x2514;&#x2500;&#x2500; values.yaml
&#x251C;&#x2500;&#x2500; prod
&#x2502;   &#x2514;&#x2500;&#x2500; values.yaml
&#x2514;&#x2500;&#x2500; qa
    &#x2514;&#x2500;&#x2500; values.yaml
</code></pre>
<p>&#x5C06;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x90E8;&#x7F72;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x73AF;&#x5883;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7A0D;&#x5FAE;&#x4FEE;&#x6539;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x4EE5;&#x4FBF;&#x4E0E;&#x73AF;&#x5883;&#x4E2D;&#x7684;&#x5176;&#x5B83;&#x670D;&#x52A1;&#x96C6;&#x6210;&#xFF0C;&#x6BD4;&#x5982;&#x6570;&#x636E;&#x5E93;&#x5730;&#x5740;&#x3002;dev&#x3001;qa &#x548C; prod &#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x7684;&#x503C;&#x6587;&#x4EF6;&#xFF0C;&#x90FD;&#x5305;&#x542B;&#x4E86;&#x4E00;&#x4E2A;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#xFF0C;&#x8BE5;&#x53D8;&#x91CF;&#x662F;&#x5728; Nginx &#x90E8;&#x7F72;&#x65F6;&#x8BBE;&#x7F6E;&#x7684;&#xFF0C;&#x5177;&#x4F53;&#x53D6;&#x51B3;&#x4E8E;&#x8981;&#x90E8;&#x7F72;&#x5230;&#x7684;&#x73AF;&#x5883;&#x3002;&#x4F8B;&#x5982; dev/values.yaml &#x6587;&#x4EF6;&#x5185;&#x5BB9;&#xFF1A;</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">envVars</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ENVIRONMENT
  <span class="token key atrule">value</span><span class="token punctuation">:</span> dev
</code></pre>
<p>&#x540C;&#x6837;&#x7684;&#xFF0C;qa/values.yaml &#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">envVars</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ENVIRONMENT
    <span class="token key atrule">value</span><span class="token punctuation">:</span> qa
</code></pre>
<p>prod/values.yaml &#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">envVars</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ENVIRONMENT
    <span class="token key atrule">value</span><span class="token punctuation">:</span> prod
</code></pre>
<p>&#x867D;&#x7136;&#x672C;&#x793A;&#x4F8B;&#x4E2D;&#x90E8;&#x7F72;&#x7684; Nginx &#x56FE;&#x8868;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5E76;&#x4E0D;&#x4E25;&#x683C;&#x8981;&#x6C42;&#x6307;&#x5B9A;&#x8FD9;&#x4E9B;&#x503C;&#xFF0C;&#x4F46;&#x53EF;&#x80FD;&#x4F60;&#x5DF2;&#x7ECF;&#x53D1;&#x73B0;&#x4E86;&#xFF0C;&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x5728;&#x5355;&#x72EC;&#x7684;&#x503C;&#x6587;&#x4EF6;&#x4E2D;&#x5206;&#x79BB;&#x7279;&#x5B9A;&#x4E8E;&#x67D0;&#x4E2A;&#x73AF;&#x5883;&#x914D;&#x7F6E;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x6709;&#x52A9;&#x4E8E;&#x5904;&#x7406;&#x5B9E;&#x9645;&#x73AF;&#x5883;&#x4E2D;&#x66F4;&#x590D;&#x6742;&#x7684;&#x7528;&#x4F8B;&#xFF0C;&#x6BD4;&#x5982;&#x4E0D;&#x540C;&#x73AF;&#x5883;&#xFF0C;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x4E2D;&#x95F4;&#x4EF6;&#x5730;&#x5740;&#x3002;&#x76F8;&#x5E94;&#x7684;&#x503C;&#x6587;&#x4EF6;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x53D8;&#x91CF;&#x7684;&#x5F62;&#x5F0F;&#x4F20;&#x9012;&#xFF0C;&#x5982; <strong>helm upgrade --install command with --values ${env}/values.yaml</strong>&#xFF0C;&#x5176;&#x4E2D; ${env} &#x8868;&#x793A; dev&#x3001;qa&#x3001;prod&#x3002;</p>
<p>common-values.yaml &#x6587;&#x4EF6;&#x4ECE;&#x6587;&#x4EF6;&#x540D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x7528;&#x4E8E;&#x914D;&#x7F6E;&#x5404;&#x73AF;&#x5883;&#x7684;&#x901A;&#x7528;&#x503C;&#x3002;common-values.yaml &#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">service</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
</code></pre>
<p>&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x5B9A;&#x4E49;&#x4E86;&#x5728;&#x56FE;&#x8868;&#x5B89;&#x88C5;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x521B;&#x5EFA;&#x7684; Nginx service &#x7C7B;&#x578B;&#x4E3A; NodePort&#xFF0C;&#x5728; values.yaml &#x6587;&#x4EF6;&#x4E2D;&#x8BBE;&#x7F6E;&#x7684;&#x5176;&#x5B83;&#x503C;&#xFF0C;&#x4E5F;&#x4F1A;&#x5E94;&#x7528;&#x4E8E;&#x6BCF;&#x4E2A;&#x73AF;&#x5883;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x6CA1;&#x6709;&#x88AB; common-values.yaml &#x6216;&#x72EC;&#x7ACB;&#x7684; values.yaml &#x6587;&#x4EF6;&#x8986;&#x76D6;&#x3002;</p>
<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5728;&#x6BCF;&#x4E2A;&#x73AF;&#x5883;&#x4E2D;&#x5E94;&#x8BE5;&#x4EE5;&#x76F8;&#x540C;&#x7684;&#x65B9;&#x5F0F;&#x90E8;&#x7F72;&#x3002;&#x4EFB;&#x4F55;&#x6539;&#x53D8;&#x8FD0;&#x884C;&#x4E2D;&#x7684; Pod &#x6216;&#x5BB9;&#x5668;&#x7684;&#x5C5E;&#x6027;&#x503C;&#xFF0C;&#x90FD;&#x5E94;&#x8BE5;&#x5728; common-values.yaml &#x6587;&#x4EF6;&#x4E2D;&#x5B9A;&#x4E49;&#xFF0C;&#x8FD9;&#x4E9B;&#x914D;&#x7F6E;&#x5305;&#x62EC;&#x4F46;&#x4E0D;&#x9650;&#x4E8E;&#xFF1A;</p>
<ul>
<li>replica &#x6570;&#x91CF;</li>
<li>&#x8D44;&#x6E90;&#x7684; requests &#x548C; limits &#x503C;</li>
<li>service &#x7C7B;&#x578B;</li>
<li>image &#x540D;&#x79F0;</li>
<li>image tag</li>
<li>imagePullPolicy</li>
<li>values &#x6302;&#x8F7D;</li>
</ul>
<p>&#x53EF;&#x4EE5;&#x9488;&#x5BF9;&#x7279;&#x5B9A;&#x73AF;&#x5883;&#x72EC;&#x7ACB;&#x4FEE;&#x6539;&#x7684;&#x503C;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x5EA6;&#x91CF;&#x6216;&#x76D1;&#x63A7;&#x670D;&#x52A1;&#x7684;&#x5730;&#x5740;</li>
<li>&#x6570;&#x636E;&#x5E93;&#x6216;&#x540E;&#x7AEF;&#x670D;&#x52A1;&#x5730;&#x5740;</li>
<li>&#x5E94;&#x7528;&#x5BF9;&#x5916;&#x66B4;&#x9732;&#x7684; ingress URL</li>
<li>&#x901A;&#x77E5;&#x670D;&#x52A1;</li>
</ul>
<p>&#x7EE7;&#x7EED;&#x4ECB;&#x7ECD; &#x201C;Deploy to Dev&#x201D; stage &#x4E2D;&#x7684; <strong>helm</strong> &#x547D;&#x4EE4;&#xFF0C; &#x5B83;&#x4F7F;&#x7528;&#x4E86; common-values.yaml&#x3001;dev/values.yaml &#x4E24;&#x4E2A;&#x503C;&#x6587;&#x4EF6;&#xFF0C;&#x8FD9;&#x4E24;&#x4E2A;&#x503C;&#x6587;&#x4EF6;&#x88AB;&#x7528;&#x6765;&#x5728; dev &#x4E2D;&#x5B89;&#x88C5; nginx &#x56FE;&#x8868;&#x3002;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x8FD8;&#x4F7F;&#x7528;&#x4E86; <strong>-n dev</strong> &#x6807;&#x5FD7;&#xFF0C;&#x7528;&#x6765;&#x6307;&#x5B9A;&#x5728; dev &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x90E8;&#x7F72; Nginx &#x56FE;&#x8868;&#x3002;<strong>--wait</strong> &#x6807;&#x5FD7;&#x7528;&#x4E8E;&#x6682;&#x7F13;&#x8F93;&#x51FA;&#x521B;&#x5EFA;&#x4FE1;&#x606F;&#xFF0C;&#x76F4;&#x5230; Pod &#x5904;&#x4E8E; reday &#x72B6;&#x6001;&#x3002;</p>
<p>&#x5728; CD &#x7BA1;&#x9053;&#x4E2D;&#xFF0C;&#x628A;&#x5E94;&#x7528;&#x90E8;&#x7F72;&#x5230; dev &#x4E4B;&#x540E;&#x7684;&#x4E0B;&#x4E00;&#x4E2A; stage &#x662F;&#x5192;&#x70DF;&#x6D4B;&#x8BD5;&#xFF0C;&#x6267;&#x884C;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell"><span class="token function">sh</span> <span class="token string">&quot;helm test nginx-<span class="token variable">${env.BRANCH_NAME}</span> -n dev&quot;</span>
</code></pre>
<p>Nginx &#x56FE;&#x8868;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x68C0;&#x67E5; Nginx Pod &#x8FDE;&#x63A5;&#x7684; test &#x94A9;&#x5B50;&#x3002;&#x5982;&#x679C; test &#x94A9;&#x5B50;&#x80FD;&#x591F;&#x8FDE;&#x63A5;&#x5230; Pod&#xFF0C;&#x5219; test &#x8FD4;&#x56DE;&#x6210;&#x529F;&#x3002;&#x867D;&#x7136; <strong>helm test</strong> &#x547D;&#x4EE4;&#x5E38;&#x7528;&#x4E8E;&#x56FE;&#x8868;&#x6D4B;&#x8BD5;&#xFF0C;&#x4F46;&#x5B83;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x4E8E; CD &#x8FC7;&#x7A0B;&#x4E2D;&#x6267;&#x884C;&#x57FA;&#x672C;&#x5192;&#x70DF;&#x6D4B;&#x8BD5;&#x3002;&#x5192;&#x70DF;&#x6D4B;&#x8BD5;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x786E;&#x4FDD;&#x7A0B;&#x5E8F;&#x90E8;&#x7F72;&#x540E;&#x5173;&#x952E;&#x529F;&#x80FD;&#x662F;&#x6309;&#x7167;&#x8BBE;&#x8BA1;&#x5DE5;&#x4F5C;&#x7684;&#x3002;&#x7531;&#x4E8E; Nginx &#x56FE;&#x8868;&#x6D4B;&#x8BD5;&#x4E0D;&#x4F1A;&#x4EE5;&#x4EFB;&#x4F55;&#x65B9;&#x5F0F;&#x5E72;&#x6270;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6216;&#x90E8;&#x7F72;&#x73AF;&#x5883;&#x7684;&#x5176;&#x5B83;&#x5E94;&#x7528;&#xFF0C;&#x56E0;&#x6B64; <strong>helm test</strong> &#x547D;&#x4EE4;&#x662F;&#x786E;&#x4FDD; Nginx &#x56FE;&#x8868;&#x6210;&#x529F;&#x90E8;&#x7F72;&#x7684;&#x9002;&#x5F53;&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x5192;&#x70DF;&#x6D4B;&#x8BD5;&#x5B8C;&#x6210;&#x540E;&#xFF0C;CD &#x7BA1;&#x9053;&#x5C06;&#x6267;&#x884C;&#x4E0B;&#x4E00;&#x4E2A; stage&#x2014;&#x2014;&#x201C;Deploy to QA&#x201D;&#x3002;&#x6B64; stage &#x5305;&#x542B;&#x4E00;&#x4E2A;&#x6761;&#x4EF6;&#xFF0C;&#x7528;&#x4E8E;&#x8BC4;&#x4F30;&#x7BA1;&#x9053;&#x6B63;&#x5728;&#x6267;&#x884C;&#x7684;&#x5F53;&#x524D;&#x5206;&#x652F;&#x662F;&#x5426;&#x4E3A; main &#x5206;&#x652F;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">when <span class="token punctuation">{</span>
  expression <span class="token punctuation">{</span>
    <span class="token builtin class-name">return</span> env.BRANCH_NAME <span class="token operator">==</span> <span class="token string">&apos;main&apos;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x6B64;&#x6761;&#x4EF6;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; feature &#x5206;&#x652F;&#x6765;&#x6D4B;&#x8BD5; values.yaml &#x4E2D;&#x7684;&#x503C;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5C06;&#x5176;&#x653E;&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x6D4B;&#x8BD5;&#xFF0C;main &#x5206;&#x652F;&#x4E2D;&#x5305;&#x542B;&#x7684; helm &#x503C;&#x5E94;&#x8BE5;&#x662F;&#x751F;&#x4EA7;&#x5C31;&#x7EEA;&#x7684;&#x3002;</p>
<p><strong>Deploy to QA</strong> &#x4F7F;&#x7528;&#x7684;&#x547D;&#x4EE4;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">dir<span class="token punctuation">(</span><span class="token string">&quot;nginx-cd&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">sh</span> <span class="token string">&quot;&quot;</span>&quot;
        helm upgrade --install nginx-<span class="token variable">${env.BRANCH_NAME}</span> aiops/nginx --values common-values.yaml --values qa/values.yaml -n qa --wait
        kubectl -n qa <span class="token builtin class-name">exec</span> deploy/nginx-<span class="token variable">${env.BRANCH_NAME}</span> -- <span class="token function">env</span> <span class="token operator">|</span> <span class="token function">grep</span> ENVIRONMENT
    <span class="token string">&quot;&quot;</span>&quot;
<span class="token punctuation">}</span>
</code></pre>
<p>&#x8FD9;&#x6761;&#x547D;&#x4EE4;&#x548C; &#x201C;Deploy to DEV&#x201D; stage &#x91CC;&#x7684;&#x547D;&#x4EE4;&#x76F8;&#x4F3C;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x518D;&#x8BE6;&#x8FF0;&#x4E86;&#x3002;</p>
<p>&#x5728;&#x90E8;&#x7F72;&#x5230; QA &#x6216;&#x7C7B;&#x4F3C;&#x7684;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;&#x4E4B;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x518D;&#x6B21;&#x8FD0;&#x884C;&#x5192;&#x70DF;&#x6D4B;&#x8BD5;&#xFF0C;&#x4EE5;&#x786E;&#x4FDD; QA &#x90E8;&#x7F72;&#x7684;&#x57FA;&#x672C;&#x529F;&#x80FD;&#x90FD;&#x80FD;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x3002;&#x5728;&#x8FD9;&#x4E2A; stage&#xFF0C;&#x4F60;&#x8FD8;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x5176;&#x4ED6;&#x7684;&#x81EA;&#x52A8;&#x5316;&#x6D4B;&#x8BD5;&#xFF0C;&#x5728;&#x5C06;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x90E8;&#x7F72;&#x5230; prod &#x4E4B;&#x524D;&#x9A8C;&#x8BC1;&#x5176;&#x529F;&#x80FD;&#x662F;&#x975E;&#x5E38;&#x5FC5;&#x8981;&#x7684;&#x3002;&#x6211;&#x5728;&#x8FD9;&#x4E2A;&#x793A;&#x4F8B;&#x7BA1;&#x9053;&#x4E2D;&#x7701;&#x7565;&#x4E86;&#x8FD9;&#x4E9B;&#x6D4B;&#x8BD5;&#x7EC6;&#x8282;&#x3002;</p>
<p>&#x7BA1;&#x9053;&#x7684;&#x4E0B;&#x4E00;&#x4E2A; stage &#x662F; <strong>Wait for Input</strong>&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">stage<span class="token punctuation">(</span><span class="token string">&quot;Wait for Input&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    when <span class="token punctuation">{</span>
        expression <span class="token punctuation">{</span>
            <span class="token builtin class-name">return</span> env.BRANCH_NAME <span class="token operator">==</span> <span class="token string">&quot;main&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    steps <span class="token punctuation">{</span>
        input <span class="token string">&quot;Deploy to Prod?&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x8FD9;&#x4E00;&#x6B65;&#x4F1A;&#x6682;&#x505C;&#x6267;&#x884C; CD Pipeline&#xFF0C;&#x5E76;&#x63D0;&#x793A;&#x7528;&#x6237;&#x662F;&#x5426;&#x7EE7;&#x7EED; &#x201C;Deploy to Prod&#x201D;&#xFF1F;&#x5728;&#x8FD0;&#x884C; job &#x7684;&#x63A7;&#x5236;&#x53F0;&#x65E5;&#x5FD7;&#x4E2D;&#xFF0C;&#x7ED9;&#x7528;&#x6237;&#x4E24;&#x4E2A;&#x9009;&#x9879;&#x2014;&#x2014;&#x201C;Proceed&#x201D; &#x548C; &#x201C;Abort&#x201D;&#x3002;&#x867D;&#x7136;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x7684;&#x90E8;&#x7F72;&#x53EF;&#x4EE5;&#x81EA;&#x52A8;&#x6267;&#x884C;&#xFF0C;&#x4F46;&#x8BB8;&#x591A;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x53EF;&#x80FD;&#x66F4;&#x503E;&#x5411;&#x5728;&#x975E;&#x751F;&#x4EA7;&#x90E8;&#x7F72;&#x548C;&#x751F;&#x4EA7;&#x90E8;&#x7F72;&#x4E4B;&#x95F4;&#x8BBE;&#x7F6E;&#x4E00;&#x9053;&#x95F8;&#x3002;&#x8FD9;&#x4E2A; <strong>input</strong> &#x547D;&#x4EE4;&#x4E3A;&#x7528;&#x6237;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x673A;&#x4F1A;&#xFF0C;&#x6765;&#x51B3;&#x5B9A;&#x662F;&#x7EE7;&#x7EED;&#x90E8;&#x7F72;&#x8FD8;&#x662F;&#x5728;&#x90E8;&#x7F72; QA &#x4E4B;&#x540E;&#x7EC8;&#x6B62; CD &#x7BA1;&#x9053;&#x3002;</p>
<p>&#x5982;&#x679C;&#x7528;&#x6237;&#x51B3;&#x5B9A;&#x7EE7;&#x7EED;&#xFF0C;&#x5219;&#x6267;&#x884C;&#x6700;&#x540E;&#x4E00;&#x4E2A; stage&#xFF1A;Deploy to Prod&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">dir<span class="token punctuation">(</span><span class="token string">&quot;nginx-cd&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">sh</span> <span class="token string">&quot;&quot;</span>&quot;
        helm upgrade --install nginx-<span class="token variable">${env.BRANCH_NAME}</span> aiops/nginx --values common-values.yaml --values prod/values.yaml -n prod --wait
        kubectl -n prod <span class="token builtin class-name">exec</span> deploy/nginx-<span class="token variable">${env.BRANCH_NAME}</span> -- <span class="token function">env</span> <span class="token operator">|</span> <span class="token function">grep</span> ENVIRONMENT
    <span class="token string">&quot;&quot;</span>&quot;
<span class="token punctuation">}</span>
</code></pre>
<p>&#x8FD9;&#x4E2A; stage &#x4E0E; &#x201C;Deploy to Dev&#x201D; &#x548C; &#x201C;Deploy to QA&#x201D; &#x4E24;&#x4E2A; stage &#x51E0;&#x4E4E;&#x76F8;&#x540C;&#xFF0C;&#x9664;&#x4E86;&#x503C;&#x548C;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x3002;</p>
<p>&#x6574;&#x4E2A; CD &#x7BA1;&#x9053;&#x4ECB;&#x7ECD;&#x5B8C;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x4E00;&#x4E0B;&#x5B83;&#x7684;&#x6267;&#x884C;&#x3002;</p>
<h3 id="&#x8FD0;&#x884C;-cd-&#x7BA1;&#x9053;">&#x8FD0;&#x884C; CD &#x7BA1;&#x9053;</h3>
<p>&#x8981;&#x67E5;&#x770B; CD pipeline &#x7684;&#x5B9E;&#x9645;&#x64CD;&#x4F5C;&#xFF0C;&#x5728; Jenkins &#x9875;&#x9762;&#x70B9;&#x51FB; &#x201C;deployNginxChart&#x201D; job &#x7684; main &#x5206;&#x652F;&#xFF0C;&#x5355;&#x51FB; <strong>#1</strong> &#x67E5;&#x770B;&#x65E5;&#x5FD7;&#x8F93;&#x51FA;&#x3002;&#x5F53;&#x5BFC;&#x822A;&#x5230;&#x65E5;&#x5FD7;&#x65F6;&#xFF0C;&#x4F60;&#x4F1A;&#x770B;&#x5230;&#x4E00;&#x4E2A;&#x63D0;&#x793A;&#xFF0C;&#x663E;&#x793A; &#x201C;Deploy to Prod&#x201D;&#xFF1F;&#x6211;&#x4EEC;&#x5C06;&#x5F88;&#x5FEB;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;&#x9996;&#x5148;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x56DE;&#x987E;&#x65E5;&#x5FD7;&#x7684;&#x5F00;&#x5934;&#x90E8;&#x5206;&#xFF0C;&#x67E5;&#x770B;&#x7BA1;&#x9053;&#x5230;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#x7684;&#x6267;&#x884C;&#x60C5;&#x51B5;&#x3002;</p>
<p>&#x4F60;&#x5DF2;&#x770B;&#x5230;&#x7B2C;&#x4E00;&#x4E2A;&#x90E8;&#x7F72;&#x7684;&#x662F; <strong>dev</strong> &#x73AF;&#x5883;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell"><span class="token number">19</span>:14:51  + helm upgrade --install nginx-main aiops/nginx --values common-values.yaml --values dev/values.yaml -n dev --wait
<span class="token number">19</span>:14:56  Release <span class="token string">&quot;nginx-main&quot;</span> has been upgraded. Happy Helming<span class="token operator">!</span>
<span class="token number">19</span>:14:56  NAME: nginx-main
<span class="token number">19</span>:14:56  LAST DEPLOYED: Fri Aug <span class="token number">13</span> <span class="token number">11</span>:14:53 <span class="token number">2021</span>
<span class="token number">19</span>:14:56  NAMESPACE: dev
<span class="token number">19</span>:14:56  STATUS: deployed
<span class="token number">19</span>:14:56  REVISION: <span class="token number">34</span>
<span class="token number">19</span>:14:56  NOTES:
<span class="token number">19</span>:14:56  <span class="token number">1</span>. Get the application URL by running these commands weiwendi:
<span class="token number">19</span>:14:56    <span class="token builtin class-name">export</span> <span class="token assign-left variable">NODE_PORT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>kubectl get --namespace dev -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">&quot;{.spec.ports[0].nodePort}&quot;</span> services nginx-main<span class="token variable">)</span></span>
<span class="token number">19</span>:14:56    <span class="token builtin class-name">export</span> <span class="token assign-left variable">NODE_IP</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>kubectl get nodes --namespace dev -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">&quot;{.items[0].status.addresses[0].address}&quot;</span><span class="token variable">)</span></span>
<span class="token number">19</span>:14:56    <span class="token builtin class-name">echo</span> http://<span class="token variable">$NODE_IP</span><span class="token builtin class-name">:</span><span class="token variable">$NODE_PORT</span>
<span class="token number">19</span>:14:56  + kubectl -n dev <span class="token builtin class-name">exec</span> deploy/nginx-main -- <span class="token function">env</span>
<span class="token number">19</span>:14:56  + <span class="token function">grep</span> ENVIRONMENT
<span class="token number">19</span>:14:56  <span class="token assign-left variable">ENVIRONMENT</span><span class="token operator">=</span>dev
</code></pre>
<p>&#x7136;&#x540E;&#xFF0C;&#x4F60;&#x5E94;&#x8BE5;&#x770B;&#x5230;&#x5192;&#x70DF;&#x6D4B;&#x8BD5;&#xFF0C;&#x8FD9;&#x662F;&#x7531; <strong>helm test</strong> &#x547D;&#x4EE4;&#x8FD0;&#x884C;&#x7684;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">+ helm <span class="token builtin class-name">test</span> nginx-master -n dev

Pod nginx-master-test-connection pending

Pod nginx-master-test-connection pending

Pod nginx-master-test-connection succeeded

NAME: nginx-master

LAST DEPLOYED: Thu Apr <span class="token number">30</span> 02:07:55 <span class="token number">2020</span>

NAMESPACE: dev

STATUS: deployed

REVISION: <span class="token number">1</span>

TEST SUITE:     nginx-master-test-connection

Last Started:   Thu Apr <span class="token number">30</span> 02:08:03 <span class="token number">2020</span>

Last Completed: Thu Apr <span class="token number">30</span> 02:08:05 <span class="token number">2020</span>

Phase:          Succeeded19:14:57  + helm <span class="token builtin class-name">test</span> nginx-main -n dev
<span class="token number">19</span>:15:05  NAME: nginx-main
<span class="token number">19</span>:15:05  LAST DEPLOYED: Fri Aug <span class="token number">13</span> <span class="token number">11</span>:14:53 <span class="token number">2021</span>
<span class="token number">19</span>:15:05  NAMESPACE: dev
<span class="token number">19</span>:15:05  STATUS: deployed
<span class="token number">19</span>:15:05  REVISION: <span class="token number">34</span>
<span class="token number">19</span>:15:05  TEST SUITE:     nginx-main-test-connection
<span class="token number">19</span>:15:05  Last Started:   Fri Aug <span class="token number">13</span> <span class="token number">11</span>:14:57 <span class="token number">2021</span>
<span class="token number">19</span>:15:05  Last Completed: Fri Aug <span class="token number">13</span> <span class="token number">11</span>:15:04 <span class="token number">2021</span>
<span class="token number">19</span>:15:05  Phase:          Succeeded
</code></pre>
<p>&#x5192;&#x70DF;&#x6D4B;&#x8BD5;&#x4E4B;&#x540E;&#xFF0C;&#x662F; qa &#x73AF;&#x5883;&#x7684;&#x90E8;&#x7F72;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell"><span class="token number">19</span>:15:06  + helm upgrade --install nginx-main aiops/nginx --values common-values.yaml --values qa/values.yaml -n qa --wait
<span class="token number">19</span>:15:32  Release <span class="token string">&quot;nginx-main&quot;</span> has been upgraded. Happy Helming<span class="token operator">!</span>
<span class="token number">19</span>:15:32  NAME: nginx-main
<span class="token number">19</span>:15:32  LAST DEPLOYED: Fri Aug <span class="token number">13</span> <span class="token number">11</span>:15:28 <span class="token number">2021</span>
<span class="token number">19</span>:15:32  NAMESPACE: qa
<span class="token number">19</span>:15:32  STATUS: deployed
<span class="token number">19</span>:15:32  REVISION: <span class="token number">17</span>
<span class="token number">19</span>:15:32  NOTES:
<span class="token number">19</span>:15:32  <span class="token number">1</span>. Get the application URL by running these commands weiwendi:
<span class="token number">19</span>:15:32    <span class="token builtin class-name">export</span> <span class="token assign-left variable">NODE_PORT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>kubectl get --namespace qa -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">&quot;{.spec.ports[0].nodePort}&quot;</span> services nginx-main<span class="token variable">)</span></span>
<span class="token number">19</span>:15:32    <span class="token builtin class-name">export</span> <span class="token assign-left variable">NODE_IP</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>kubectl get nodes --namespace qa -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">&quot;{.items[0].status.addresses[0].address}&quot;</span><span class="token variable">)</span></span>
<span class="token number">19</span>:15:32    <span class="token builtin class-name">echo</span> http://<span class="token variable">$NODE_IP</span><span class="token builtin class-name">:</span><span class="token variable">$NODE_PORT</span>
<span class="token number">19</span>:15:32  + kubectl -n qa <span class="token builtin class-name">exec</span> deploy/nginx-main -- <span class="token function">env</span>
<span class="token number">19</span>:15:32  + <span class="token function">grep</span> ENVIRONMENT
<span class="token number">19</span>:15:32  <span class="token assign-left variable">ENVIRONMENT</span><span class="token operator">=</span>qa
</code></pre>
<p>&#x7136;&#x540E;&#x662F; <strong>input</strong> stage&#xFF0C;&#x5C31;&#x662F;&#x6700;&#x521D;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x7684;&#x5185;&#x5BB9;&#xFF1A;</p>
<figure id="fig2.7.10"><img src="https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/Figure_7.17.jpg" alt="7.11 Proceed or Abort"><figcaption>7.11 Proceed or Abort</figcaption></figure>
<p>&#x5728; &#x201C;Stage View&#x201D; &#x9875;&#x9762;&#x5355;&#x51FB; &#x201C;Proceed&#x201D; &#x7EE7;&#x7EED; pipeline &#x7684;&#x6267;&#x884C;&#xFF08;&#x5355;&#x51FB; &#x201C;Abort&#x201D; &#x5C06;&#x5BFC;&#x81F4; pipeline &#x7EC8;&#x6B62;&#xFF0C;&#x5E76;&#x963B;&#x6B62;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x7684;&#x90E8;&#x7F72;&#xFF09;&#x3002;&#x7136;&#x540E;&#xFF0C;&#x4F60;&#x5C06;&#x770B;&#x5230; prod &#x90E8;&#x7F72;&#x7684;&#x63D0;&#x793A;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell"><span class="token number">19</span>:19:31  + helm upgrade --install nginx-main aiops/nginx --values common-values.yaml --values prod/values.yaml -n prod --wait
<span class="token number">19</span>:19:35  Release <span class="token string">&quot;nginx-main&quot;</span> has been upgraded. Happy Helming<span class="token operator">!</span>
<span class="token number">19</span>:19:35  NAME: nginx-main
<span class="token number">19</span>:19:35  LAST DEPLOYED: Fri Aug <span class="token number">13</span> <span class="token number">11</span>:19:33 <span class="token number">2021</span>
<span class="token number">19</span>:19:35  NAMESPACE: prod
<span class="token number">19</span>:19:35  STATUS: deployed
<span class="token number">19</span>:19:35  REVISION: <span class="token number">1</span>
</code></pre>
<p>&#x6700;&#x540E;&#xFF0C;&#x5982;&#x679C;&#x751F;&#x4EA7;&#x90E8;&#x7F72;&#x6210;&#x529F;&#xFF0C;&#x60A8;&#x5C06;&#x5728;&#x7BA1;&#x9053;&#x7684;&#x672B;&#x5C3E;&#x770B;&#x5230;&#x4EE5;&#x4E0B;&#x6D88;&#x606F;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell"><span class="token punctuation">[</span>Pipeline<span class="token punctuation">]</span> End of Pipeline

Finished: SUCCESS
</code></pre>
<p>&#x53EF;&#x4EE5;&#x4ECE;&#x547D;&#x4EE4;&#x884C;&#x624B;&#x52A8;&#x9A8C;&#x8BC1;&#x90E8;&#x7F72;&#x662F;&#x5426;&#x6210;&#x529F;&#x3002;&#x4F7F;&#x7528; <strong>helm list</strong> &#x547D;&#x4EE4;&#x67E5;&#x770B; <strong>nginx-master</strong> &#x7248;&#x672C;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">$ helm list -n dev
$ helm list -n qa
$ helm list -n prod
</code></pre>
<p>&#x6BCF;&#x4E2A;&#x547D;&#x4EE4;&#x90FD;&#x5E94;&#x8BE5;&#x5728;&#x5BF9;&#x5E94;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x5217;&#x51FA; nginx release&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">NAME             NAMESPACE     REVISION  

nginx-master       dev           <span class="token number">1</span>
</code></pre>
<p>&#x4F60;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; kubectl &#x5217;&#x51FA;&#x6BCF;&#x4E2A;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;&#x7684; Pods&#xFF0C;&#x5E76;&#x9A8C;&#x8BC1;&#x662F;&#x5426;&#x90E8;&#x7F72;&#x4E86; Nginx&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">$ kubectl get Pods -n dev
$ kubectl get Pods -n qa
$ kubectl get Pods -n prod
</code></pre>
<p>&#x6BCF;&#x4E2A;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7684;&#x7ED3;&#x679C;&#x5982;&#x4E0B;&#xFF08;dev &#x8FD8;&#x5C06;&#x6709;&#x4E00;&#x4E2A;&#x5192;&#x70DF;&#x6D4B;&#x8BD5;&#x9636;&#x6BB5;&#x7684; test pod&#xFF09;&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">NAME                    READY   STATUS    RESTARTS   AGE

nginx-fcb5d6b64-rmc2j   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          46m
</code></pre>
<p>&#x5728;&#x672C;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x8BA8;&#x8BBA;&#x4E86;&#x5982;&#x4F55;&#x5728; CD &#x7BA1;&#x9053;&#x4E2D;&#x4F7F;&#x7528; Helm &#x5728; Kubernetes &#x4E2D;&#x7684;&#x591A;&#x4E2A;&#x73AF;&#x5883;&#x4E2D;&#x90E8;&#x7F72;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;&#x7BA1;&#x9053;&#x4F9D;&#x8D56;&#x4E8E; GitOps &#x5B58;&#x50A8;&#x914D;&#x7F6E;(values.yaml &#x6587;&#x4EF6;)&#x7684;&#x5B9E;&#x8DF5;&#x3002;&#x5E76;&#x5F15;&#x7528;&#x8FD9;&#x4E9B;&#x6587;&#x4EF6;&#x6765;&#x6B63;&#x786E;&#x914D;&#x7F6E; Nginx&#x3002;&#x4E86;&#x89E3;&#x4E86; Helm &#x5982;&#x4F55;&#x5728; CD &#x73AF;&#x5883;&#x4E2D;&#x4F7F;&#x7528;&#x540E;&#xFF0C;&#x73B0;&#x5728;&#x5C31;&#x53EF;&#x4EE5;&#x6E05;&#x7406; Minikube &#x96C6;&#x7FA4;&#x4E86;&#x3002;</p>
<h2 id="&#x73AF;&#x5883;&#x6E05;&#x7406;">&#x73AF;&#x5883;&#x6E05;&#x7406;</h2>
<p>&#x8981;&#x6E05;&#x7406;&#x672C;&#x7AE0;&#x7EC3;&#x4E60;&#x4E2D;&#x7684; Minikube &#x96C6;&#x7FA4;&#xFF0C;&#x8BF7;&#x5220;&#x9664; <strong>chapter7</strong>&#x3001;<strong>dev</strong>&#x3001;<strong>qa</strong> &#x548C; <strong>prod</strong> namespaces&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">$ kubectl delete ns chapter7
$ kubectl delete ns dev
$ kubectl delete ns qa
$ kubectl delete ns prod
</code></pre>
<p>&#x5173;&#x95ED; Minikube VM&#xFF1A;</p>
<pre class="language-"><code class="lang-shell">$ minikube stop
</code></pre>
<footer class="page-footer-ex"> <span class="page-footer-ex-copyright"> By <a href="https://github.com/weiwendi" target="_blank">&#x9B4F;&#x6587;&#x5F1F;</a>&#xFF0C;&#x4F7F;&#x7528;<a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">&#x77E5;&#x8BC6;&#x5171;&#x4EAB; &#x7F72;&#x540D;-&#x76F8;&#x540C;&#x65B9;&#x5F0F;&#x5171;&#x4EAB; 4.0 &#x56FD;&#x9645;&#x534F;&#x8BAE;</a>&#x53D1;&#x5E03; </span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; <span class="page-footer-ex-footer-update"> <i>updated</i> 2021-08-24 18:52:04 </span> </footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="ceshicharts.html" class="navigation navigation-prev " aria-label="Previous page: 测试 Helm 图表">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="operator.html" class="navigation navigation-next " aria-label="Next page: Helm 与 Operator">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"使用 CI/CD 和 GitOps 实现 Helm 自动化","level":"2.7","depth":1,"next":{"title":"Helm 与 Operator","level":"2.8","depth":1,"path":"helm/operator.md","ref":"helm/operator.md","articles":[]},"previous":{"title":"测试 Helm 图表","level":"2.6","depth":1,"path":"helm/ceshicharts.md","ref":"helm/ceshicharts.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-highlight","-lunr","-search","prism","prism-themes","github","donate","codesnippet","ga","adsense","github-buttons@2.1.0","splitter","simple-page-toc","page-toc-button","image-captions","back-to-top-button","search-plus","sharing-plus","favicon","theme-default","page-footer-ex","search-pro","code","auto-scroll-table","advanced-emoji","flexible-alerts","editlink"],"ignores":["_book","node_modules"],"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"},"pluginsConfig":{"prism":{"css":["prism-themes/themes/prism-base16-ateliersulphurpool.light.css"],"lang":{"shell":"bash"}},"github":{"url":"https://github.com/weiwendi/cloudnative-handbook"},"editlink":{"label":"编辑本页","multilingual":false,"base":"https://github.com/weiwendi/cloudnative-handbook/tree/main"},"simple-page-toc":{"maxDepth":3,"skipFirstH1":true},"page-footer-ex":{"copyright":"By [魏文弟](https://github.com/weiwendi)，使用[知识共享 署名-相同方式共享 4.0 国际协议](https://creativecommons.org/licenses/by-sa/4.0/)发布","markdown":true,"update_format":"YYYY-MM-DD HH:mm:ss","update_label":"<i>updated</i>"},"splitter":{},"search-pro":{},"adsense":{"client":"pub-8736620102237076","slot":"","format":"auto","element":".page-inner section","position":"bottom"},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"auto-scroll-table":{},"code":{"copyButtons":true},"donate":{"alipay":"https://gitee.com/sretech/images/raw/master/pays/alipay.jpg","alipayText":"支付宝","button":"请杯咖啡","title":"","wechat":"https://gitee.com/sretech/images/raw/master/pays/wechatpay.jpg","wechatText":"微信"},"codesnippet":{},"fontsettings":{"theme":"white","family":"sans","size":2},"favicon":{"shortcut":"https://gitee.com/sretech/images/raw/master/favicon/favicon.ico","bookmark":"https://gitee.com/sretech/images/raw/master/favicon/favicon.ico"},"page-toc-button":{},"back-to-top-button":{},"prism-themes":{},"github-buttons":{"user":"weiwendi","repo":"cloudnative-handbook","types":["star"],"size":"small"},"flexible-alerts":{"danger":{"className":"danger","icon":"fa fa-ban","label":"Attention"},"note":{"className":"info","icon":"fa fa-info-circle","label":"Note"},"style":"callout","tip":{"className":"tip","icon":"fa fa-lightbulb-o","label":"Tip"},"warning":{"className":"warning","icon":"fa fa-exclamation-triangle","label":"Warning"},"comment":{"label":"Comment","icon":"fa fa-comments","className":"info"}},"ga":{"configuration":"auto","token":"UA-174057096-1"},"advanced-emoji":{"embedEmojis":false},"sharing":{"qq":true,"all":["douban","facebook","google","linkedin","twitter","weibo","messenger","qq","qzone"],"facebook":false,"weibo":false,"instapaper":false,"twitter":false,"vk":false,"google":false,"qzone":true},"theme-default":{"showLevel":true,"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"}},"search-plus":{},"image-captions":{"caption":"_CAPTION_","variable_name":"_pictures"}},"theme":"default","author":"魏文弟","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"_pictures":[{"backlink":"helm/jieshao.html#fig2.1.1","level":"2.1","list_caption":"Figure: 1.2dtcreate","alt":"1.2dtcreate","nro":1,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/1.2dtcreate.jpg","index":1,"caption_template":"_CAPTION_","label":"1.2dtcreate","attributes":{},"skip":false,"key":"2.1.1"},{"backlink":"helm/jieshao.html#fig2.1.2","level":"2.1","list_caption":"Figure: 1.3Service","alt":"1.3Service","nro":2,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/1.3Service.jpg","index":2,"caption_template":"_CAPTION_","label":"1.3Service","attributes":{},"skip":false,"key":"2.1.2"},{"backlink":"helm/jieshao.html#fig2.1.3","level":"2.1","list_caption":"Figure: 1.4-storageclass","alt":"1.4-storageclass","nro":3,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/1.4-storageclass.jpg","index":3,"caption_template":"_CAPTION_","label":"1.4-storageclass","attributes":{},"skip":false,"key":"2.1.3"},{"backlink":"helm/jieshao.html#fig2.1.4","level":"2.1","list_caption":"Figure: 1.6-Upgrade","alt":"1.6-Upgrade","nro":4,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/1.6-Upgrade.jpg","index":4,"caption_template":"_CAPTION_","label":"1.6-Upgrade","attributes":{},"skip":false,"key":"2.1.4"},{"backlink":"helm/bushu.html#fig2.2.1","level":"2.2","list_caption":"Figure: 2.1versions","alt":"2.1versions","nro":5,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/2.1versions.png","index":1,"caption_template":"_CAPTION_","label":"2.1versions","attributes":{},"skip":false,"key":"2.2.1"},{"backlink":"helm/bushu.html#fig2.2.2","level":"2.2","list_caption":"Figure: 2.2minikubeDrivers","alt":"2.2minikubeDrivers","nro":6,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/2.2minikubeDrivers.jpg","index":2,"caption_template":"_CAPTION_","label":"2.2minikubeDrivers","attributes":{},"skip":false,"key":"2.2.2"},{"backlink":"helm/anzhuangcharts.html#fig2.3.1","level":"2.3","list_caption":"Figure: 3.1 helm search hub wordpress outputs","alt":"3.1 helm search hub wordpress outputs","nro":7,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/3.1hubouts.jpg","index":1,"caption_template":"_CAPTION_","label":"3.1 helm search hub wordpress outputs","attributes":{},"skip":false,"key":"2.3.1"},{"backlink":"helm/anzhuangcharts.html#fig2.3.2","level":"2.3","list_caption":"Figure: 3.2 helm search hub wordpress yaml outputs","alt":"3.2 helm search hub wordpress yaml outputs","nro":8,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/3.2hubyamloutps.png","index":2,"caption_template":"_CAPTION_","label":"3.2 helm search hub wordpress yaml outputs","attributes":{},"skip":false,"key":"2.3.2"},{"backlink":"helm/anzhuangcharts.html#fig2.3.3","level":"2.3","list_caption":"Figure: 3.3 wordpress page details","alt":"3.3 wordpress page details","nro":9,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/3.3wordpressdetails.jpg","index":3,"caption_template":"_CAPTION_","label":"3.3 wordpress page details","attributes":{},"skip":false,"key":"2.3.3"},{"backlink":"helm/anzhuangcharts.html#fig2.3.4","level":"2.3","list_caption":"Figure: 3.4 bitnami wordpress","alt":"3.4 bitnami wordpress","nro":10,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/3.4bitnamiwordpress.jpg","index":4,"caption_template":"_CAPTION_","label":"3.4 bitnami wordpress","attributes":{},"skip":false,"key":"2.3.4"},{"backlink":"helm/anzhuangcharts.html#fig2.3.5","level":"2.3","list_caption":"Figure: 3.5 show chart","alt":"3.5 show chart","nro":11,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/3.5showchart.jpg","index":5,"caption_template":"_CAPTION_","label":"3.5 show chart","attributes":{},"skip":false,"key":"2.3.5"},{"backlink":"helm/anzhuangcharts.html#fig2.3.6","level":"2.3","list_caption":"Figure: 3.6 wordpress 首页","alt":"3.6 wordpress 首页","nro":12,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/3.8wordpresspage.jpg","index":6,"caption_template":"_CAPTION_","label":"3.6 wordpress 首页","attributes":{},"skip":false,"key":"2.3.6"},{"backlink":"helm/anzhuangcharts.html#fig2.3.7","level":"2.3","list_caption":"Figure: 3.7 admin pages","alt":"3.7 admin pages","nro":13,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/3.9adminpage.jpg","index":7,"caption_template":"_CAPTION_","label":"3.7 admin pages","attributes":{},"skip":false,"key":"2.3.7"},{"backlink":"helm/anzhuangcharts.html#fig2.3.8","level":"2.3","list_caption":"Figure: 3.8 dashboard","alt":"3.8 dashboard","nro":14,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/3.10adminpage2.png","index":8,"caption_template":"_CAPTION_","label":"3.8 dashboard","attributes":{},"skip":false,"key":"2.3.8"},{"backlink":"helm/kaifacharts.html#fig2.5.1","level":"2.5","list_caption":"Figure: 5.1 player stats page","alt":"5.1 player stats page","nro":15,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/5.1player-stats.jpg","index":1,"caption_template":"_CAPTION_","label":"5.1 player stats page","attributes":{},"skip":false,"key":"2.5.1"},{"backlink":"helm/helmcicd.html#fig2.7.1","level":"2.7","list_caption":"Figure: 7.1 fork","alt":"7.1 fork","nro":16,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.1fork.png","index":1,"caption_template":"_CAPTION_","label":"7.1 fork","attributes":{},"skip":false,"key":"2.7.1"},{"backlink":"helm/helmcicd.html#fig2.7.2","level":"2.7","list_caption":"Figure: 7.2 delete tar and index file","alt":"7.2 delete tar and index file","nro":17,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.2delete.jpg","index":2,"caption_template":"_CAPTION_","label":"7.2 delete tar and index file","attributes":{},"skip":false,"key":"2.7.2"},{"backlink":"helm/helmcicd.html#fig2.7.3","level":"2.7","list_caption":"Figure: 7.3 create github token.","alt":"7.3 create github token.","nro":18,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.3%20create%20github%20token.jpg","index":3,"caption_template":"_CAPTION_","label":"7.3 create github token.","attributes":{},"skip":false,"key":"2.7.3"},{"backlink":"helm/helmcicd.html#fig2.7.4","level":"2.7","list_caption":"Figure: 7.4 create jenkins github credentials","alt":"7.4 create jenkins github credentials","nro":19,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.4%20create%20github%20credentials.jpg","index":4,"caption_template":"_CAPTION_","label":"7.4 create jenkins github credentials","attributes":{},"skip":false,"key":"2.7.4"},{"backlink":"helm/helmcicd.html#fig2.7.5","level":"2.7","list_caption":"Figure: 7.5 create jenkins kubeconfig credentials","alt":"7.5 create jenkins kubeconfig credentials","nro":20,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.5%20create%20kubernetes%20credentials.jpg","index":5,"caption_template":"_CAPTION_","label":"7.5 create jenkins kubeconfig credentials","attributes":{},"skip":false,"key":"2.7.5"},{"backlink":"helm/helmcicd.html#fig2.7.6","level":"2.7","list_caption":"Figure: 7.6 add repo","alt":"7.6 add repo","nro":21,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.6%20add%20https%20github%20repository.png","index":6,"caption_template":"_CAPTION_","label":"7.6 add repo","attributes":{},"skip":false,"key":"2.7.6"},{"backlink":"helm/helmcicd.html#fig2.7.7","level":"2.7","list_caption":"Figure: 7.8 scan repo","alt":"7.8 scan repo","nro":22,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.8%20scan%20repository%20build.jpg","index":7,"caption_template":"_CAPTION_","label":"7.8 scan repo","attributes":{},"skip":false,"key":"2.7.7"},{"backlink":"helm/helmcicd.html#fig2.7.8","level":"2.7","list_caption":"Figure: 7.9 charts repo list","alt":"7.9 charts repo list","nro":23,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.9%20charts%20repo%20list.jpg","index":8,"caption_template":"_CAPTION_","label":"7.9 charts repo list","attributes":{},"skip":false,"key":"2.7.8"},{"backlink":"helm/helmcicd.html#fig2.7.9","level":"2.7","list_caption":"Figure: 7.10 stable list","alt":"7.10 stable list","nro":24,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/7.10%20stable%20list.jpg","index":9,"caption_template":"_CAPTION_","label":"7.10 stable list","attributes":{},"skip":false,"key":"2.7.9"},{"backlink":"helm/helmcicd.html#fig2.7.10","level":"2.7","list_caption":"Figure: 7.11 Proceed or Abort","alt":"7.11 Proceed or Abort","nro":25,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/Figure_7.17.jpg","index":10,"caption_template":"_CAPTION_","label":"7.11 Proceed or Abort","attributes":{},"skip":false,"key":"2.7.10"},{"backlink":"helm/operator.html#fig2.8.1","level":"2.8","list_caption":"Figure: 8.1 cr install helm chart","alt":"8.1 cr install helm chart","nro":26,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/8.1%20cr%20install%20chart.jpg","index":1,"caption_template":"_CAPTION_","label":"8.1 cr install helm chart","attributes":{},"skip":false,"key":"2.8.1"},{"backlink":"helm/operator.html#fig2.8.2","level":"2.8","list_caption":"Figure: 8.2 create quay image repo","alt":"8.2 create quay image repo","nro":27,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/8.2%20create%20quay%20image%20repo.jpg","index":2,"caption_template":"_CAPTION_","label":"8.2 create quay image repo","attributes":{},"skip":false,"key":"2.8.2"},{"backlink":"helm/operator.html#fig2.8.3","level":"2.8","list_caption":"Figure: 8.3 create public image repository","alt":"8.3 create public image repository","nro":28,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/8.3%20create%20public%20image%20repository.jpg","index":3,"caption_template":"_CAPTION_","label":"8.3 create public image repository","attributes":{},"skip":false,"key":"2.8.3"},{"backlink":"helm/operator.html#fig2.8.4","level":"2.8","list_caption":"Figure: 8.4 player stats operator image","alt":"8.4 player stats operator image","nro":29,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/8.4%20player%20stats%20operator%20image.jpg","index":4,"caption_template":"_CAPTION_","label":"8.4 player stats operator image","attributes":{},"skip":false,"key":"2.8.4"},{"backlink":"helm/security.html#fig2.10.1","level":"2.10","list_caption":"Figure: 9.1 gpg outputs","alt":"9.1 gpg outputs","nro":30,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/9.1%20gpg%20infors.jpg","index":1,"caption_template":"_CAPTION_","label":"9.1 gpg outputs","attributes":{},"skip":false,"key":"2.10.1"},{"backlink":"helm/security.html#fig2.10.2","level":"2.10","list_caption":"Figure: 9.2 helm versions","alt":"9.2 helm versions","nro":31,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/9.2%20helm%20release%20download.jpg","index":2,"caption_template":"_CAPTION_","label":"9.2 helm versions","attributes":{},"skip":false,"key":"2.10.2"},{"backlink":"helm/security.html#fig2.10.3","level":"2.10","list_caption":"Figure: 9.3 digital signature","alt":"9.3 digital signature","nro":32,"url":"https://gitee.com/sretech/images/raw/master/cloudnative-handbook/helm/9.3%20digital%20signature.jpg","index":3,"caption_template":"_CAPTION_","label":"9.3 digital signature","attributes":{},"skip":false,"key":"2.10.3"}]},"title":"云原生运维指南","language":"zh-hans","links":{"sidebar":{"博客":"https://www.aiops.red","公众号: sretech":"https://gitee.com/sretech/images/raw/master/wechatpublic.jpg"}},"gitbook":"*","description":"从理论到实践系统介绍云原生环境下的运维"},"file":{"path":"helm/helmcicd.md","mtime":"2021-08-24T10:52:04.757Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-09-01T09:21:34.056Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-donate/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-adsense/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github-buttons/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-page-toc-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-auto-scroll-table/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-flexible-alerts/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-editlink/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

